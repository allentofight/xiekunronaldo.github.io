
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>AllenToFight Blog</title>
	<meta name="author" content="AllenToFight">

	
	<meta name="description" content="Oct 12th, 2014 javascript Js Speaking Javascript学习笔记 Primitive Values Versus Objects
JavaScript makes a somewhat arbitrary distinction between &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="AllenToFight Blog" type="application/atom+xml">
	
	<link rel="canonical" href="http://xiekunRonaldo.github.io/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<img src="http://www.gravatar.com/avatar/27a0140c11f18fab9bf284743d2b2b4c?s=160" alt="Profile Picture" style="width: 160px;" />
	
</div>
<hgroup>
  <h1><a href="/">AllenToFight Blog</a></h1>
  
    <h2>Life To Code.</h2>
  
</hgroup>

<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
			<a class="weibo" href="http://www.weibo.com/1876496750" title="Weibo">Facebook</a>
		
		
		
		
		
		
		
		
		
		
		
		
		
		
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-12T14:22:28+08:00" data-updated="true" itemprop="datePublished">Oct 12<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/javascript/'>javascript</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/12/js/" itemprop="url">Js</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h2 id="speaking-javascript">Speaking Javascript学习笔记</h2>

<h3 id="primitive-values-versus-objects">Primitive Values Versus Objects</h3>
<p>JavaScript makes a somewhat arbitrary distinction between values:</p>

<ul>
  <li>The primitive values are booleans, numbers, strings, null, and undefined.</li>
  <li>All other values are objects.</li>
</ul>

<p>A major difference between the two is how they are compared; each object has a unique
identity and is only (strictly) equal to itself:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">obj1</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// an empty object</span>
</span><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">obj2</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// another empty object &gt; obj1 === obj2</span>
</span><span class="line"><span class="kc">false</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">obj1</span> <span class="o">===</span> <span class="nx">obj1</span>
</span><span class="line"><span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="primitive-values">Primitive Values</h4>

<ul>
  <li>Booleans: true, false </li>
  <li>Numbers: 1736, 1.351 </li>
  <li>Strings: ‘abc’, “abc” </li>
  <li>Two “nonvalues”: undefined, null </li>
</ul>

<p>Primitives have the following characteristics:</p>

<ul>
  <li>Compared by value</li>
</ul>

<p><code>
&gt; 3 === 3
true
&gt; 'abc' === 'abc'
true
</code></p>

<ul>
  <li>
    <p>Always immutable</p>

    <p>Properties can’t be changed, added, or removed:</p>
  </li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span><span class="p">;</span>
</span><span class="line">     <span class="o">&gt;</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// try to change property `length`</span>
</span><span class="line">     <span class="o">&gt;</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// ⇒ no effect 3</span>
</span><span class="line">	 <span class="o">&gt;</span> <span class="nx">str</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// try to create property `foo`</span>
</span><span class="line">	 <span class="o">&gt;</span><span class="nx">str</span><span class="p">.</span><span class="nx">foo</span> <span class="c1">// ⇒ no effect, unknown property undefined</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Objects
All nonprimitive values are objects.The most common kinds of objects are:</p>

<ul>
  <li>Plain objects</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="p">{</span>
</span><span class="line">            <span class="nx">firstName</span><span class="o">:</span> <span class="s1">&#39;Jane&#39;</span><span class="p">,</span>
</span><span class="line">            <span class="nx">lastName</span><span class="o">:</span> <span class="s1">&#39;Doe&#39;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>Arrays</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="p">[</span> <span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="s1">&#39;cherry&#39;</span> <span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>Regular expressions</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="sr">/^a+b+$/</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Objects have the following characteristics:</p>

<ul>
  <li>Compared by reference
Identities are compared; every value has its own identity:</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="p">{}</span> <span class="o">===</span> <span class="p">{}</span>  <span class="c1">// two different empty objects</span>
</span><span class="line"><span class="kc">false</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">obj1</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">obj2</span> <span class="o">=</span> <span class="nx">obj1</span><span class="p">;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">obj1</span> <span class="o">===</span> <span class="nx">obj2</span>
</span><span class="line"><span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>Mutable by default
You can normally freely change, add, and remove properties</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span> <span class="c1">// add property `foo` &gt; obj.foo</span>
</span><span class="line"><span class="mi">123</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### undefined and null</p>

<p>Most programming languages have values denoting missing information. JavaScript has two such “nonvalues,” undefined and null:</p>

<ul>
  <li>undefined means “no value.” Uninitialized variables are undefined:</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">foo</span><span class="p">;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">foo</span>
</span><span class="line"><span class="kc">undefined</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Missing parameters are undefined:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span> <span class="p">}</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">f</span><span class="p">()</span>
</span><span class="line"><span class="kc">undefined</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>If you read a nonexistent property, you get undefined:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// empty object </span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">foo</span>
</span><span class="line"><span class="kc">undefined</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>null means “no object.” It is used as a nonvalue whenever an object is expected (parameters, last in a chain of objects, etc.)</li>
</ul>

<p><code>Note</code></p>

<p>undefined and null have no properties, not even standard meth‐ ods such as toString().</p>

<h4 id="checking-for-undefined-or-null">Checking for undefined or null</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">x</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="p">...</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>You can also exploit the fact that both undefined and null are considered false:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="p">...</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><code>Note</code></p>

<p>false, 0, NaN, and ‘’ are also considered false</p>

<h4 id="categorizing-values-using-typeof-and-instanceof">Categorizing Values Using typeof and instanceof</h4>
<p>There are two operators for categorizing values: <code>typeof</code> is mainly used for primitive values, while <code>instanceof</code> is used for objects.</p>

<p>typeof looks like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">typeof</span> <span class="nx">value</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;</span> <span class="k">typeof</span> <span class="kc">true</span>
</span><span class="line"><span class="s1">&#39;boolean&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="k">typeof</span> <span class="s1">&#39;abc&#39;</span>
</span><span class="line"><span class="s1">&#39;string&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="k">typeof</span> <span class="p">{}</span> <span class="c1">// empty object literal</span>
</span><span class="line"><span class="s1">&#39;object&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="k">typeof</span> <span class="p">[]</span> <span class="c1">// empty array literal</span>
</span><span class="line"><span class="s1">&#39;object&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The following table lists all results of typeof:</p>

<table>
  <thead>
    <tr>
      <th>Operand</th>
      <th>Result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>undefined</td>
      <td>undefined</td>
    </tr>
    <tr>
      <td>null</td>
      <td>‘object’</td>
    </tr>
    <tr>
      <td>Boolean value</td>
      <td>‘boolean’</td>
    </tr>
    <tr>
      <td>Number value</td>
      <td>‘number’</td>
    </tr>
    <tr>
      <td>String value</td>
      <td>‘string’</td>
    </tr>
    <tr>
      <td>Function</td>
      <td>‘function’</td>
    </tr>
    <tr>
      <td>All other normal values</td>
      <td>‘object’</td>
    </tr>
    <tr>
      <td>(Engine-created value)</td>
      <td>JavaScript engines are allowed to create values for whichtypeofreturns arbitrary strings (different from all results listed in this table).</td>
    </tr>
  </tbody>
</table>

<p><code>Note</code>
typeof null returning ‘object’ is a bug that can’t be fixed, because it would break existing code. It does not mean that null is an object.</p>

<p>instanceof looks like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">value</span> <span class="k">instanceof</span> <span class="nx">Constr</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>It returns true if value is an object that has been created by the constructor Constr</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bar</span><span class="p">();</span> <span class="c1">// object created by constructor Bar &gt; b instanceof Bar</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="p">{}</span> <span class="k">instanceof</span> <span class="nb">Object</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="p">[]</span> <span class="k">instanceof</span> <span class="nb">Array</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="p">[]</span> <span class="k">instanceof</span> <span class="nb">Object</span>  <span class="c1">// Array is a subconstructor of Object</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="kc">undefined</span> <span class="k">instanceof</span> <span class="nb">Object</span>
</span><span class="line"><span class="kc">false</span>
</span><span class="line"><span class="o">&gt;</span> <span class="kc">null</span> <span class="k">instanceof</span> <span class="nb">Object</span>
</span><span class="line"><span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Truthy and Falsy
The following values are interpreted as false:</p>

<ul>
  <li>undefined,null </li>
  <li>Boolean:false </li>
  <li>Number:-0,NaN </li>
  <li>String:’’
Boolean(), called as a function, converts its parameter to a boolean. You can use it to test how a value is interpreted:</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nb">Boolean</span><span class="p">(</span><span class="kc">undefined</span><span class="p">)</span>
</span><span class="line"><span class="kc">false</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">Boolean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class="line"><span class="kc">false</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">Boolean</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">Boolean</span><span class="p">({})</span> <span class="c1">// empty object</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">Boolean</span><span class="p">([])</span> <span class="c1">// empty array</span>
</span><span class="line"><span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Numbers
All numbers in JavaScript are floating-point:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">===</span> <span class="mf">1.0</span>
</span><span class="line"><span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Special numbers include the following:</p>

<ul>
  <li>NaN (“not a number”)
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span></figure></notextile></li>
</ul>
<p>&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"> <span class="nx">An</span> <span class="nx">error</span> <span class="nx">value</span><span class="o">:</span>
</span><span class="line">        <span class="o">&gt;</span> <span class="nb">Number</span><span class="p">(</span><span class="s1">&#39;xyz&#39;</span><span class="p">)</span>  <span class="c1">// &#39;xyz&#39; can’t be converted to a number</span>
</span><span class="line">		<span class="kc">NaN</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;
* Infinity
Also mostly an error value:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span><span class="mi">3</span><span class="o">/</span> <span class="mi">0</span>
</span><span class="line"><span class="kc">Infinity</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>  <span class="c1">// number too large</span>
</span><span class="line"><span class="kc">Infinity</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Strings
Single characters are accessed via square brackets:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span><span class="p">;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class="line"><span class="s1">&#39;b&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>##### String Methods</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;abc&#39;</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1">// copy a substring</span>
</span><span class="line"><span class="s1">&#39;bc&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;abc&#39;</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;b&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Function Declarations Are Hoisted
Function declarations are hoisted—moved in their entirety to the beginning of the cur‐ rent scope. That allows you to refer to functions that are declared later:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">bar</span><span class="p">();</span> <span class="c1">// OK, bar is hoisted </span>
</span><span class="line">	<span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">		<span class="p">...</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Note that while var declarations are also hoisted (see “Variables Are Hoisted” on page 23), assignments performed by them are not:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">bar</span><span class="p">();</span> <span class="c1">// Not OK, bar is still undefined </span>
</span><span class="line">	<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class="line">	<span class="c1">// ...</span>
</span><span class="line">	<span class="p">};</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Too Many or Too Few Arguments
Let’s use the following function to explore how too many or too few parameters are handled in JavaScript</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
</span><span class="line">	<span class="k">return</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Additional parameters will be ignored (except by arguments):</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="nx">f</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span>
</span><span class="line"><span class="nx">ab</span>
</span><span class="line"><span class="p">[</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Missing parameters will get the value undefined:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="nx">f</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span><span class="line"><span class="nx">a</span> <span class="kc">undefined</span>
</span><span class="line"><span class="p">[</span> <span class="s1">&#39;a&#39;</span> <span class="p">]</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">f</span><span class="p">()</span>
</span><span class="line"><span class="kc">undefined</span> <span class="kc">undefined</span> <span class="p">[]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Optional Parameters
The following is a common pattern for assigning default values to parameters:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">pair</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// (1) </span>
</span><span class="line">	<span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line">	<span class="k">return</span> <span class="p">[</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Enforcing an Arity
If you want to enforce an arity (a specific number of parameters), you can check arguments.length:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">pair</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line"><span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Need exactly 2 arguments&#39;</span><span class="p">);</span> <span class="p">}</span>
</span><span class="line">	<span class="p">...</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Converting arguments to an Array
arguments is not an array, it is only array-like (see “Array-Like Objects and Generic Methods” on page 262). It has a property length, and you can access its elements via indices in square brackets. You cannot, however, remove elements or invoke any of the array methods on it. Thus, you sometimes need to convert arguments to an array</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">arrayLikeObject</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arrayLikeObject</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>`
#### Exception Handling
The most common way to handle exceptions (see Chapter 14) is as follows:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">getPerson</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;ID must not be negative: &#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">);</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">return</span> <span class="p">{</span>
</span><span class="line">        <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span>
</span><span class="line">    <span class="p">};</span> <span class="c1">// normally: retrieved from database }</span>
</span><span class="line">    <span class="kd">function</span> <span class="nx">getPersons</span><span class="p">(</span><span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class="line">        <span class="nx">ids</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">            <span class="k">try</span> <span class="p">{</span>
</span><span class="line">                <span class="kd">var</span> <span class="nx">person</span> <span class="o">=</span> <span class="nx">getPerson</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span><span class="line">                <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">person</span><span class="p">);</span>
</span><span class="line">            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">exception</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">exception</span><span class="p">);</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">        <span class="p">});</span>
</span><span class="line">        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The try clause surrounds critical code, and the catch clause is executed if an exception is thrown inside the try clause. Using the preceding code:</p>

<p><code>
 &gt; getPersons([2, -5, 137])
    [Error: ID must not be negative: -5]
    [ { id: 2 }, { id: 137 } ]
</code></p>

<h4 id="strict-mode">Strict Mode</h4>

<p>Strict mode (see <code>Strict Mode</code> on page 62) enables more warnings and makes JavaScript a cleaner language (nonstrict mode is sometimes called <code>sloppy mode</code>). To switch it on, type the following line first in a JavaScript file or a <code>&lt;script&gt;</code> tag:
<code>
'use strict';
</code>
You can also enable strict mode per function:</p>

<p><code>
function functionInStrictMode() { 
	'use strict';
}
</code></p>

<h4 id="variables-are-function-scoped">Variables Are Function-Scoped</h4>

<p>The scope of a variable is always the complete function (as opposed to the current block). For example:</p>

<p><code>
function foo() {
    var x = -512;
    if (x &lt; 0) { // (1) var tmp = -x;
        ...
    }
    console.log(tmp); // 512 
}
</code></p>

<p>We can see that the variable tmp is not restricted to the block starting in line (1); it exists until the end of the function.</p>

<h4 id="variables-are-hoisted">Variables Are Hoisted</h4>

<p>Each variable declaration is <code>hoisted</code>: the declaration is moved to the <code>beginning</code> of the function, but assignments that it makes stay put. As an example, consider the variable declaration in line (1) in the following function:</p>

<p><code>
function foo() {
    console.log(tmp); // undefined 
    if (false) {
        var tmp = 3; // (1) 
    }
}
</code></p>

<p>Internally, the preceding function is executed like this:</p>

<p><code>
function foo() {
    var tmp; // hoisted declaration 
    console.log(tmp);
    if (false) {
        tmp = 3; // assignment stays put 
    }
}
</code>
#### Closures
Each function stays connected to the variables of the functions that surround it, even after it leaves the scope in which it was created. For example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">createIncrementor</span><span class="p">(</span><span class="nx">start</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// (1)</span>
</span><span class="line">        <span class="nx">start</span><span class="o">++</span><span class="p">;</span>
</span><span class="line">        <span class="k">return</span> <span class="nx">start</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">inc</span> <span class="o">=</span> <span class="nx">createIncrementor</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">inc</span><span class="p">()</span>
</span><span class="line"><span class="mi">6</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">inc</span><span class="p">()</span>
</span><span class="line"><span class="mi">7</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">inc</span><span class="p">()</span>
</span><span class="line"><span class="mi">8</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>A closure is a function plus the connection to the variables of its surrounding scopes. Thus, what createIncrementor() returns is a closure.</p>

<h4 id="the-iife-pattern-introducing-a-new-scope">The IIFE Pattern: Introducing a New Scope</h4>
<p>Sometimes you want to introduce a new variable scope—for example, to prevent a vari‐able from becoming global. In JavaScript, you can’t use a block to do so; you must use a function. But there is a pattern for using a function in a block-like manner. It is called IIFE (immediately invoked function expression, pronounced “iffy”):</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="c1">// open IIFE</span>
</span><span class="line"><span class="kd">var</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="p">...;</span> <span class="c1">// not a global variable</span>
</span><span class="line"><span class="p">}());</span> <span class="c1">// close IIFE</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>An IIFE is a function expression that is called <code>immediately</code> after you define it. Inside the function, a new scope exists, preventing tmp from becoming global</p>

<h5 id="iife-use-case-inadvertent-sharing-via-closures">IIFE use case: inadvertent sharing via closures</h5>
<p>Closures keep their connections to outer variables, which is sometimes not what you want:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class="line"><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">        <span class="k">return</span> <span class="nx">i</span>
</span><span class="line">    <span class="p">});</span> <span class="c1">// (1) </span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]());</span> <span class="c1">// 5 (not 1) </span>
</span><span class="line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]());</span> <span class="c1">// 5 (not 3)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The value returned in line (1) is always the current value of i, not the value it had when the function was created. After the loop is finished, i has the value 5, which is why all functions in the array return that value. If you want the function in line (1) to receive a snapshot of the current value of i, you can use an IIFE:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">        <span class="kd">var</span> <span class="nx">i2</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span> <span class="c1">// copy current i</span>
</span><span class="line">        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">            <span class="k">return</span> <span class="nx">i2</span>
</span><span class="line">        <span class="p">});</span>
</span><span class="line">    <span class="p">}());</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Objects and Constructors
* Single Objects</p>

<p>In JavaScript, you can directly create plain objects, via object literals:
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class="line"><span class="kd">var</span> <span class="nx">jane</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Jane&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="nx">describe</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">        <span class="k">return</span> <span class="s1">&#39;Person named &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">};</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;
The in operator checks whether a property exists:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="s1">&#39;newProperty&#39;</span> <span class="k">in</span> <span class="nx">jane</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;foo&#39;</span> <span class="k">in</span> <span class="nx">jane</span>
</span><span class="line"><span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>If you read a property that does not exist, you get the value undefined. Hence, the previous two checks could also be performed like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="nx">jane</span><span class="p">.</span><span class="nx">newProperty</span> <span class="o">!==</span> <span class="kc">undefined</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">jane</span><span class="p">.</span><span class="nx">foo</span> <span class="o">!==</span> <span class="kc">undefined</span>
</span><span class="line"><span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The delete operator removes a property:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="k">delete</span> <span class="nx">jane</span><span class="p">.</span><span class="nx">newProperty</span>
</span><span class="line"><span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Arbitrary Property Keys
A property key can be any string. So far, we have seen property keys in object literals and after the dot operator. However, you can use them that way <code>only if</code> they are <code>identifiers</code> (see “Identifiers and Variable Names” on page 6). If you want to use other strings as keys, you have to quote them in an object literal and use square brackets to get and set the property:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;not an identifier&#39;</span><span class="o">:</span> <span class="mi">123</span> <span class="p">};</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">obj</span><span class="p">[</span><span class="s1">&#39;not an identifier&#39;</span><span class="p">]</span>
</span><span class="line"><span class="mi">123</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">obj</span><span class="p">[</span><span class="s1">&#39;not an identifier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">456</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Square brackets also allow you to compute the key of a property:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">hello</span><span class="o">:</span> <span class="s1">&#39;world&#39;</span> <span class="p">};</span>
</span><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="s1">&#39;hello&#39;</span><span class="p">;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span>
</span><span class="line"><span class="s1">&#39;world&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">obj</span><span class="p">[</span><span class="s1">&#39;hel&#39;</span><span class="o">+</span><span class="s1">&#39;lo&#39;</span><span class="p">]</span>
</span><span class="line"><span class="s1">&#39;world&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Extracting Methods
If you extract a method, it loses its connection with the object. On its own, the function is not a method anymore, and this has the value undefined (in strict mode).
As an example, let’s go back to the earlier object jane:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class="line"><span class="kd">var</span> <span class="nx">jane</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Jane&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="nx">describe</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">        <span class="k">return</span> <span class="s1">&#39;Person named &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>We want to extract the method describe from jane, put it into a variable func, and call it. However, that doesn’t work:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">func</span> <span class="o">=</span> <span class="nx">jane</span><span class="p">.</span><span class="nx">describe</span><span class="p">;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">func</span><span class="p">()</span>
</span><span class="line"><span class="nx">TypeError</span><span class="o">:</span> <span class="nx">Cannot</span> <span class="nx">read</span> <span class="nx">property</span> <span class="s1">&#39;name&#39;</span> <span class="nx">of</span> <span class="kc">undefined</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The solution is to use the method bind() that all functions have. It creates a new function whose this always has the given value:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">func2</span> <span class="o">=</span> <span class="nx">jane</span><span class="p">.</span><span class="nx">describe</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">jane</span><span class="p">);</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">func2</span><span class="p">()</span>
</span><span class="line"><span class="s1">&#39;Person named Jane&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>##### Functions Inside a Method
Every function has its own special variable this. This is inconvenient if you nest a function inside a method, because you can’t access the method’s this from the function. The following is an example where we call forEach with a function to iterate over an array:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">jane</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Jane&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="nx">friends</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Tarzan&#39;</span><span class="p">,</span> <span class="s1">&#39;Cheeta&#39;</span><span class="p">],</span>
</span><span class="line">    <span class="nx">logHiToFriends</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">        <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class="line">        <span class="k">this</span><span class="p">.</span><span class="nx">friends</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">friend</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">            <span class="c1">// `this` is undefined here</span>
</span><span class="line">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39; says hi to &#39;</span> <span class="o">+</span> <span class="nx">friend</span><span class="p">);</span>
</span><span class="line">        <span class="p">});</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Calling logHiToFriends produces an error:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="nx">jane</span><span class="p">.</span><span class="nx">logHiToFriends</span><span class="p">()</span>
</span><span class="line"><span class="nx">TypeError</span><span class="o">:</span> <span class="nx">Cannot</span> <span class="nx">read</span> <span class="nx">property</span> <span class="s1">&#39;name&#39;</span> <span class="nx">of</span> <span class="kc">undefined</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Let’s look at two ways of fixing this.</p>

<ul>
  <li>First, we could store this in a different variable:</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">logHiToFriends</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class="line">    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class="line">    <span class="k">this</span><span class="p">.</span><span class="nx">friends</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">friend</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39; says hi to &#39;</span> <span class="o">+</span> <span class="nx">friend</span><span class="p">);</span>
</span><span class="line">    <span class="p">});</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>forEach has a second parameter that allows you to provide a value for this:</li>
</ul>

<p><code>
logHiToFriends: function() {
    'use strict';
    this.friends.forEach(function(friend, this) {
        console.log(this.name + ' says hi to ' + friend);
    }, this);
}
</code>
#### Constructors: Factories for Objects
 JavaScript objects also support a feature that is truly object-oriented: inheritance</p>

<p>In addition to being “real” functions and methods, functions play another role in Java‐ Script: they become constructors—factories for objects—if invoked via the <code>new</code> operator.</p>

<p>Constructors are thus a rough analog to classes in other languages. By convention, the names of constructors start with <code>capital letters</code>. For example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// Set up instance data</span>
</span><span class="line"><span class="kd">function</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
</span><span class="line">    <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="c1">// Methods</span>
</span><span class="line"><span class="nx">Point</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dist</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class="line"><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>We can see that a constructor has two parts. First, the function Point sets up the instance data. Second, the property Point.prototype contains an object with the methods. The former data is specific to each instance, while the latter data is shared among all instances.</p>

<p>&#8220;&#8220;
&gt; var p = new Point(3, 5); 
&gt; p.x
3
&gt; p.dist() 
5.830951894845301
&gt; p instanceof Point
true
&#8220;`
#### Arrays
The length property indicates how many elements an array has. You can use it to append elements and to remove elements:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">];</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span>
</span><span class="line"><span class="mi">2</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span><span class="p">;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">arr</span>
</span><span class="line"><span class="p">[</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="p">]</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span>
</span><span class="line"><span class="mi">3</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">arr</span>
</span><span class="line"><span class="p">[</span> <span class="s1">&#39;a&#39;</span> <span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The <code>in</code> operator works for arrays, too:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="p">];</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mi">1</span> <span class="k">in</span> <span class="nx">arr</span> <span class="c1">// is there an element at index 1? </span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mi">5</span> <span class="k">in</span> <span class="nx">arr</span> <span class="c1">// is there an element at index 5? </span>
</span><span class="line"><span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Note that arrays are objects and can thus have object properties:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">foo</span>
</span><span class="line"><span class="mi">123</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>##### Array Methods</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="p">];</span>
</span><span class="line"><span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>  <span class="c1">// append an element</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>  <span class="c1">// remove last element</span>
</span><span class="line"><span class="s1">&#39;x&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">arr</span>
</span><span class="line"><span class="p">[</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="p">]</span>
</span><span class="line">
</span><span class="line"> <span class="o">&gt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>  <span class="c1">// remove first element</span>
</span><span class="line"><span class="s1">&#39;a&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">arr</span>
</span><span class="line"><span class="p">[</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="p">]</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>  <span class="c1">// prepend an element</span>
</span><span class="line"><span class="mi">3</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">arr</span>
</span><span class="line"><span class="p">[</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>##### Iterating over Arrays</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="p">[</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="p">].</span><span class="nx">forEach</span><span class="p">(</span>
</span><span class="line"><span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// (1)</span>
</span><span class="line">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="s1">&#39;. &#39;</span> <span class="o">+</span> <span class="nx">elem</span><span class="p">);</span>
</span><span class="line">        <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>map creates a new array by applying a function to each element of an existing array:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="o">*</span><span class="nx">x</span> <span class="p">})</span>
</span><span class="line"><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span> <span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Regular Expressions</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="sr">/^a+b+$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;aaab&#39;</span><span class="p">)</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="sr">/^a+b+$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;aaa&#39;</span><span class="p">)</span>
</span><span class="line"><span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>##### Method exec(): Match and Capture Groups</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="sr">/a(b+)a/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;_abbba_aba_&#39;</span><span class="p">)</span>
</span><span class="line"><span class="p">[</span> <span class="s1">&#39;abbba&#39;</span><span class="p">,</span> <span class="s1">&#39;bbb&#39;</span> <span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The returned array contains the complete match at index 0, the capture of the first group at index 1, and so on.</p>

<h5 id="method-replace-search-and-replace">Method replace(): Search and Replace</h5>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;&lt;a&gt; &lt;bbb&gt;&#39;</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;(.*?)&gt;/g</span><span class="p">,</span> <span class="s1">&#39;[$1]&#39;</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;[a] [bbb]&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Evaluating an object literal via eval()
eval parses its argument in statement context. You have to put parentheses around an object literal if you want eval to return an object:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;{ foo: 123 }&#39;</span><span class="p">)</span>
</span><span class="line"><span class="mi">123</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;({ foo: 123 })&#39;</span><span class="p">)</span>
</span><span class="line"><span class="p">{</span> <span class="nx">foo</span><span class="o">:</span> <span class="mi">123</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Immediately invoking a function expression
The following code is an <code>immediately invoked function expression</code> (IIFE), a function whose body is executed right away
If you omit the parentheses, you get a syntax error, because JavaScript sees a function declaration, which can’t be anonymous:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;abc&#39;</span> <span class="p">}()</span>
</span><span class="line"><span class="nx">SyntaxError</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">statement</span> <span class="nx">requires</span> <span class="nx">a</span> <span class="nx">name</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>If you add a name, you also get a syntax error, because function declarations can’t be immediately invoked:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;abc&#39;</span> <span class="p">}()</span>
</span><span class="line"><span class="nx">SyntaxError</span><span class="o">:</span> <span class="nx">Unexpected</span> <span class="nx">token</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Invoking Methods on Number Literals
With method invocations, it is important to distinguish between the floating-point dot and the method invocation dot. Thus, you cannot write 1.toString(); you must use one of the following alternatives:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="mi">1</span><span class="p">..</span><span class="nx">toString</span><span class="p">()</span>
</span><span class="line"><span class="mi">1</span> <span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="c1">// space before dot </span>
</span><span class="line"><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
</span><span class="line"><span class="mf">1.0</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Strict Mode
* Variables Must Be Declared in Strict Mode
* Functions in Strict Mode</p>

<pre><code>Functions must be declared at the top level of a scope

In strict mode, all functions must be declared at the top level of a scope (global scope or directly inside a function

```
function strictFunc() {
'use strict'; {
    // SyntaxError:
    function nested() {}
} }
```
</code></pre>

<p>If you want to work around this limitation, you can create a function inside a block via a variable declaration and a function expression:</p>

<p><code>
function strictFunc() {
    'use strict'; 
    {
        // OK:
        var nested = function() {};
    }
}
</code>
* The arguments objects has fewer properties</p>

<p>The arguments object is simpler in strict mode: the properties arguments.callee and arguments.caller have been eliminated, you can’t assign to the variable arguments, and arguments does not track changes to parameters (if a parameter changes, the cor‐ responding array element does not change with it).</p>

<ul>
  <li>this is undefined in nonmethod functions</li>
</ul>

<p>In sloppy mode, the value of this in nonmethod functions is the global object (window in browsers;</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">sloppyFunc</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span> <span class="o">===</span> <span class="nb">window</span><span class="p">);</span> <span class="c1">// true</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>In strict mode, it is undefined:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">strictFunc</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">	<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class="line">	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">);</span> <span class="c1">// true </span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>This is useful for constructors. For example, the following constructor, Point, is in strict mode:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class="line">    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
</span><span class="line">    <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Due to strict mode, you get a warning when you accidentally forget new and call it as a function:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">pt</span> <span class="o">=</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class="line"><span class="nx">TypeError</span><span class="o">:</span> <span class="nx">Cannot</span> <span class="nx">set</span> <span class="nx">property</span> <span class="s1">&#39;x&#39;</span> <span class="nx">of</span> <span class="kc">undefined</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#####  Setting and Deleting Immutable Properties Fails with an Exception in Strict Mode</p>

<p>Illegal manipulations of properties throw exceptions in strict mode. For example, at‐ tempting to set the value of a read-only property throws an exception, as does attempting to delete a nonconfigurable property</p>

<p>&#8220;`
var str = ‘abc’;</p>

<p>function sloppyFunc() {
    str.length = 7; // no effect, silent failure
    console.log(str.length); // 3 
}</p>

<p>function strictFunc() {
    ‘use strict’;
    str.length = 7; // TypeError: Cannot assign to // read-only property ‘length’
}
&#8220;&#8220;</p>

<h5 id="unqualified-identifiers-cant-be-deleted-in-strict-mode">Unqualified Identifiers Can’t Be Deleted in Strict Mode</h5>

<p>In sloppy mode, you can delete a global variable foo like this:</p>

<p><code>
delete foo
</code>
In strict mode, you get a syntax error whenever you try to delete unqualified identifiers. You can still delete global variables like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">delete</span> <span class="nb">window</span><span class="p">.</span><span class="nx">foo</span><span class="p">;</span> <span class="c1">// browsers</span>
</span><span class="line"><span class="k">delete</span> <span class="nx">global</span><span class="p">.</span><span class="nx">foo</span><span class="p">;</span> <span class="c1">// Node.js</span>
</span><span class="line"><span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">foo</span><span class="p">;</span> <span class="c1">// everywhere (in global scope)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>##### eval() Is Cleaner in Strict Mode
In strict mode, the eval() function becomes less quirky: variables declared in the eval‐ uated string are not added to the scope surrounding eval() anymore.
##### Features That Are Forbidden in Strict Mode
Two more JavaScript features are forbidden in strict mode:</p>

<ul>
  <li>The <code>with</code> statementisnotallowedanymore(see“ThewithStatement”onpage153). You get a syntax error at compile time (when loading the code).</li>
  <li>Nomoreoctalnumbers:insloppymode,anintegerwithaleadingzeroisinterpreted as octal (base 8). For example:</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="mi">010</span> <span class="o">===</span> <span class="mi">8</span>
</span><span class="line"><span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>In strict mode, you get a syntax error if you use this kind of literal:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span> <span class="s1">&#39;use strict&#39;</span><span class="p">;</span> <span class="k">return</span> <span class="mi">010</span> <span class="p">}</span>
</span><span class="line"><span class="nx">SyntaxError</span><span class="o">:</span> <span class="nx">Octal</span> <span class="nx">literals</span> <span class="nx">are</span> <span class="nx">not</span> <span class="nx">allowed</span> <span class="k">in</span> <span class="nx">strict</span> <span class="nx">mode</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>####　JavaScript’s Type System
##### Coercion
In JavaScript, the main way of dealing with a value whose type doesn’t fit is to coerce it to the correct type. Coercion means implicit type conversion. Most operands coerce:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;3&#39;</span> <span class="o">*</span> <span class="s1">&#39;4&#39;</span>
</span><span class="line"><span class="mi">12</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>##### Primitive Values Versus Objects
In contrast, all primitive values encoding the same value are considered the same:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">prim1</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">prim2</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">prim1</span> <span class="o">===</span> <span class="nx">prim2</span> <span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>##### Primitives have the following characteristics:
* Compared by value</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="mi">3</span> <span class="o">===</span> <span class="mi">3</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;abc&#39;</span> <span class="o">===</span> <span class="s1">&#39;abc&#39;</span>
</span><span class="line"><span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>Always immutable</li>
</ul>

<p>Properties can’t be changed, added, or removed:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span><span class="p">;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// try to change property `length`</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// ⇒ no effect 3</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">str</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// try to create property `foo` </span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">str</span><span class="p">.</span><span class="nx">foo</span> <span class="c1">// ⇒ no effect, unknown property undefined</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>A fixed set of types</li>
</ul>

<p>You can’t define your own primitive types.</p>

<h4 id="objects">Objects</h4>
<ul>
  <li>Mutable by default</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span> <span class="c1">// add property `foo` &gt; obj.foo</span>
</span><span class="line"><span class="mi">123</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### undefined and null</p>

<ul>
  <li><code>undefined</code> means “<code>novalue</code>”(neitherprimitivenorobject).Uninitialized variables, missing parameters, and missing properties have that nonvalue. And functions <code>implicitly</code> return it if nothing has been explicitly returned.</li>
  <li><code>null</code> means “<code>no object</code>.” It is used as a nonvalue where an object is expected (as a parameter, as a member in a chain of objects, etc.).</li>
</ul>

<p>undefined and null are the only values for which any kind of property access results in an exception:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="kd">function</span> <span class="nx">returnFoo</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">foo</span> <span class="p">}</span>
</span><span class="line"> <span class="o">&gt;</span> <span class="nx">returnFoo</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span class="line"><span class="kc">undefined</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">returnFoo</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class="line"><span class="kc">undefined</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;</span> <span class="nx">returnFoo</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
</span><span class="line"><span class="nx">TypeError</span><span class="o">:</span> <span class="nx">Cannot</span> <span class="nx">read</span> <span class="nx">property</span> <span class="s1">&#39;foo&#39;</span> <span class="nx">of</span> <span class="kc">null</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">returnFoo</span><span class="p">(</span><span class="kc">undefined</span><span class="p">)</span>
</span><span class="line"><span class="nx">TypeError</span><span class="o">:</span> <span class="nx">Cannot</span> <span class="nx">read</span> <span class="nx">property</span> <span class="s1">&#39;foo&#39;</span> <span class="nx">of</span> <span class="kc">undefined</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><code>undefined</code> is also sometimes used as more of a metavalue that indicates <code>nonexistence</code>. In contrast, <code>null</code> indicates <code>emptiness</code>.</p>

<p>For example, a JSON node visitor (see “Trans‐ forming Data via Node Visitors” on page 341) returns:</p>

<ul>
  <li>undefined to remove an object property or array element </li>
  <li>null to set the property or element to null</li>
</ul>

<h5 id="occurrences-of-undefined-and-null">Occurrences of undefined and null</h5>

<h6 id="occurrences-of-undefined">Occurrences of undefined</h6>
<ul>
  <li>Uninitialized variables are undefined:</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">foo</span><span class="p">;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">foo</span> <span class="kc">undefined</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>Missing parameters are undefined:</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span> <span class="p">}</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">f</span><span class="p">()</span>
</span><span class="line"><span class="kc">undefined</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>If you read a nonexistent property, you get undefined:</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// empty object </span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">foo</span>
</span><span class="line"><span class="kc">undefined</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>And functions implicitly return undefined if nothing has been explicitly returned:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{}</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">f</span><span class="p">()</span>
</span><span class="line"><span class="kc">undefined</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">g</span><span class="p">()</span>
</span><span class="line"><span class="kc">undefined</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>###### Occurrences of null</p>

<ul>
  <li>null is the last element in the prototype chain(a chain of objects;see“Layer2:The Prototype Relationship Between Objects” on page 211):</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span>
</span><span class="line"><span class="kc">null</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>null is returned byRegExp.prototype.exec()if there was no match for the regular expression in the string:</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="sr">/x/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;aaa&#39;</span><span class="p">)</span>
</span><span class="line"><span class="kc">null</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>####  Checking for undefined or null</p>

<h4 id="checking-for-null">Checking for null</h4>
<p>You check for null via strict equality:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Checking for undefined
Strict equality (===) is the canonical way of checking for undefined:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Checking for either undefined or null
Most functions allow you to indicate a missing value via either undefined or null. One way of checking for both of them is via an explicit comparison:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// Does x have a value?</span>
</span><span class="line"><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="p">...</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">    <span class="c1">// Is x a non-value?</span>
</span><span class="line"><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">x</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="p">...</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Another way is to exploit the fact that both undefined and null are considered false</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// Does x have a value (is it truthy)?</span>
</span><span class="line"><span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="c1">// Is x falsy?</span>
</span><span class="line"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>false, 0, NaN, and ‘’ are <code>also</code> considered false.</p>

<h4 id="changing-undefined">Changing undefined</h4>
<p>undefined is a property of the global object (and thus a global variable; see “The Global Object” on page 187). Under ECMAScript 3, you had to take precautions when reading undefined, because it was easy to accidentally change its value. Under ECMAScript 5, that is not necessary, because undefined is read-only.</p>

<p>To protect against a changed undefined, two techniques were popular (they are still relevant for older JavaScript engines):
* Technique 1</p>

<p>Shadow the global undefined (which may have the wrong value):</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">...</span> <span class="c1">// safe now</span>
</span><span class="line"><span class="p">}());</span> <span class="c1">// don’t hand in a parameter</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>`
In the preceding code, undefined is guaranteed to have the right value, because it
is a parameter whose value has not been provided by the function call.</p>

<ul>
  <li>Technique 2</li>
</ul>

<p>Compare with void 0, which is always (the correct) undefined</p>

<p><code>
if (x === void 0) // always safe
</code></p>

<h4 id="wrapper-objects-for-primitives">Wrapper Objects for Primitives</h4>

<p>The three primitive types boolean, number, and string have corresponding constructors: Boolean, Number, String. Their instances (so-called wrapper objects) contain (wrap) primitive values. The constructors can be used in two ways:</p>

<ul>
  <li>Asconstructors,theycreateobjectsthatarelargelyincompatiblewiththeprimitive values that they wrap:</li>
</ul>

<p><code>
&gt; typeof new String('abc')
'object'
&gt; new String('abc') === 'abc'
false
</code>
* As functions,they convert values to the corresponding primitive types(see“Functions for Converting to Boolean, Number, String, and Object” on page 78). This is the recommended method of conversion:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="nb">String</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;123&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>It’s considered a best practice to avoid wrapper objects. You normal‐ ly don’t need them, as there is nothing that objects can do that primitives can’t (with the exception of being mutated). </p>

<h4 id="wrapper-objects-are-different-from-primitives">Wrapper Objects Are Different from Primitives</h4>
<p>Primitive values such as ‘abc’ are fundamentally different from wrapper instances such as new String(‘abc’):</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="k">typeof</span> <span class="s1">&#39;abc&#39;</span>  <span class="c1">// a primitive value</span>
</span><span class="line"><span class="s1">&#39;string&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="k">typeof</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>  <span class="c1">// an object</span>
</span><span class="line"><span class="s1">&#39;object&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;abc&#39;</span> <span class="k">instanceof</span> <span class="nb">String</span>  <span class="c1">// never true for primitives</span>
</span><span class="line"><span class="kc">false</span>
</span><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;abc&#39;</span> <span class="o">===</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
</span><span class="line"><span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Wrapper instances are objects, and there is no way of comparing objects in JavaScript, not even via lenient equals == (see “Equality Operators: === Versus ==” on page 83):</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">);</span>
</span><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">);</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">a</span> <span class="o">==</span> <span class="nx">b</span>
</span><span class="line"><span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Wrapping and Unwrapping Primitives
There is one use case for wrapper objects: you want to add properties to a primitive value. Then you wrap the primitive and add properties to the wrapper object. You need to unwrap the value before you can work with it.</p>

<p>Wrap a primitive by invoking a wrapper constructor:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span class="line"><span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</span><span class="line"><span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Unwrap a primitive by invoking the method <code>valueOf()</code>. </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">valueOf</span><span class="p">()</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="mi">123</span><span class="p">).</span><span class="nx">valueOf</span><span class="p">()</span>
</span><span class="line"><span class="mi">123</span>
</span><span class="line"><span class="o">&gt;</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">).</span><span class="nx">valueOf</span><span class="p">()</span>
</span><span class="line"><span class="s1">&#39;abc&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Converting wrapper objects to primitives properly extracts numbers and strings, but not booleans:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="nb">Boolean</span><span class="p">(</span><span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>  <span class="c1">// does not unwrap</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">Number</span><span class="p">(</span><span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="mi">123</span><span class="p">))</span>  <span class="c1">// unwraps</span>
</span><span class="line"><span class="mi">123</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">String</span><span class="p">(</span><span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">))</span>  <span class="c1">// unwraps</span>
</span><span class="line"><span class="s1">&#39;abc&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>##### Primitives Borrow Their Methods from Wrappers </p>

<p>Primitives don’t have their own methods and borrow them from wrappers:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;abc&#39;</span><span class="p">.</span><span class="nx">charAt</span> <span class="o">===</span> <span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">charAt</span>
</span><span class="line"><span class="o">&gt;</span> <span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Sloppy mode and strict mode handle this borrowing differently. In sloppy mode, prim‐ itives are <code>converted to wrappers</code> on the fly:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sloppyMethod</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">);</span> <span class="c1">// object </span>
</span><span class="line">	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nb">String</span><span class="p">);</span> <span class="c1">// true</span>
</span><span class="line"><span class="p">};</span>
</span><span class="line"><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="nx">sloppyMethod</span><span class="p">();</span> <span class="c1">// call the above method</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>In strict mode, methods from the wrapper prototype are used transparently:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">strictMethod</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class="line">	<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class="line">	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">);</span> <span class="c1">// string</span>
</span><span class="line">	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nb">String</span><span class="p">);</span> <span class="c1">// false };</span>
</span><span class="line">	<span class="s1">&#39;&#39;</span><span class="p">.</span><span class="nx">strictMethod</span><span class="p">();</span> <span class="c1">// call the above method</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Type Coercion</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;3&#39;</span> <span class="o">*</span> <span class="s1">&#39;4&#39;</span>
</span><span class="line"><span class="mi">12</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>As another example, if one of the operands is a string, the plus operator (+) converts the other one to a string:</p>

<p><code>
&gt; 3 + ' times'
'3 times'
</code>
##### Type Coercion Can Hide Bugs</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">width</span><span class="o">:</span> <span class="s1">&#39;100&#39;</span> <span class="p">};</span>
</span><span class="line"><span class="c1">// You think formData.width is a number // and get unexpected results</span>
</span><span class="line"><span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nx">formData</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
</span><span class="line"><span class="kd">var</span> <span class="nx">outer</span> <span class="o">=</span> <span class="nx">w</span> <span class="o">+</span> <span class="mi">20</span><span class="p">;</span>
</span><span class="line"><span class="c1">// You expect outer to be 120, but it’s not console.log(outer === 120); // false console.log(outer === &#39;10020&#39;); // true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>In cases such as the preceding one, you should convert to the appropriate type early on:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">formData</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>##### Functions for Converting to Boolean, Number, String, and Object
The following functions are the preferred way of converting a value to a boolean, num‐ ber, string, or object:</p>

<ul>
  <li>Boolean()
Converts a value to a boolean. The following values are converted to false; they are the so-called “falsy” values:</li>
</ul>

<p>undefined,null,false ,0,NaN, ‘’</p>

<p>*　Number() </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="err">•</span> <span class="kc">undefined</span> <span class="nx">becomes</span> <span class="kc">NaN</span><span class="p">.</span>
</span><span class="line"><span class="err">•</span> <span class="kc">null</span> <span class="nx">becomes</span> <span class="mi">0</span><span class="p">.</span>
</span><span class="line"><span class="err">•</span> <span class="kc">false</span> <span class="nx">becomes</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">true</span> <span class="nx">becomes</span> <span class="mi">1</span><span class="p">.</span>
</span><span class="line"><span class="err">•</span> <span class="nx">Strings</span> <span class="nx">are</span> <span class="nx">parsed</span><span class="p">.</span>
</span><span class="line"><span class="err">•</span> <span class="nx">Objects</span> <span class="nx">are</span> <span class="nx">first</span> <span class="nx">converted</span> <span class="nx">to</span> <span class="nx">primitives</span> <span class="p">(</span><span class="nx">discussed</span> <span class="nx">shortly</span><span class="p">),</span> <span class="nx">which</span> <span class="nx">are</span> <span class="nx">then</span> <span class="nx">converted</span> <span class="nx">to</span> <span class="nx">numbers</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>String()
Converts a value to a string. It has the obvious results for all primitives. For example:</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="nb">String</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;null&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">String</span><span class="p">(</span><span class="mf">123.45</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;123.45&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">String</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;false&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Objects are first converted to primitives (discussed shortly), which are then con‐ verted to strings.</p>

<p>*　Object()
Converts objects to themselves, undefined and null to empty objects, and primi‐ tives to wrapped primitives. For example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">foo</span><span class="o">:</span> <span class="mi">123</span> <span class="p">};</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">Object</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">===</span> <span class="nx">obj</span> <span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">Object</span><span class="p">(</span><span class="kc">undefined</span><span class="p">)</span>
</span><span class="line"><span class="p">{}</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">Object</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span> <span class="k">instanceof</span> <span class="nb">String</span>
</span><span class="line"><span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Algorithm: ToPrimitive()—Converting a Value to a Primitive
To convert a value to either a number or a string, it is first converted to an arbitrary primitive value, which is then converted to the final type</p>

<p>The ECMAScript specification has an internal function, ToPrimitive() (which is not accessible from JavaScript), that performs this conversion. Understanding ToPrimi tive() enables you to configure how objects are converted to numbers and strings. It has the following signature:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">ToPrimitive</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">PreferredType</span><span class="o">?</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The optional parameter PreferredType indicates the final type of the conversion: it is either Number or String, depending on whether the result of ToPrimitive() will be converted to a number or a string.</p>

<p>If PreferredType is Number, then you perform the following steps:</p>

<ol>
  <li>If input is primitive, return it (there is nothing more to do).</li>
  <li>Otherwise, input is an object. Call input.valueOf(). If the result is primitive, return it.</li>
  <li>Otherwise, call input.toString(). If the result is primitive, return it.</li>
  <li>Otherwise, throw a TypeError (indicating the failure to convert input to a
primitive).</li>
</ol>

<p>If PreferredType is String, steps 2 and 3 are swapped. The PreferredType can also be omitted; it is then considered to be String for dates and Number for all other values. This is how the operators + and == call ToPrimitive().</p>

<h5 id="examples-toprimitive-in-action">Examples: ToPrimitive() in action</h5>

<p>The default implementation of valueOf() returns this, while the default implementa‐ tion of toString() returns type information:</p>

<p>&#8220;`
&gt; var empty = {};
&gt; empty.valueOf() === empty </p>

<p>true
&gt; empty.toString()
‘[object Object]’
&#8220;`</p>

<p>Therefore, Number() skips valueOf() and converts the result of toString() to a num‐ ber; that is, it converts ‘[object Object]’ to NaN:</p>

<p><code>
&gt; Number({})
NaN
</code></p>

<p>The following object customizes valueOf(), which influences Number(), but doesn’t change anything for String():</p>

<p>&#8220;`
&gt; var n = { valueOf: function () { return 123 } }; &gt; Number(n)
123
&gt; String(n)
‘[object Object]’</p>

<p>&#8220;`</p>

<p>The following object customizes toString(). Because the result can be converted to a number, Number() can return a number:</p>

<p><code>
&gt; var s = { toString: function () { return '7'; } }; 
&gt; String(s)
'7'
&gt; Number(s)
7
</code></p>

<h3 id="operators">Operators</h3>
<p>#### Operators and Objects
One example where that is unfortunate is the plus operator, which many languages use for array concatenation. That’s not so with JavaScript, however, where this operator converts arrays to strings and appends them:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span class="line"><span class="s1">&#39;1,23&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">String</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span class="line"><span class="s1">&#39;1,2&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">String</span><span class="p">([</span><span class="mi">3</span><span class="p">])</span>
</span><span class="line"><span class="s1">&#39;3&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Equality Operators: === Versus ==
JavaScript has two ways of determining whether two values are equal:</p>

<ul>
  <li>Strict equality (===) and strict inequality (!==) consider only values that have the same type to be equal.</li>
  <li>Normal (or “lenient”) equality (==) and inequality (!=) try to convert values of different types before comparing them as with strict (in)equality.</li>
</ul>

<h4 id="strict-equality--">Strict Equality (===, !==)</h4>
<p>Values with different types are never strictly equal. If both values have the same type, then the following assertions hold:</p>

<ul>
  <li>undefined === undefined</li>
  <li>null === null</li>
  <li>Two numbers:</li>
</ul>

<p>&#8220;`
x === x // unless x is NaN
+0 === -0
NaN !== NaN // read explanation that follows</p>

<p>&#8220;`</p>

<ul>
  <li>
    <p>Two booleans, two strings: obvious results</p>
  </li>
  <li>
    <p>Two objects (including arrays and functions): x === y if and only if x and y are the <code>same</code> object; that is, if you want to compare different objects, you have to implement your own comparison algorithm:</p>
  </li>
</ul>

<p><code>
&gt; var b = {}, c = {}; 
&gt; b === c
false
&gt; b === b
true
</code></p>

<ul>
  <li>Everything else: not strictly equal.</li>
</ul>

<h4 id="pitfall-nan">Pitfall: NaN</h4>

<p>The special number value NaN (see “NaN” on page 106) is not equal to itself:</p>

<p><code>
&gt; NaN === NaN
false
</code>
Thus, you need to use other means to check for it, which are described in “Pitfall: checking whether a value is NaN” on page 107.
#### Strict inequality (!==)
#### Normal (Lenient) Equality (==, !=)
The algorithm for comparing via normal equality works as follows. If both operands have the same type (one of the six specification types—Undefined, Null, Boolean, Num‐ ber, String, and Object), then compare them via strict equality.</p>

<p>Otherwise, if the operands are:</p>

<ol>
  <li>
    <p>undefined and null, then they are considered leniently equal:</p>

    <p><code>
  &gt; undefined == null
 true
</code></p>
  </li>
  <li>A string and a number, then convert the string to a number and compare both operands via strict equality.</li>
  <li>A boolean and a nonboolean, then convert the boolean to a number and compare leniently (again).</li>
  <li>An object and a number or a string, then try to convert the object to a primitive (via the algorithm described in “Algorithm: ToPrimitive()—Converting a Value to a Primitive” on page 79) and compare leniently (again).</li>
</ol>

<h4 id="pitfall-lenient-equality-is-different-from-conversion-to-boolean">Pitfall: lenient equality is different from conversion to boolean</h4>

<p><code>
&gt; 2 == true
false
&gt; 2 == false
false
&gt; 1 == true
true
&gt; 0 == false
true
// 2 === 1
// 2 === 0
// 1 === 1
// 0 === 0
</code>
Similarly, while the empty string is equal to false, not all nonempty strings are equal to true:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;&#39;</span> <span class="o">==</span> <span class="kc">false</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;1&#39;</span> <span class="o">==</span> <span class="kc">true</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;2&#39;</span> <span class="o">==</span> <span class="kc">true</span>
</span><span class="line"><span class="kc">false</span>
</span><span class="line"><span class="c1">// 0 === 0</span>
</span><span class="line"><span class="c1">// 1 === 1</span>
</span><span class="line"><span class="c1">// 2 === 1</span>
</span><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;abc&#39;</span> <span class="o">==</span> <span class="kc">true</span>  <span class="c1">// NaN === 1</span>
</span><span class="line"><span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Pitfall: lenient equality and strings
Some of the leniency can be useful, depending on what you want:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="s1">&#39;abc&#39;</span> <span class="o">==</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>  <span class="c1">// &#39;abc&#39; == &#39;abc&#39;</span>
</span><span class="line"><span class="kc">true</span>
</span><span class="line"><span class="o">&gt;</span> <span class="s1">&#39;123&#39;</span> <span class="o">==</span> <span class="mi">123</span>  <span class="c1">// 123 === 123</span>
</span><span class="line"><span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Other cases are problematic, due to how JavaScript converts strings to numbers (see “Converting to Number” on page 104):</p>

<p><code>
&gt; '\n\t123\r ' == 123  // usually not OK
true
&gt; '' == 0  // 0 === 0
true
</code></p>

<h4 id="pitfall-lenient-equality-and-objects">Pitfall: lenient equality and objects</h4>

<p>If you compare an object to a nonobject, it is converted to a primitive, which leads to strange results:</p>

<p><code>
 &gt; {} == '[object Object]'
true
&gt; ['123'] == 123
true
&gt; [] == 0
true
</code>
However, two objects are only equal if they are they same object. That means that you can’t really compare two wrapper objects:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="o">===</span> <span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span class="line"><span class="kc">false</span>
</span><span class="line"><span class="o">&gt;</span> <span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span> <span class="o">===</span> <span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</span><span class="line"><span class="kc">false</span>
</span><span class="line"><span class="o">&gt;</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
</span><span class="line"><span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### There Are No Valid Use Cases for ==</p>

<ul>
  <li>Use case: checking for undefined or null
The following comparison ensures that x is neither undefined nor null:</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>replace the above with </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>If you want to be more precise, you should perform an explicit check for both values:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>Use case: working with numbers in strings
If you are not sure whether a value x is a number or a number-as-a-string, you can use checks such as the following:</li>
</ul>

<p><code>
if (x == 123) ...
</code>
The preceding checks whether x is either 123 or ‘123’. Again, this is very compact, and
again, it is better to be explicit:</p>

<p><code>
if (Number(x) === 123) ...
</code></p>

<h4 id="use-case-comparing-wrapper-instances-with-primitives">Use case: comparing wrapper instances with primitives</h4>

<p>Lenient equals lets you compare primitives with wrapped primitives:</p>

<p><code>
&gt; 'abc' == new String('abc')
true
</code>
There are three reasons against this approach. First, lenient equality does not work between wrapped primitives:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
</span><span class="line"><span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Second, you should avoid wrappers anyway. Third, if you do use them, it is better to be explicit:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">if</span> <span class="p">(</span><span class="nx">wrapped</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;abc&#39;</span><span class="p">)</span> <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### What is void used for?
Under ECMAScript 5, void is rarely useful. Its main use cases are:</p>

<ul>
  <li>void 0 as a synonym for undefined</li>
</ul>

<p>The latter can be changed, while the former will always have the correct value. However, undefined is reasonably safe from being changed under ECMAScript 5, which makes this use case less important</p>

<ul>
  <li>Discarding the result of an expression
In some situations, it is important to return undefined as opposed to the result of an expression. Then void can be used to discard that result. One such situation involves javascript: URLs, which should be avoided for links, but are useful for bookmarklets. When you visit one of those URLs, many browsers replace the cur‐ rent document with the result of evaluating the URL’s “content,” but only if the result isn’t undefined. Hence, if you want to open a new window without changing the currently displayed content, you can do the following:</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">javascript</span><span class="o">:</span><span class="k">void</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;http://example.com/&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>Prefixing an IIFE
An IIFE must be parsed as an expression. One of several ways to ensure that is by prefixing it with void (see “IIFE Variation: Prefix Operators” on page 184).2</li>
</ul>

<h4 id="categorizing-values-via-typeof-and-instanceof">Categorizing Values via typeof and instanceof</h4>
<p>If you want to categorize a value, you unfortunately have to distinguish between prim‐ itives and objects (refer back to Chapter 8) in JavaScript:</p>

<ul>
  <li>The typeof operator distinguishes primitives from objects and determines the types of primitives.</li>
  <li>The instanceof operator determines whether an object is an instance of a given constructor. </li>
</ul>

<h5 id="typeof-categorizing-primitives">typeof: Categorizing Primitives</h5>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="k">typeof</span> <span class="kc">undefined</span>
</span><span class="line"><span class="s1">&#39;undefined&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="k">typeof</span> <span class="s1">&#39;abc&#39;</span>
</span><span class="line"><span class="s1">&#39;string&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="k">typeof</span> <span class="p">{}</span>
</span><span class="line"><span class="s1">&#39;object&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="k">typeof</span> <span class="p">[]</span>
</span><span class="line"><span class="s1">&#39;object&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>##### Pitfall: typeof null
Unfortunately,typeof nullis’object’.Thisisconsideredabug(nullisnotamember of the internal type Object), but it can’t be fixed, because doing so would break existing code. You thus have to be wary of null</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">isObject</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="k">return</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="kc">null</span>
</span><span class="line">	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span>
</span><span class="line">	<span class="o">||</span> <span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">));</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;</span> <span class="nx">isObject</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</span><span class="line"><span class="kc">false</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">isObject</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
</span><span class="line"><span class="kc">false</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nx">isObject</span><span class="p">({})</span>
</span><span class="line"><span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Checking whether a variable exists</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">typeof</span> <span class="nx">x</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ol>
  <li>It determines whether x is undefined.</li>
  <li>It determines whether the variable x exists.</li>
</ol>

<h4 id="manually-converting-to-boolean">Manually Converting to Boolean</h4>

<p>Manually Converting to Boolean</p>

<ul>
  <li>Boolean(value) (Invoked as a function, not as a constructor)
value ? true : false</li>
  <li>!!value </li>
  <li>A single “not” converts to negated boolean; use twice for the nonnegated conversion.</li>
</ul>

<p>I prefer Boolean(), because it is more descriptive. </p>

<h5 id="pattern-providing-a-default-value">Pattern: providing a default value</h5>

<p>Sometimes there are situations where a value (a parameter, the result of a function, etc.) can be either a nonvalue (undefined, null) or an actual value. If you want to provide a default value for the former case, you can use the Or operator:</p>

<pre><code>theValue || defaultValue
</code></pre>

<p>The preceding expression evaluates to theValue if it is truthy and to defaultValue 
otherwise. The usual caveat applies: defaultValue will also be returned if theValue has a falsy value other than undefined and null. Let’s look at three examples of using that pattern.</p>

<ul>
  <li>Example 1: a default for a parameter
The parameter text of the function saveText() is optional and should be the empty string if it has been omitted:</li>
</ul>

<p><code>
function saveText(text) { 
	text = text || ''; ...
}
</code></p>

<table>
  <tbody>
    <tr>
      <td>This is the most common use of</td>
      <td> </td>
      <td>as a default operator. Consult “Optional Parame‐ ters” on page 173 for more on optional parameters.</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>Example 2: a default for a property</li>
</ul>

<p>The object options may or may not have the property title. If it is missing, the value ‘Untitled’ should be used when setting the title:</p>

<pre><code>setTitle(options.title || 'Untitled');
</code></pre>

<ul>
  <li>Example 3: a default for the result of a function</li>
</ul>

<p>The function countOccurrences counts how often regex matches inside str:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">countOccurrences</span><span class="p">(</span><span class="nx">regex</span><span class="p">,</span> <span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="c1">// Omitted: check that /g is set for `regex` </span>
</span><span class="line">	<span class="k">return</span> <span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">length</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Numbers
JavaScript has a single type for all numbers: it treats all of them as floating-point num‐ bers. However, the dot is not displayed if there are no digits after the decimal point:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line">	<span class="o">&gt;</span> <span class="mf">5.000</span>
</span><span class="line">	<span class="mi">5</span>
</span><span class="line">	
</span><span class="line">	<span class="o">&gt;</span> <span class="nb">Number</span><span class="p">(</span><span class="s1">&#39;\t\v\r12.34\n &#39;</span><span class="p">)</span>  <span class="c1">// ignores leading and trailing whitespace</span>
</span><span class="line">	<span class="mf">12.34</span>
</span><span class="line"><span class="err">```</span>
</span><span class="line">
</span><span class="line"><span class="err">#####</span> <span class="nb">parseFloat</span><span class="p">()</span>
</span><span class="line"><span class="o">*</span>  <span class="nx">Applying</span> <span class="nb">parseFloat</span><span class="p">()</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">nonstring</span> <span class="nx">is</span> <span class="nx">less</span> <span class="nx">efficient</span><span class="p">,</span> <span class="nx">because</span> <span class="nx">it</span> <span class="nx">coerces</span> <span class="nx">its</span> <span class="nx">argu</span><span class="err">‐</span> <span class="nx">ment</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">string</span> <span class="nx">before</span> <span class="nx">parsing</span> <span class="nx">it</span><span class="p">.</span> <span class="nx">As</span> <span class="nx">a</span> <span class="nx">consequence</span><span class="p">,</span> <span class="nx">many</span> <span class="nx">values</span> <span class="nx">that</span> <span class="nb">Number</span><span class="p">()</span> <span class="nx">converts</span> <span class="nx">to</span> <span class="nx">actual</span> <span class="nx">numbers</span> <span class="nx">are</span> <span class="nx">converted</span> <span class="nx">to</span> <span class="kc">NaN</span> <span class="nx">by</span> <span class="nb">parseFloat</span><span class="p">()</span><span class="o">:</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<blockquote>
  <p>parseFloat(true)  // same as parseFloat(‘true’)
NaN
Number(true)
1
parseFloat(null)  // same as parseFloat(‘null’)
NaN
Number(null)
0
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span></figure></notextile></p>
</blockquote>
<p>&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="o">*</span> <span class="nb">parseFloat</span><span class="p">()</span> <span class="nx">parses</span> <span class="nx">the</span> <span class="nx">empty</span> <span class="nx">string</span> <span class="nx">as</span> <span class="kc">NaN</span><span class="o">:</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;
&gt; parseFloat(‘’)
NaN
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="o">*</span>  <span class="nb">parseFloat</span><span class="p">()</span><span class="nx">ignoresleadingwhitespaceandstopsbeforeillegalcharacters</span><span class="p">(</span><span class="nx">which</span> <span class="nx">include</span> <span class="nx">whitespace</span><span class="p">)</span><span class="o">:</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;
 &gt; parseFloat(‘\t\v\r12.34\n ‘)
12.34
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="err">####</span> <span class="nx">Special</span> <span class="nb">Number</span> <span class="nx">Values</span>
</span><span class="line"><span class="nx">JavaScript</span> <span class="nx">has</span> <span class="nx">several</span> <span class="nx">special</span> <span class="nx">number</span> <span class="nx">values</span><span class="o">:</span>
</span><span class="line">
</span><span class="line"><span class="o">*</span> <span class="nx">Two</span> <span class="nx">error</span> <span class="nx">values</span><span class="p">,</span> <span class="kc">NaN</span> <span class="nx">and</span> <span class="kc">Infinity</span><span class="p">.</span>
</span><span class="line"><span class="o">*</span> <span class="nx">Two</span> <span class="nx">values</span> <span class="k">for</span> <span class="nx">zero</span><span class="p">,</span> <span class="o">+</span><span class="mi">0</span> <span class="nx">and</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span> <span class="nx">JavaScript</span> <span class="nx">has</span> <span class="nx">two</span> <span class="nx">zeros</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">positive</span> <span class="nx">zero</span> <span class="nx">and</span> <span class="nx">a</span> <span class="nx">negative</span> <span class="nx">zero</span><span class="p">,</span> <span class="nx">because</span> <span class="nx">the</span> <span class="nx">sign</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">magnitude</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">number</span> <span class="nx">are</span> <span class="nx">stored</span> <span class="nx">separately</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">most</span> <span class="nx">of</span> <span class="k">this</span> <span class="nx">book</span><span class="p">,</span> <span class="nx">I</span> <span class="nx">pretend</span> <span class="nx">that</span> <span class="nx">there</span> <span class="nx">is</span> <span class="nx">only</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">zero</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">you</span> <span class="nx">almost</span> <span class="nx">never</span> <span class="nx">see</span> <span class="k">in</span> <span class="nx">JavaScript</span> <span class="nx">that</span> <span class="nx">there</span> <span class="nx">are</span> <span class="nx">two</span> <span class="nx">of</span> <span class="nx">them</span><span class="p">.</span>
</span><span class="line">
</span><span class="line"><span class="err">####</span> <span class="nx">Pitfall</span><span class="o">:</span> <span class="nx">checking</span> <span class="nx">whether</span> <span class="nx">a</span> <span class="nx">value</span> <span class="nx">is</span> <span class="kc">NaN</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;
&gt; isNaN(NaN)
true
&gt; isNaN(33)
false
&#8220;`
However, isNaN does not work properly with nonnumbers, because it first converts those to numbers. That conversion can produce NaN and then the function incorrectly returns true:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="nb">isNaN</span><span class="p">(</span><span class="s1">&#39;xyz&#39;</span><span class="p">)</span>
</span><span class="line"><span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Thus, it is best to combine isNaN with a type check:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">myIsNaN</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="k">return</span> <span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span> <span class="o">&amp;&amp;</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Alternatively, you can check whether the value is unequal to itself (as NaN is the only value with this trait). But that is less self-explanatory:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">function</span> <span class="nx">myIsNaN</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="k">return</span> <span class="nx">value</span> <span class="o">!==</span> <span class="nx">value</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Infinity
Infinity is an error value indicating one of two problems: a number can’t be represented because its magnitude is too large, or a division by zero has happened.</p>

<p>The exponent must be between (and excluding) −1023 and 1024. If the exponent is too small, the number becomes 0. If the exponent is too large, it becomes Infinity. 21023 can still be represented, but pow(2, 1024) can’t:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1023</span><span class="p">)</span>
</span><span class="line"><span class="mf">8.98846567431158</span><span class="nx">e</span><span class="o">+</span><span class="mi">307</span>
</span><span class="line"><span class="o">&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
</span><span class="line"><span class="kc">Infinity</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Error: division by zero</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span><span class="mi">3</span><span class="o">/</span> <span class="mi">0</span>
</span><span class="line"><span class="kc">Infinity</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mi">3</span> <span class="o">/</span> <span class="o">-</span><span class="mi">0</span>
</span><span class="line"><span class="o">-</span><span class="kc">Infinity</span>
</span><span class="line"><span class="err">```</span>
</span><span class="line"><span class="err">#####</span> <span class="nx">Computing</span> <span class="kd">with</span> <span class="kc">Infinity</span>
</span><span class="line"><span class="nx">You</span> <span class="nx">get</span> <span class="nx">the</span> <span class="nx">error</span> <span class="nx">result</span> <span class="kc">NaN</span> <span class="k">if</span> <span class="nx">you</span> <span class="k">try</span> <span class="nx">to</span> <span class="err">“</span><span class="nx">neutralize</span><span class="err">”</span> <span class="nx">one</span> <span class="kc">Infinity</span> <span class="kd">with</span> <span class="nx">another</span> <span class="nx">one</span><span class="o">:</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<blockquote>
  <p>Infinity - Infinity
NaN
Infinity / Infinity
NaN
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span></figure></notextile></p>
</blockquote>
<p>&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="err">#####</span> <span class="nx">Checking</span> <span class="k">for</span> <span class="kc">Infinity</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;javascript
&gt; var x = Infinity; 
&gt; x === Infinity true</p>

<blockquote>
  <p>isFinite(5)
true
isFinite(Infinity)
isFinite(NaN)
false
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span></figure></notextile></p>
</blockquote>
<p>&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="nx">compare</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;
var EPSILON = Math.pow(2, -53); 
function epsEqu(x, y) {
	return Math.abs(x - y) &lt; EPSILON; 
}
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
<span class="line-number">2</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="err">####</span> <span class="nx">Ranges</span> <span class="nx">of</span> <span class="nx">Integers</span>
</span><span class="line"><span class="o">*</span> <span class="nx">Safeintegers</span><span class="p">,</span> <span class="nx">thelargestpracticallyusablerangeof</span> <span class="nx">integers</span> <span class="nx">that</span> <span class="nx">JavaScript</span> <span class="nx">supports</span><span class="o">:</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;
— 53 bits plus a sign, range (−253, 253)
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="o">*</span> <span class="nb">Array</span> <span class="nx">indices</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;
— 32 bits, unsigned
— Maximum length: 232−1
— Range of indices: [0, 232−1) (excluding the maximum length!)
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="o">*</span> <span class="nx">Bitwise</span> <span class="nx">operands</span>
</span><span class="line">
</span><span class="line"><span class="err">—</span> <span class="nx">Unsigned</span> <span class="nx">right</span> <span class="nx">shift</span> <span class="nx">operator</span> <span class="p">(</span><span class="o">&gt;&gt;&gt;</span><span class="p">)</span><span class="o">:</span> <span class="mi">32</span> <span class="nx">bits</span><span class="p">,</span> <span class="nx">unsigned</span><span class="p">,</span> <span class="nx">range</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">232</span><span class="p">)</span>
</span><span class="line"><span class="err">—</span> <span class="nx">All</span> <span class="nx">other</span> <span class="nx">bitwise</span> <span class="nx">operators</span><span class="o">:</span> <span class="mi">32</span> <span class="nx">bits</span><span class="p">,</span> <span class="nx">including</span> <span class="nx">a</span> <span class="nx">sign</span><span class="p">,</span> <span class="nx">range</span> <span class="p">[</span><span class="err">−</span><span class="mi">231</span><span class="p">,</span> <span class="mi">231</span><span class="p">)</span>
</span><span class="line"><span class="err">####</span> <span class="nx">Definitions</span> <span class="k">in</span> <span class="nx">ECMAScript</span> <span class="mi">6</span>
</span><span class="line"><span class="nx">ECMAScript</span> <span class="mi">6</span> <span class="nx">will</span> <span class="nx">provide</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">constants</span><span class="o">:</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;
Number.MAX_SAFE_INTEGER = Math.pow(2, 53)-1;
Number.MIN_SAFE_INTEGER = -Number.MAX_SAFE_INTEGER;
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="nx">It</span> <span class="nx">will</span> <span class="nx">also</span> <span class="nx">provide</span> <span class="nx">a</span> <span class="kd">function</span> <span class="k">for</span> <span class="nx">determining</span> <span class="nx">whether</span> <span class="nx">an</span> <span class="nx">integer</span> <span class="nx">is</span> <span class="nx">safe</span><span class="o">:</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;
Number.isSafeInteger = function (n) { 
		return (typeof n === ‘number’ &amp;&amp;
            Math.round(n) === n &amp;&amp;
            Number.MIN_SAFE_INTEGER &lt;= n &amp;&amp;
            n &lt;= Number.MAX_SAFE_INTEGER);
}
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="err">####</span> <span class="nx">Converting</span> <span class="nx">to</span> <span class="nx">Integer</span>
</span><span class="line"><span class="nx">In</span> <span class="nx">JavaScript</span><span class="p">,</span> <span class="nx">all</span> <span class="nx">numbers</span> <span class="nx">are</span> <span class="nx">floating</span> <span class="nx">point</span><span class="p">.</span> <span class="nx">Integers</span> <span class="nx">are</span> <span class="nx">floating</span><span class="o">-</span><span class="nx">point</span> <span class="nx">numbers</span> <span class="nx">without</span> <span class="nx">a</span> <span class="nx">fraction</span><span class="p">.</span> <span class="nx">Converting</span> <span class="nx">a</span> <span class="nx">number</span> <span class="nx">n</span> <span class="nx">to</span> <span class="nx">an</span> <span class="nx">integer</span> <span class="nx">means</span> <span class="nx">finding</span> <span class="nx">the</span> <span class="nx">integer</span> <span class="nx">that</span> <span class="nx">is</span> <span class="err">“`</span><span class="nx">closest</span><span class="err">`”</span> <span class="nx">to</span> <span class="nx">n</span>
</span><span class="line">
</span><span class="line"><span class="nx">use</span> <span class="nx">TheMathfunctionsMath</span><span class="p">.</span><span class="nx">floor</span><span class="p">(),</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(),</span><span class="nx">andMath</span><span class="p">.</span><span class="nx">round</span><span class="p">()</span>
</span><span class="line"><span class="err">####</span> <span class="mi">32</span><span class="o">-</span><span class="nx">bit</span> <span class="nx">Integers</span> <span class="nx">via</span> <span class="nx">Bitwise</span> <span class="nx">Operators</span>
</span><span class="line"><span class="nx">Binary</span> <span class="nx">bitwise</span> <span class="nx">operators</span> <span class="p">(</span><span class="nx">see</span> <span class="err">“</span><span class="nx">Binary</span> <span class="nx">Bitwise</span> <span class="nx">Operators</span><span class="err">”</span> <span class="nx">on</span> <span class="nx">page</span> <span class="mi">126</span><span class="p">)</span> <span class="nx">convert</span> <span class="p">(</span><span class="nx">at</span> <span class="nx">least</span><span class="p">)</span> <span class="nx">one</span> <span class="nx">of</span> <span class="nx">their</span> <span class="nx">operands</span> <span class="nx">to</span> <span class="nx">a</span> <span class="mi">32</span><span class="o">-</span><span class="nx">bit</span> <span class="nx">integer</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">then</span> <span class="nx">manipulated</span> <span class="nx">to</span> <span class="nx">produce</span> <span class="nx">a</span> <span class="nx">result</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">also</span> <span class="nx">a</span> <span class="mi">32</span><span class="o">-</span><span class="nx">bit</span> <span class="nx">integer</span><span class="p">.</span> <span class="nx">Therefore</span><span class="p">,</span> <span class="k">if</span> <span class="nx">you</span> <span class="nx">choose</span> <span class="nx">the</span> <span class="nx">other</span> <span class="nx">operand</span> <span class="nx">appropriately</span><span class="p">,</span> <span class="nx">you</span> <span class="nx">get</span> <span class="nx">a</span> <span class="nx">fast</span> <span class="nx">way</span> <span class="nx">to</span> <span class="nx">convert</span> <span class="nx">an</span> <span class="nx">arbitrary</span> <span class="nx">number</span> <span class="nx">to</span> <span class="nx">a</span> <span class="mi">32</span><span class="o">-</span><span class="nx">bit</span> <span class="nx">integer</span> <span class="p">(</span><span class="nx">that</span> <span class="nx">is</span> <span class="nx">either</span> <span class="nx">signed</span> <span class="nx">or</span> <span class="nx">unsigned</span><span class="p">).</span>
</span><span class="line">
</span><span class="line"><span class="err">#####</span> <span class="nx">Bitwise</span> <span class="nx">Or</span> <span class="p">(</span><span class="o">|</span><span class="p">)</span>
</span><span class="line"><span class="nx">If</span> <span class="nx">the</span> <span class="nx">mask</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">second</span> <span class="nx">operand</span><span class="p">,</span> <span class="nx">is</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">you</span> <span class="nx">don</span><span class="err">’</span><span class="nx">t</span> <span class="nx">change</span> <span class="nx">any</span> <span class="nx">bits</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">result</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">operand</span><span class="p">,</span> <span class="nx">coerced</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">signed</span> <span class="mi">32</span><span class="o">-</span><span class="nx">bit</span> <span class="nx">integer</span><span class="p">.</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;
 // Convert x to a signed 32-bit integer
function ToInt32(x) { 
	return x | 0;
}</p>

<blockquote>
  <p>ToInt32(1.001)
1
ToInt32(1.999)
1
ToInt32(1)
1</p>
</blockquote>

<blockquote>
  <p>ToInt32(-1)
-1
ToInt32(Math.pow(2, 32)+1)
1
ToInt32(Math.pow(2, 32)-1)
-1
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
<span class="line-number">2</span></figure></notextile></p>
</blockquote>
<p>&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="err">#####</span> <span class="nx">Shift</span> <span class="nx">operators</span>
</span><span class="line"><span class="nx">The</span> <span class="nx">same</span> <span class="nx">trick</span> <span class="nx">that</span> <span class="nx">worked</span> <span class="k">for</span> <span class="nx">bitwise</span> <span class="nx">Or</span> <span class="nx">also</span> <span class="nx">works</span> <span class="k">for</span> <span class="nx">shift</span> <span class="nx">operators</span><span class="o">:</span> <span class="k">if</span> <span class="nx">you</span> <span class="nx">shift</span> <span class="nx">by</span> <span class="nx">zero</span> <span class="nx">bits</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">result</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">shift</span> <span class="nx">operation</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">operand</span><span class="p">,</span> <span class="nx">coerced</span> <span class="nx">to</span> <span class="nx">a</span> <span class="mi">32</span><span class="o">-</span><span class="nx">bit</span> <span class="nx">integer</span><span class="p">.</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;
 // Convert x to a signed 32-bit integer
function ToInt32(x) { return x « 0;
}
// Convert x to a signed 32-bit integer
function ToInt32(x) { return x » 0;
}
// Convert x to an unsigned 32-bit integer
function ToUint32(x) { return x »&gt; 0;
}
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="nx">Here</span> <span class="nx">is</span> <span class="nx">ToUint32</span><span class="p">()</span> <span class="k">in</span> <span class="nx">action</span><span class="o">:</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;
 &gt; ToUint32(-1)
4294967295
&gt; ToUint32(Math.pow(2, 32)-1)
4294967295
&gt; ToUint32(Math.pow(2, 32))
0
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
<span class="line-number">2</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="err">#####</span> <span class="nx">The</span> <span class="nx">radix</span>
</span><span class="line"><span class="nb">parseInt</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">radix</span><span class="o">?</span><span class="p">)</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;
 &gt; parseInt(‘0xA’)
10
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="javascript"><span class="line"><span class="nx">If</span> <span class="nx">radix</span> <span class="nx">is</span> <span class="nx">already</span> <span class="mi">16</span><span class="p">,</span> <span class="nx">then</span> <span class="nx">the</span> <span class="nx">hexadecimal</span> <span class="nx">prefix</span> <span class="nx">is</span> <span class="nx">optional</span><span class="o">:</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;
&gt; parseInt(‘0xA’, 16)
10
&gt; parseInt(‘A’, 16)
10</p>

<blockquote>
  <p>parseInt(‘12.34’, 10)
12
parseInt(12.34, 10)
12
parseInt(‘110’, 2)
6
&#8220;`</p>
</blockquote>

<p>Don’t use parseInt() to convert a number to an integer. Here is an example where the conversion is incorrect:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="nb">parseInt</span><span class="p">(</span><span class="mf">1000000000000000000000.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><span class="line"><span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><code>Explanation</code>
The argument is first converted to a string:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="nb">String</span><span class="p">(</span><span class="mf">1000000000000000000000.5</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;1e+21&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>parseInt doesn’t consider “e” to be an integer digit and thus stops parsing after the 1.
parseInt() shouldn’t be used to convert numbers to integers: coercion to string is an unnecessary detour and even then, the result is not always correct.</p>

<ul>
  <li>num.toString(2)(see“Number.prototype.toString(radix?)”onpage129)converts the number num to a string in binary notation. For example:</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="mi">6</span><span class="p">..</span><span class="nx">toString</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;110&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>##### Bitwise Shift Operators
JavaScript has three bitwise shift operators:</p>

<ul>
  <li>number « digitCount (left shift):</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;10&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>number » digitCount (signed right shift):</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="s1">&#39;11111111111111111111111111111110&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;-1&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>number »&gt; digitCount</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="s1">&#39;11100&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">1</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;1110&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Number Prototype Methods
* Number.prototype.toFixed(fractionDigits?)</p>

<p>Number.prototype.toFixed(fractionDigits?) returns an exponent-free representa‐ tion of the number, rounded to fractionDigits digits. If the parameter is omitted, the value 0 is used:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="mf">0.0000003</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;0.0000003000&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mf">0.0000003</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
</span><span class="line"><span class="s1">&#39;3e-7&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>If the number is greater than or equal to 1021, then this method works the same as toString(). You get a number in exponential notation:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="o">&gt;</span> <span class="mi">1234567890123456789012</span><span class="p">..</span><span class="nx">toFixed</span><span class="p">()</span>
</span><span class="line"><span class="s1">&#39;1.2345678901234568e+21&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mi">1234567890123456789012</span><span class="p">..</span><span class="nx">toString</span><span class="p">()</span>
</span><span class="line"><span class="s1">&#39;1.2345678901234568e+21&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>Number.prototype.toPrecision(precision?)</li>
</ul>

<p>Number.prototype.toPrecision(precision?) prunes the mantissa to precision dig‐ its before using a conversion algorithm similar to toString(). If no precision is given, toString() is used directly:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="mi">1234</span><span class="p">..</span><span class="nx">toPrecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;1.23e+3&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mi">1234</span><span class="p">..</span><span class="nx">toPrecision</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;1234&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mi">1234</span><span class="p">..</span><span class="nx">toPrecision</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;1234.0&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mf">1.234</span><span class="p">.</span><span class="nx">toPrecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;1.23&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>Number.prototype.toString(radix?)</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">..</span><span class="nx">toString</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;1111&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mi">65535</span><span class="p">..</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;ffff&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>Number.prototype.toExponential(fractionDigits?)</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"> <span class="o">&gt;</span> <span class="mi">1234567890123456789012</span><span class="p">..</span><span class="nx">toString</span><span class="p">()</span>
</span><span class="line"><span class="s1">&#39;1.2345678901234568e+21&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mi">1234567890123456789012</span><span class="p">..</span><span class="nx">toExponential</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;1.23456789012345677414e+21&#39;</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="o">&gt;</span> <span class="mi">1234</span><span class="p">..</span><span class="nx">toString</span><span class="p">()</span>
</span><span class="line"><span class="s1">&#39;1234&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mi">1234</span><span class="p">..</span><span class="nx">toExponential</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;1.23400e+3&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mi">1234</span><span class="p">..</span><span class="nx">toExponential</span><span class="p">()</span>
</span><span class="line"><span class="s1">&#39;1.234e+3&#39;</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"> <span class="o">&gt;</span> <span class="mf">0.003</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
</span><span class="line"><span class="s1">&#39;0.003&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mf">0.003</span><span class="p">.</span><span class="nx">toExponential</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span class="line"><span class="s1">&#39;3.0000e-3&#39;</span>
</span><span class="line"><span class="o">&gt;</span> <span class="mf">0.003</span><span class="p">.</span><span class="nx">toExponential</span><span class="p">()</span>
</span><span class="line"><span class="s1">&#39;3e-3&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-10T09:20:02+08:00" data-updated="true" itemprop="datePublished">Oct 10<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/sencha/'>Sencha</a>, <a class='category' href='/blog/categories/touch/'>Touch</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/10/build/" itemprop="url">Build</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h4 id="adding-non-mvc-folders-to-your-build-package">Adding Non-MVC Folders to Your Build Package</h4>
<p>For the FindACab app, I have added the utils folder to the app classpath in ./sencha/sencha.cfg:</p>

<pre><code>app.classpath=${app.dir}/app.js,${app.dir}/app,${app.dir}/utils
</code></pre>

<h4 id="adding-extra-resources-to-your-build-package">Adding Extra Resources to Your Build Package</h4>

<p>In other situations, you might want to include extra resources to your build package — for example, a folder with images or a folder with JSON data. There are two ways to include these in your build. I will explain both. First (the easy way, shown in Example 14-1), you can add the folder to the resources array in the <code>app.json</code> file. By default, Sencha Cmd already created a selection.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
	#Example 14-1. Additional resources that need to be copied during the build process
</span><span class="line">
</span><span class="line">"resources": [ 
</span><span class="line">	"resources/images", 
</span><span class="line">	"resources/css", 
</span><span class="line">	"resources/icons", 
</span><span class="line">	"resources/startup"
],

```
</span><span class="line">
`TIP`
</span><span class="line">
Additional JavaScripts or stylesheets can be entered into the `js` or `css` arrays.
</span><span class="line">
The other way of adding resources to your build is what I call the hardcore way, but it’s kinda cool so I want to mention it.
</span><span class="line">
Sencha Cmd has Apache Ant integration. You can modify the Ant build script build.xml totally to your own needs.
</span><span class="line">
See Example 14-2; this little Ant script copies a data folder from the application root to the production build folder. Isn’t it awesome?
</span><span class="line">
```
</span><span class="line">// Example 14-2. Copying a folder to a different location
</span><span class="line">&lt;target name="-after-build"/&gt; 
</span><span class="line">&lt;target name="build"
		depends="init,-before-build,-build,-after-build" 
		description="Builds the application"/&gt;
</span><span class="line">
		
&lt;copy todir="${build.dir}/data" overwrite="true"&gt; 
	&lt;fileset dir="${basedir}/data"&gt;
		&lt;include name="**/*" /&gt; 
	&lt;/fileset&gt;
&lt;/copy&gt;

```
</span><span class="line">In the next sections, you’ll learn how to:
</span><span class="line">
</span><span class="line">* Create a test build with Sencha Cmd
* Create a production build with Sencha Cmd
* Create a native build with Sencha Cmd and Adobe PhoneGap
</span><span class="line">
#### Creating a Test Build with Sencha Cmd
</span><span class="line">
With Sencha Cmd on the command line, you can generate a build package optimized for test environments. On the command line, navigate to the app folder and run the following:
</span><span class="line">
```
</span><span class="line">	sencha app build testing
```
</span><span class="line">
`NOTE`
</span><span class="line">
I’m often asked which tools are good for testing a Sencha Touch application. For UI testing, Siesta is a good tool; for syntax testing, you could use JS Lint; and for unit testing, Jasmine is a popular testing tool. For more information, check out this [great blog post](http://www.sencha.com/blog/automating-unit-tests), which contains all the links to the tools
</span><span class="line">
</span><span class="line">#### Creating a Production Build with Sencha Cmd
</span><span class="line">With Sencha Cmd on the command line, you can generate a build package optimized for production. On the command line, navigate to the app folder and run the following:
</span></code></pre></td></tr></table></div></figure></notextile></div>
<pre><code>sencha app build ```
</code></pre>

<h4 id="creating-a-native-build-with-sencha-cmd-and-adobe-phonegap">Creating a Native Build with Sencha Cmd and Adobe PhoneGap</h4>

<p>There are three products you can use to create a native app from a Sencha Touch code base:</p>

<ul>
  <li>Sencha Mobile Packager </li>
  <li>Adobe PhoneGap </li>
  <li>Apache Cordova</li>
</ul>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-09T18:40:26+08:00" data-updated="true" itemprop="datePublished">Oct 9<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/sencha/'>Sencha</a>, <a class='category' href='/blog/categories/touch/'>Touch</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/09/themes-and-styles/" itemprop="url">Themes and Styles</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Mobile web applications should either look and behave <code>exactly</code> the same as native apps, or they shouldn’t look like native at all</p>

<h4 id="sencha-touch-stylesheets">Sencha Touch Stylesheets</h4>
<p>In Sencha Touch version 2.3, the framework ships with stylesheets that mimic native designs and experiences of all modern major devices </p>

<p>When you create a production build of your app and you want to host it on the Web, it’s even possible to make use of the Sencha platform switcher. This switcher can make sure that the correct stylesheet will be shown for each platform. For example, the BB10 theme will be used when the platform is BlackBerry and show the Windows theme when the app is being viewed on Internet Explorer 10.</p>

<h4 id="using-sass">Using Sass</h4>

<p>Sass stands for “syntactically awesome style sheets,” a powerful CSS extension. And yes, it is awesome! I describe it as CSS infused with a lot of coffee and Red Bull, because it overcomes many of the shortcomings of CSS.</p>

<p>Sass is a preprocessor, which means that Sass files should be compiled to (minified) CSS files. A CSS file is the stylesheet your browser uses to display Sencha Touch components. (And that’s also the file that goes into your production build or server.) Therefore, Sass needs a compiler. You can compile Sencha Sass themes with Sass and Compass installed on top of Ruby (see Appendix A), but if you are not really into design, you can also use just the <code>Sencha Cmd build</code> process. A Sencha app build can compile Sass files too, but it just takes a little bit longer.</p>

<p>Sass has two syntaxes. </p>

<ul>
  <li>
    <p>The most commonly used syntax is known as <code>SCSS</code> (which stands for Sassy CSS), and is a superset of CSS3’s syntax. This means that every valid CSS3 stylesheet is valid SCSS as well. SCSS files use the extension <code>.scss</code>.</p>
  </li>
  <li>
    <p>The second, older syntax is known as the indented syntax (or just .sass). Instead of brackets and semicolons, it uses line indentation to specify blocks. Files in the indented syntax use the extension <code>.sass</code>.</p>
  </li>
</ul>

<p>The Sencha themes are <code>Sassy CSS files</code>. You can combine CSS3 syntax with the amazing features of Sass.</p>

<p>In this chapter, you’ll learn how to:</p>

<ul>
  <li>Use platform-specific out-of-the-box themes </li>
  <li>Create your own custom theme</li>
  <li>Incorporate custom fonts</li>
  <li>Incorporate custom icons</li>
  <li>Optimize your stylesheet for best performance</li>
</ul>

<p>Sencha Cmd 4 and higher have the command <code>sencha app watch</code>, You can compare this with the Compass command <code>compass watch</code>,. Sencha Cmd watches the app and every time you hit Save, Sencha Cmd builds your app and compiles your Sass stylesheets. When changes are detected, only the minimum amount of work necessary is performed to bring your app and its CSS up to date, saving you from rebuilding your Sass. It is so quick that when you navigate to your browser, the latest version is present
After writing your Sass theme, use the following command from the resources/sass folder to compile to app.css:</p>

<p><code>
sencha ant sass
</code>
<code>TIP</code>
There are some great resources on Sass and CSS at <a href="http://sass-lang.com/">the Sass website</a>. To learn more about Sass, see <a href="http://vimeo.com/75258560">The Sass Way. Learn Sass at Code School</a>, and check out “Unleash Your Inner Picasso: Advanced Theming by Platform,” an online video tutorial by Robert Dogan
#### Incorporating Custom Fonts
When you want to incorporate fonts in your theme, you can use <code>@font-face</code>. @font- face is a CSS technique that is often used to incorporate custom web fonts. Where system fonts will be visible only if they’re available on your OS, @font-face directly <code>downloads</code> the font from the Internet to display it</p>

<p><code>TIP</code></p>

<p>Read more about @font-face on <a href="http://www.paulirish.com/2010/font-face-gotchas/">Paul Irish’s blog</a> and download HTML5 @font-face kits from <a href="http://www.fontsquirrel.com/">Font
Squirrel</a> or at font ex. You can also use a font service like Adobe <a href="https://typekit.com/">Typekit</a> or <a href="http://www.google.com/fonts">Google Fonts</a>.</p>

<p>Check out the <a href="http://pictos.cc/font/">Pictos icon font</a>, the <a href="https://icomoon.io/">Ico Moon icon font</a>, and the Fontello icon font. There’s more information about icon fonts at <a href="http://css-tricks.com/html-for-icon-font-usage/">CSS-Tricks</a>, and you can use <a href="https://www.branah.com/unicode-converter">Branah’s tool</a> to convert text to unicodes and back.</p>

<h4 id="optimizing-your-stylesheet-for-best-performance">Optimizing Your Stylesheet for Best Performance</h4>

<ul>
  <li>Minify your stylesheet</li>
  <li>Import only the required mixins in your stylesheet </li>
  <li>Exclude experimental support for uncommon browsers </li>
  <li>Exclude unusable default fonts and icons</li>
</ul>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-08T22:18:11+08:00" data-updated="true" itemprop="datePublished">Oct 8<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/sencha/'>Sencha</a>, <a class='category' href='/blog/categories/touch/'>Touch</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/08/view-components/" itemprop="url">View Components</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>This chapter is all about view components. I will discuss how to implement messageboxes, lists, panels, toolbars, charts, and maps</p>

<p>In this chapter, you’ll learn how to implement:</p>

<ul>
  <li>A messagebox Toolbars and title bars Buttons</li>
  <li>Lists</li>
  <li>A Google Map</li>
  <li>Overlays Charts</li>
</ul>

<h4 id="implementing-a-messagebox">Implementing a Messagebox</h4>

<p>Unlike the standard JavaScript <code>alert</code> method, a messagebox in Sencha Touch is <code>asynchronous</code>. In standard JavaScript, the browser pauses execution until you press OK. In Sencha Touch, showing a messagebox will not cause the code to stop. For this reason, if you have code that should run only after some user feedback from the messagebox, you should use a callback function.</p>

<p>When you want to implement a messagebox, you will have to require Ext.MessageBox at the top of your view class. You don’t need to instantiate a messagebox (although you could); Ext.Msg is a global shared singleton instance of the Ext.MessageBox class that you can use in most cases:</p>

<p>The previous code describes the alert() method, which you can visually compare with the standard alert messagebox in JavaScript. See Figure 11-1.</p>

<p><img src="/images/2014/10/figure11-1.png" /></p>

<p>It displays a small window, with a title, a message, and an OK button. In addition to the
alert, there are these types of messageboxes:</p>

<ul>
  <li>prompt(), shown in Figure 11-2, which is a messagebox with a title, message, a textfield, and Cancel and OK buttons</li>
  <li>confirm(), shown in Figure 11-3, which is a messagebox with a title, a message, and No and Yes buttons</li>
  <li>show(), which provides even more options.</li>
</ul>

<p>Here’s an example of the prompt() messagebox; the callback contains the button id and the entered value. The button id can be Yes, No, or Cancel (Cancel means close the messagebox without pressing the Yes and No buttons):</p>

<p><code>
Ext.Msg.prompt('Welcome', 'Please enter your name', function(btn, val) { //callback
    console.log(btn, val);
});
</code></p>

<p>There is one more messagebox method that is worth mentioning: show().The show() method will give you many more options; you can pass in a config object. Here I set up
a customized prompt() messagebox. It has a width of 500 pixels, it accepts multiline input, it has an info icon, and I want to specify my own set of buttons. Also, I will define a callback function:</p>

<p><code>
var myPromptBox = Ext.Msg.show({
    title: 'Address',
    message: 'Please enter your address:',
    width: 500,
    buttons: Ext.MessageBox.YESNOCANCEL,
    iconCls: Ext.MessageBox.QUESTION,
    multiLine: true,
    prompt: {
        maxlength: 180,
        autocapitalize: true
    },
    fn: function(buttonId) {
        alert('You pressed the "' + buttonId + '" button.');
    }
});
</code>
The iconCls can set an icon CSS class on the messagebox to showcase an icon. You can maintain this in your theme, but out of the box Sencha Touch ships with the following messagebox icons:</p>

<ul>
  <li>Ext.MessageBox.ERROR (a round error sign) </li>
  <li>Ext.MessageBox.INFO (a round info sign) </li>
  <li>Ext.MessageBox.QUESTION (a question mark) </li>
  <li>Ext.MessageBox.WARNING (a warning sign)</li>
</ul>

<p>The following sets of buttons are available in Sencha Touch:</p>

<ul>
  <li>Ext.MessageBox.OK (OK button with action UI skin)</li>
  <li>Ext.MessageBox.YES (Yes button with action UI skin)</li>
  <li>Ext.MessageBox.NO (No button)</li>
  <li>Ext.MessageBox.CANCEL (Cancel button)</li>
  <li>Ext.MessageBox.YESNOCANCEL (Cancel button, No button, and Yes button with action UI skin)</li>
  <li>Ext.MessageBox.OKCANCEL (Cancel button, and OK button with action UI skin) * Ext.MessageBox.YESNO (No button, and Yes button with action UI skin)</li>
</ul>

<p>If these button sets are in the wrong order, or you would like to specify your own button text and UI skins, you can pass in an array with Ext.Buttons into the buttons config, as you can see in Figure 11-4:</p>

<p><code>
var pirateBox = Ext.Msg.show({
    title: 'Ahoy!',
    message: 'Stop pirate, would ye like t\' proceed?',
    iconCls: Ext.MessageBox.ERROR,
    width: 200,
    buttons: [{
        text: 'Aye',
        itemId: 'yes',
        ui: 'action'
    }, {
        text: 'Avast',
        itemId: 'no',
        ui: 'decline'
    }],
    fn: function(buttonId) {
        alert('You pressed the "' + buttonId + '" button.');
    }
});
</code>
<img src="/images/2014/10/figure11-4.png" /></p>

<p>To hide the previous messagebox, just run the hide() method on the pirateBox.</p>

<h4 id="implementing-toolbars-and-title-bars">Implementing Toolbars and Title Bars</h4>
<p>When you want to implement a toolbar (or title bar) view component (Figure 11-5), you will have to add the Ext.Toolbar (or Ext.TitleBar) to the requires at the top of your view class. After that, you can instantiate the component by using the Ext.create(“Ext.Toolbar”, {}) syntax, or by lazy instantiating (nesting the xtype called toolbar). Using the xtype is the best practice for coding real-world MVC applications.</p>

<p><img src="/images/2014/10/figure11-5.png" /></p>

<p>Implementing a title bar works exactly the same. The only difference is that the class from which you implement the instance is called Ext.TitleBar and the xtype is called titlebar. Although the title bar does not extend from Ext.Toolbar, they have a very similar appearance and setup.</p>

<p>The main difference between a Ext.TitleBar and a Ext.Toolbar is that the title config is always centered horizontally in a title bar, between any items aligned left or right. By default, any item in a title bar or toolbar is a button, so you do not need to explicitly set it. Items in a title bar, such as buttons, can be docked to the left or right side of the bar, via the align config.</p>

<h4 id="implementing-lists">Implementing Lists</h4>
<p>A list is a data-aware component. You will need to hook up a data store to the list (with a fields model) to display any items. Following is an example of an Ext.List. First you must make sure you add the Ext.List to the requires array at the top of your view class so the Ext.Loader can load the framework class. Afterward you will use the object literal notation to create a Sencha Touch list:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class=""><span class="line">{
</span><span class="line">    xtype: 'list',
</span><span class="line">    store: {
</span><span class="line">        fields: ['name'],
</span><span class="line">        data: [{
</span><span class="line">            name: 'Leonardo'
</span><span class="line">        }, {
</span><span class="line">            name: 'Donatello'
</span><span class="line">        }, {
</span><span class="line">            name: 'Michelangelo'
</span><span class="line">        }, {
</span><span class="line">            name: 'Raphael'
</span><span class="line">        }]
</span><span class="line">    },
</span><span class="line">    itemTpl: '{name}'
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-07T22:09:31+08:00" data-updated="true" itemprop="datePublished">Oct 7<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/sencha/'>Sencha</a>, <a class='category' href='/blog/categories/touch/'>Touch</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/07/offline-storage-client-proxies/" itemprop="url">Offline Storage (Client Proxies)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>HTML5 offers a powerful way to achieve this with Local Storage, Session Storage, Web SQL, and Application Cache.</p>

<ul>
  <li>
    <p>HTML5 Local Storage</p>

    <p>HTML5 Local Storage saves its data with no expiration date. You use it to save key/value pairs. The Sencha framework uses it internally to save persisted JavaScript (Sencha) classes. When you open a Sencha Touch app while you are offline, the Sencha Touch app itself can run because all the assets are stored offline in the Local Storage. The FindACab app makes use of Local Storage by saving the user settings offline.</p>
  </li>
  <li>
    <p>HTML5 Session Storage</p>

    <p>This method saves its data in a session. The session will be over after the browser is closed. This is the main difference from Local Storage, which won’t lose its data at all. Usually, the HTML5 Session Storage is used for online shopping baskets. It stores all the products in the session. After the products are purchased, the session can be cleared.</p>
  </li>
  <li>
    <p>Web SQL Databases</p>

    <p>This method, formerly known as “WebDB,” provides a thin wrapper around a SQL database. In 2007, Google launched Google Gears, an open source cross-browser plug-in that included an embedded database based on SQLite. This early prototype later influenced the creation of the HTML5 Web SQL Database specification.</p>
  </li>
  <li>
    <p>Application Cache</p>

    <p>This can make your application available offline, and can cache files and assets into the browser. You will need to <code>set up an AppCache manifest file</code>.</p>
  </li>
</ul>

<p><code>CAUTION</code></p>

<p>There is a SQL client proxy available in Sencha Touch 2.3. However, unfortunately, on November 18, 2010, the W3C announced that Web SQL database is a deprecated specification. This means that web developers should no longer use the technology, as the spec will receive no further updates, and browser vendors aren’t encouraged to support this technology. You can still use Web SQL databases in Google Chrome and in Safari browsers, but at your own risk. That said, it works very well with Sencha Touch, and there is no officially supported alternative.
You might want to check out IndexDB instead. See Grgur Grisogono’s <a href="https://github.com/grgur/Ext.data.proxy.IndexedDB">Sencha IndexDB Proxy</a>.</p>

<p>The Sencha Touch client proxy saves and loads the data locally on its device or in its
memory. Sencha Touch’s client proxy has four important subclasses:</p>

<ul>
  <li>Ext.data.proxy.Memory </li>
  <li>Ext.data.proxy.LocalStorage </li>
  <li>Ext.data.proxy.SessionStorage </li>
  <li>Ext.data.proxy.Sql
The <code>MemoryProxy</code> uses a local variable for data storage and retrieval, but the contents are lost on every page refresh. For that reason, I will not discuss it in this chapter.</li>
</ul>

<p>This is not the case with the <code>LocalStorage</code> proxy, the <code>SessionStorage</code> proxy, and the <code>SQL</code> proxy. When the browser provides support for these, it will save the model data as a key/value data store into the browser, so it will remain after the browser is closed and reopened. If the HTML5 Storage API is not supported by the browser, the constructor will throw an error.</p>

<p>This is not the case with the LocalStorage proxy, the SessionStorage proxy, and the SQL proxy. When the browser provides support for these, it will save the model data as a key/value data store into the browser, so it will remain after the browser is closed and reopened. If the HTML5 Storage API is not supported by the browser, the constructor will throw an error.</p>

<p>Because the data is saved as key/value pairs, where the key needs to be unique, you cannot save complex objects like JSON — unless you convert these JSON objects to strings with Ext.JSON.encode(). LocalStorageProxy automatically serializes and deserializes data when saving and retrieving it.</p>

<p>Here is an example showing how to implement a client proxy to your model or store class:</p>

<p><code>
proxy: {
	type: "&lt;client-proxy&gt;"
}
</code></p>

<p>The type can be set to <code>memory</code> (the default), <code>localstorage</code>, <code>sessionstorage</code>, or <code>sql</code>.
In this chapter, you’ll learn:</p>

<ul>
  <li>How to save data into Local Storage</li>
  <li>How to save data into Session Storage</li>
  <li>How to save data into a Web SQL database</li>
  <li>How to save assets locally by using the Application Cache</li>
</ul>

<h4 id="saving-data-into-local-storage">Saving Data into Local Storage</h4>

<p><code>CAUTION</code></p>

<p>When this proxy is used in a browser where Local Storage is not supported, the constructor will throw an error.</p>

<p>Every key/value pair in the Local Storage should have a unique key, to refer to its model data. Sencha Touch can generate a unique record id for you; you will only need to set an id on the proxy, which will be <code>prefixed</code> to the unique record id to make the Local Storage key.</p>

<p>In the FindACab app, you will use the LocalStorage proxy for saving user settings locally on the device. The Settings model in the FindACab app will contain a proxy like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
</pre></td><td class="code"><pre><code class=""><span class="line">proxy: {
	type: 'localstorage', 
	id: "Setting"
}
```
</span><span class="line">
Note that the key/value pairs in the client proxies are strings! When you retrieve this data later from a store — by using, for example, the command Ext.getStore("MyStore").getAt(0) — it will decode this string to a JavaScript object for you. In other words, it serializes and deserializes data `automatically` when saving or retrieving it. Awesome!
</span><span class="line">
An example Local Storage key/value pair for the FindACab app could look like this:
</span><span class="line">
```
</span><span class="line">"Setting-51726e64-ae85-4fe8-9bea-aa085f499da6" : "{ 
</span><span class="line">	"id":"51726e64-ae85-4fe8-9bea-aa085f499da6", 
</span><span class="line">	"gps":null,
</span><span class="line">	"city":"Amsterdam",
	"country":"NL" 
</span><span class="line">}"
```
</span><span class="line">
To generate an id with Sencha Touch, you need to implement an id strategy. There are three strategies you can use:
</span><span class="line">
</span><span class="line">* `Ext.data.identifier.Sequential` is a sequential id generator. It generates ids in sequential order (1, 2, 3, etc.).
* `Ext.data.identifier.Simple` is the default id generator in Sencha Touch. It generates ids in sequential order, prefixed with a prefix parameter. When no prefix parameter is set, it prefixes ids by default with ext-record- (e.g., ext- record-1, ext-record-2, ext-record-3, etc.).
* `Ext.data.identifier.Uuid` is a UUID (Universally Unique IDentifier, also known as GUIDs (Globally Unique IDentifier generator). A UUID is a 128-bits id that can guarantee uniqueness across space and time. UUIDs were originally used in the Apollo Network Computing System and later in the Open Software Foundation’s (OSF) Distributed Computing Environment (DCE), and then in Microsoft Windows platforms.
</span><span class="line">
To set an id strategy, you have to require one of the identifiers at the top of your model; for example: `requires: ["Ext.data.identifier.Uuid]`. The model should also have the idProperty set to the model field that can be used as an id, which defaults to the fieldname: id. (Make sure the field type matches!) In addition, the model should contain the identifier property. In this case, it can be set to uuid, which is why you are requiring this class at the top of the file.
</span><span class="line">
Let’s take a look at the full code for the Settings model of the FindACab app, FindACab.model.Setting:
</span><span class="line">
```
</span><span class="line">Ext.define('FindACab.model.Setting', {
</span><span class="line">        extend: 'Ext.data.Model',
</span><span class="line">        requires: ['Ext.data.identifier.Uuid'],
</span><span class="line">        config: {
</span><span class="line">            idProperty: 'id',
</span><span class="line">            identifier: 'uuid',
</span><span class="line">            fields: [{
</span><span class="line">                name: 'id',
</span><span class="line">                type: 'auto'
</span><span class="line">            }, {
</span><span class="line">                name: 'gps',
</span><span class="line">                type: 'boolean'
</span><span class="line">            }, {
</span><span class="line">                name: 'city',
</span><span class="line">                type: 'string'
</span><span class="line">            }, {
</span><span class="line">                name: 'country',
</span><span class="line">                type: 'string'
</span><span class="line">            }],
</span><span class="line">            validations: [{
</span><span class="line">                type: 'presence',
</span><span class="line">                field: 'city',
</span><span class="line">                message: "Please provide a city."
</span><span class="line">            }, {
</span><span class="line">	            type: 'presence',
				field: 'country',
				message: "Please provide a country."
</span><span class="line">            }],
</span><span class="line">            proxy: {
</span><span class="line">                type: 'localstorage',
</span><span class="line">                id: "Setting"
</span><span class="line">            }￼￼￼
</span><span class="line">        }
```
</span><span class="line">
#### Saving Data into Session Storage
</span><span class="line">
```
</span><span class="line">proxy: {
	type: "sessionstorage", 
	id: "session-id-prefix"
}
```
</span><span class="line">
</span><span class="line">#### Saving Data into a Web SQL Database for the FindACab App
</span><span class="line">
`TIP`
</span><span class="line">
Isn’t it annoying that you cannot delete a Web SQL database directly with the Google Chrome Dev Tools? Well, there is a solution to remove a database (and its tables). Just open the following URL in your Google Chrome browser: chrome://settings/cookies. Here you can search for any particular site or remove all locally stored data. In my case, I just search for localhost, and I get an exact overview of all my cookies, Local Storage, and Web SQL databases. I can double-click a database, and I’ll be prompted to remove the database. I click the Remove button, and it is gone!
</span><span class="line">
#### Saving Assets Locally by Using the Application Cache
</span><span class="line">
it is a technique for making your application available offline, without downloading the stylesheets, images, Sencha Touch framework, and custom classes. It will create a cached version of your mobile app by setting up a HTML5 cache manifest file, better known as the HTML5 AppCache.
</span><span class="line">
AppCache is extremly handy for users who want to bookmark their mobile apps to their phone home screen. This is nice because the browser address bar will be gone, so it will give you a more native experience.
</span><span class="line">
Whereas Web Storage saves key/value pairs in the browser’s Local or Session Storage, AppCache has the HTML5 ability to save (cache) a whole web app (the index.html file and all its assets, such as stylesheets, JavaScript, images, icons, fonts, etc.) in the browser’s cache to make it available, even if the client has no Internet connection at all.
</span><span class="line">
The Application Cache manifest file is a simple text file that lists the resources that the browser should cache for offline access. Another reason for using AppCache is speed (because it caches and therefore loads faster) and performance (it reduces server load).
</span><span class="line">
`TIP`
</span><span class="line">
[Read the W3C spec about AppCache](http://www.w3.org/TR/offline-webapps/#offline). Also, take a look at [Jake Archibald’s blog post](http://alistapart.com/article/application-cache-is-a-douchebag) at A List Apart about troubleshooting AppCache.
</span><span class="line">
Now how can you implement this? You don’t have to do much to make Application Cache work. First, you will have to edit the app.json file; it should define the appCache object. Let’s take a look:
</span><span class="line">
```
</span><span class="line">"appCache": { 
</span><span class="line">	"cache": [
		"index.html",
		"resources/css/app.css"
	],
```
The cache section lists all the items that need to be cached. Make sure that these files
exist, or else the caching will fail (and if it fails, you will not be happy):
</span><span class="line">
```
</span><span class="line">"network": [ 
</span><span class="line">	"*"
],
```
</span><span class="line">
The `network` section is basically used for (white) listing files that require an online connection. All requests to these resources `bypass the cache`, even if the browser is offline. Note you can also set this to a wildcard, *. This might be handy when the files from the cache section are cached but some assets are not listed and therefore missing. It will make sure that those unlisted assets will still be downloaded, no matter what. If I didn’t create a network section that points to the wildcard, then the application would miss these files:
</span><span class="line">
```
</span><span class="line">	"fallback": [
		//fall back items
	￼
</span><span class="line">	]
}//end appCache
```
</span><span class="line">The fallback section in the app cache file will let us list fallback solutions for when a request fails. See, for example, the line `resources/images/resources/images/placeholder.gif`. If any image in the resources/images folder fails, it will display the placeholder.png file.
</span><span class="line">
</span><span class="line">Then build the application with Sencha Cmd:
</span></code></pre></td></tr></table></div></figure></notextile></div>
<pre><code>sencha app build ``` Be aware that the Application Cache can be a pain sometimes for the following reasons:
</code></pre>

<ul>
  <li>You cannot specify an expiration date/time for files in the cache. But you can expire the cache by making a change to the manifest file — for example, by adding a comment. Any change to the file causes all files to be recached. This is what Sencha does: it changes the Application Cache manifest by adding comments that represent generated unique keys.</li>
  <li>If any of the files listed on the manifest are not found, no caching will occur.</li>
  <li>While waiting for the manifest file, the browser will load the site <code>from the cache</code>. Therefore, changes to your cache manifest are acted upon only after a <code>second</code> refresh from when the file was modified.</li>
  <li>Manually clearing the browser cache from the Google Chrome Dev Tools does not force all files to be recached.</li>
</ul>

<p><code>TIP</code></p>

<p>A manifest file must be served with the <code>MIME-typ</code>e text/cache-manifest. You may need to add this custom file type to your web server or to a .htaccess file: AddType text/cache-manifest .appcache.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-07T16:16:36+08:00" data-updated="true" itemprop="datePublished">Oct 7<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/sencha/'>Sencha</a>, <a class='category' href='/blog/categories/touch/'>Touch</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/07/data-stores/" itemprop="url">Data Stores</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>A data store is a mechanism to cache your data and is part of the Ext.data package. It is like a bucket full of data records. You can pick (select) a record out of this bucket (the data store) and add or remove records. Stores also provide functions for sorting, filtering, and grouping the model instances. You’ll need to give a model structure to the store with data. You can do this inline by setting the fields and data arrays (hardcoded), but a better MVC approach is to bind a model to the data store.</p>

<p>Sencha Touch has data-aware components — such as <code>lists, dataviews, and charts</code> — that need to be hooked up to a store in order to display data. I will discuss those in
<code>Chapter 11.</code></p>

<p>In this chapter, you’ll learn:</p>

<ul>
  <li>How to load data in a store</li>
  <li>How to sort a data store locally How to sort data on a server</li>
  <li>How to group a data store</li>
  <li>How to filter a data store locally </li>
  <li>How to filter a data store on a server </li>
  <li>How to save/sync data in a store</li>
</ul>

<h4 id="loading-data-in-a-store">Loading Data in a Store</h4>
<p>For the FindACab app to be able to display the data, the data needs to be contained in the store. By default, when you create a store (and the data is not hardcoded), you will have to load the model data into your store.
When autoLoad is not enabled, you have to manually load the store from your code, or from your developer’s console:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.getStore('MyStore').load(this, records, successful, operation, eOpts);</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><code>NOTE</code></p>

<p><code>Ext.getStore("MyStore")</code> is a lookup method; it finds a store (if the store is registered in the Ext.application() or controller) based on the store instance name or storeId through the StoreManager. Really, it’s a short alias for <code>Ext.data.StoreManager.lookup("myStore")</code>;.</p>

<p>We want the FindACab app to retrieve a list of cabs in the area. We already hooked up a proxy to the store, so we can load the data. When you run the Ext.getStore(“Cabs”).load() event in the console, it will look up the Cabs store through the StoreManager and return a store object with a data array that contains 20 items.</p>

<p>Instead of just loading the store, you can also handle a callback:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.getStore('Cabs').load({
</span><span class="line">    callback: function(records, success, operation) {
</span><span class="line">        //callback function here
</span><span class="line">        console.log(records);
</span><span class="line">    },
</span><span class="line">    scope: this
</span><span class="line">});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The store has a callback function, which in this case logs all records after the store is loaded. You can also set a scope. In this case, when you log console.log(this) in your callback, it won’t log the scope within the callback, but rather the scope of the class where the store load() event is called.</p>

<p><code>TIP</code></p>

<p><code>
There are more events you can listen for in the store; for example, addrecords, beforeload, beforesync, refresh, removerecords, updaterecords, and write. Check the API docs for more details about the different store events.
</code></p>

<p>Now you will modify the store proxy config. Instead of entering a full proxy URL, you will retrieve the URL, the YELP_API key, and the YELP_TERM from the Utils.Commons static file, so it’s better organized. You can send parameters with the request by using the extraParams object, and you can modify these parameters from elsewhere in your code, as shown in Example 9-1.</p>

<p><code>
Example 9 - 1.store / Cabs.js
Ext.define('FindACab.store.Cabs', {
    extend: 'Ext.data.Store',
    requires: ['Ext.data.proxy.JsonP'],
    config: {
        model: 'FindACab.model.Cab',
        autoLoad: false,
        proxy: {
            type: 'jsonp',
            url: Utils.Commons.YELP_API,
            noCache: false,
            extraParams: {
                term: Utils.Commons.YELP_TERM,
                ywsid: Utils.Commons.YELP_KEY,
                location: Utils.Commons.LOCATION
            },
            reader: {
                type: 'json',
                rootProperty: 'businesses',
            }
        },
    }
});
</code></p>

<p>In order to maintain the store callback in the controller, you will create a system event listener to listen to the store load event. For now, this code will only log the results, and show and hide a loading indicator. Example 9-2 shows the new FindACab.controller.CabController.</p>

<p>&#8220;`
Example 9-2. controller/CabController.js</p>

<p><code>
Ext.define('FindACab.controller.CabController', {
    extend: 'Ext.app.Controller',
    config: {
        models: ['Cab'],
        stores: ['Cabs']
    },
    init: function() {
        Ext.Viewport.mask({
            xtype: 'loadmask',
            message: 'loading...'
        });
        Ext.getStore('Cabs').load();
        Ext.getStore('Cabs').addListener('load',
            this.onCabsStoreLoad,
            this);
    },
    onCabsStoreLoad: function(records, success, operation) {
        console.log(records.getData());
        Ext.Viewport.unmask();
    }
});
</code></p>

<h4 id="sorting-a-data-store-locally">Sorting a Data Store Locally</h4>

<p>After you retrieve data in your store, you might notice that the store is not sorted. It is possible to sort the records in a data store on the client side. You will use the <code>Ext.data.Store.sort(sorters, [defaultDirection], [where])</code> method, and you can pass in sorters_ object, which specifies the fieldname to sort and the direction, either ASC (ascending, A–Z) and DESC (descending, Z-A).</p>

<p>Here I construct a sorters array to sort the fieldname property by ASC:</p>

<p><code>
sorters: [{
	property: "fieldname", direction: "ASC"
}]
</code></p>

<p>The sorters array or the sort() method on the store sorts the data collection inside the
store by one or more of its properties.</p>

<p>To programmatically sort a store from elsewhere in your code, you can pass in a single
argument, the fieldname to sort. This will toggle between ascending and descending:</p>

<p><code>
Ext.getStore("Cabs").sort("name");
</code></p>

<p>Or you can pass in the full sorters configuration:</p>

<p><code>
Ext.getStore("Cabs").sort({
    property: "fieldname",
    direction: "ASC"
});
</code>
Or just the string fieldname and strings “ASC” or “DESC”:</p>

<p><code>
Ext.getStore("Cabs").sort("name", "DESC");
</code>
In the FindACab app, you will sort the Cabs list on the cab service name in alphabetical
order. Therefore, the default sorter will be set to name:
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class=""><span class="line">sorters: [{
</span><span class="line">    property: "name",
</span><span class="line">    direction: "ASC"
</span><span class="line">}],</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;
It is possible to add sorters on top of each other. For example, first sort on the field name and afterward filter on the field distance. You do so by passing an array:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class=""><span class="line">store.sort([{
</span><span class="line">    property: 'name',
</span><span class="line">    direction: 'ASC'
</span><span class="line">}, {
</span><span class="line">    property: 'distance',
</span><span class="line">    direction: 'DESC'
</span><span class="line">}]);</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>When the sort() method is called again with a new sorter object, any existing sorters will be removed. When the sort() method is called without any arguments, the existing sorters will be reapplied. To keep existing sorters and add new ones, you will need to run the add() method on the sorters object. Here is how you can add sorters to a store:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">store.sorters.add(new Ext.util.Sorter({
</span><span class="line">    property: 'phone',
</span><span class="line">    direction: 'ASC'
</span><span class="line">}));
</span><span class="line">store.sort();</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The previous examples make sense when you want to sort on local stores. However, it’s also possible to sort remotely on the server side.</p>

<h4 id="sorting-data-on-a-server">Sorting Data on a Server</h4>
<p>The data that you retrieve from the server side might be very large. It could be faster to sort it on the server side instead of locally. Luckily, Sencha Touch provides a way to implement server-side paging, called <code>remote sorting</code>. You will use the Ext.data.Store.remoteSort boolean, and you will use the sorters object directly in the store or run the Ext.data.Store.sort(sorters, [defaultDirection], [where]) method where you can pass in a sorters object. (See the previous section on how to sort a store.)</p>

<p>If you want to enable remote sorting, set the following settings in the store class definition:</p>

<ul>
  <li>A pageSize to define the number of records that constitutes a “page.” (Note that the default page size is set to 25.)</li>
  <li>The boolean remoteSort config in the store class definition to true. (Note that remote sorting is false by default.)</li>
  <li>The sorters object, as described in the previous section:</li>
</ul>

<p><code>
pageSize: 30, 
remoteSort: true, 
sorters: [{
	property: "fieldname",
	direction: "ASC" 
}]
</code></p>

<p>Unfortunately, because we do not have control over the Yelp server side, we won’t implement a remote sorter for the FindACab app. However, I do want to share a running example of a remote sorter. In this demo, there is another data store with Car objects that sorts cars by brand in ascending order:</p>

<p><code>
Ext.define('RemoteTest.store.Cars', {
        extend: 'Ext.data.Store',
        requires: ['Ext.data.proxy.JsonP'],
        config: {
            model: 'RemoteTest.model.Car',
            autoLoad: true,
            remoteSort: true, // 
            sorters: [{ //
	            property: "brand",
	            direction: "ASC"
	        }],
	    pageSize: 20, //
	    proxy: { //
	        type: 'jsonp',
	        url: 'http://someurl.com/test.php',
	        reader: { //
	            rootProperty: 'results',
	            totalProperty: 'total',
	            successProperty: 'success'
	        }
	    },
	}
});
</code>
<code>WARNING</code></p>

<p>The previous store has an autoLoad property. This makes sense for demo purposes, but in a real application, you would probably want to programmatically sort and load the store.</p>

<p>Currently, this Car store doesn’t do much. That’s because there is no server side implemented. This is OK, because the server-side code can be a black box for us. However, let’s assume that http://<someurl>.com/test.php is a working web service that sends Car objects back.</someurl></p>

<p>In the Google Developer network tab, you can see a request is made, which sends the following GET request to your server:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">http://someurl.com/test.php?_dc=1386924081041&amp;page=1&amp;start=0&amp;limit=20 &amp;sort=%5B%7B%22property%22%3A%22brand%22%2C%22direction%22%3A%22ASC%22%7D%5D &amp;callback=Ext.data.JsonP.callback1
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Let’s format the query string parameters:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">page:1
start:0
limit:20 
sort:[{"property":"name","direction":"ASC"}]</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The limit parameter comes from the store pageSize. The page and start parameters are used for paging. On the server side, you can calculate which set of items you have to send back to the client-side code.</p>

<p>The http://<someurl>.com/test.php web service requires some logic to sort the data (e.g., in a database) and send the correct set of data back.</someurl></p>

<p>The server response for sending back Car objects (in PHP) could look like Example 9- 3. The names of the success, total, and results properties should be set in the store’s reader.</p>

<p><code>
{
    "success": true,
    "total": 500,
    ￼￼￼￼￼
        "results": [{
                "id": 1,
                "brand": "BMW",
                "type": 7
            }, {
                "id": 2,
                "brand": "Mercedes",
                "type": 5
            }
            ... //20 results in total
    ]
}
</code></p>

<h4 id="grouping-a-data-store">Grouping a Data Store</h4>

<p>Grouping a data store makes sense when you want to display data into an Ext.List component in Sencha Touch and you want to visually group data. For example, when you have a store with companies, you could, for example, group by “city.” This will list every company per city.</p>

<p>To enable grouping in a store, implement the groupField and groupDir configurations directly in the store class definition. The groupFields sets the field to group and the groupDir sets the direction (ASC or DESC):</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>&#8216;<model-field-name>&#8217;, 
groupDir: &#8216;ASC&#8217;<a href="//or">DESC</a><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="sb">```</span>
</span><span class="line">
</span><span class="line"><span class="sb">To dynamically group a store, you can run the setGrouper() method on a store object:</span>
</span><span class="line">
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="no">Ext</span><span class="o">.</span><span class="n">getStore</span><span class="p">(</span><span class="s1">&#39;Cabs&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setGrouper</span><span class="p">({</span>
</span><span class="line">    <span class="ss">direction</span><span class="p">:</span> <span class="s1">&#39;ASC&#39;</span><span class="p">,</span> <span class="sr">//o</span><span class="n">r</span> <span class="no">DESC</span>
</span><span class="line">    <span class="ss">property</span><span class="p">:</span> <span class="s1">&#39;&lt;model-field-name&gt;&#39;</span>
</span><span class="line"><span class="p">});</span>
</span><span class="line"><span class="sb">```</span>
</span><span class="line">
</span><span class="line"><span class="sb">You will implement grouping on the Cabs store for the FindACab app list. This time, you will not group on city, because all the data that is in the Cabs store already shares the same city — for example, Amsterdam. Therefore, let’s group on the first alphabetical character of a cab service name. (See Figure 9-1.) You would see a group “A” that lists all names that start with an A, a group “B” that lists all names that start with a B, and so on. It’s the same behavior as when you open the contacts list on an iPhone. Names are grouped, and if you want, you can even display an index bar on the side to quickly browse to the corresponding character.</span>
</span><span class="line">
</span><span class="line"><span class="sb"><img src="/images/2014/10/figure7-3.png" /></span>
</span><span class="line">
</span><span class="line"><span class="sb">To achieve this, you will need the Ext.data.Store.grouper object, with a custom group function: groupFn(). You can set the grouper object directly in the store class definition, as shown in Example 9-4.</span>
</span><span class="line">
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="ss">grouper</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">    <span class="ss">groupFn</span><span class="p">:</span> <span class="n">function</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="k">return</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">toUpperCase</span><span class="p">();</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="sb">```</span>
</span><span class="line">
</span><span class="line"><span class="sb">The groupFn function with the code return record.get(&quot;name&quot;) [0].toUpperCase(); will group the data in the store on the first (uppercase) character of the name field.</span>
</span><span class="line">
</span><span class="line"><span class="sb">#### Filtering a Data Store Locally</span>
</span><span class="line">
</span><span class="line"><span class="sb">A data store can also filter records. When a filter is applied, the data store will not remove records. The same records are still available in the store, but only the records that match the filter criteria are displayed.</span>
</span><span class="line">
</span><span class="line"><span class="sb">Filters are added as arrays. Here’s how to implement a filter array directly in the store class definition:</span>
</span></code></pre></td></tr></table></div>
filters: [{
    property: &#8220;fieldname&#8221;,
    value: &#8220;match&#8221;
}],
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>&#8216;<model-field-name>&#8217;, 
groupDir: &#8216;ASC&#8217;<a href="//or">DESC</a><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="no">You</span> <span class="n">can</span> <span class="n">also</span> <span class="n">filter</span> <span class="n">programmatically</span><span class="o">.</span> <span class="no">Just</span> <span class="n">run</span> <span class="n">the</span> <span class="n">following</span> <span class="nb">method</span> <span class="n">from</span> <span class="n">a</span> <span class="n">store</span> <span class="ss">instance</span><span class="p">:</span>
</span><span class="line">
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="sb">Ext.data.Store.filter(filters, [value], [anyMatch], [caseSensitive]);</span>
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="no">It</span><span class="err">’</span><span class="n">s</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">filter</span> <span class="n">on</span> <span class="n">the</span> <span class="n">first</span> <span class="n">characters</span> <span class="n">of</span> <span class="n">a</span> <span class="n">field</span> <span class="ow">or</span> <span class="n">from</span> <span class="n">anywhere</span> <span class="p">(</span><span class="ss">argument</span><span class="p">:</span> <span class="n">anyMatch</span><span class="p">),</span> <span class="ow">and</span> <span class="n">it</span><span class="err">’</span><span class="n">s</span> <span class="n">also</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">filter</span> <span class="k">for</span> <span class="k">case</span> <span class="n">sensitivity</span> <span class="p">(</span><span class="ss">argument</span><span class="p">:</span> <span class="sb">`caseSensitive`</span><span class="p">)</span><span class="o">.</span>
</span><span class="line">
</span><span class="line"><span class="c1">#### Custom Filter Functions</span>
</span><span class="line">
</span><span class="line"><span class="no">You</span> <span class="n">can</span> <span class="n">also</span> <span class="n">create</span> <span class="n">custom</span> <span class="n">filter</span> <span class="n">functions</span><span class="o">.</span> <span class="no">To</span> <span class="k">do</span> <span class="n">so</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">set</span> <span class="n">a</span> <span class="n">filterFn</span> <span class="k">in</span> <span class="n">the</span>
</span><span class="line"><span class="n">array</span> <span class="ow">or</span> <span class="n">use</span> <span class="n">the</span> <span class="n">filterBy</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="nb">method</span> <span class="n">on</span> <span class="n">the</span> <span class="n">store</span><span class="o">.</span>
</span><span class="line">
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="sb">filters: [{</span>
</span><span class="line"><span class="sb">    filterFn: function(item) {</span>
</span><span class="line"><span class="sb">        return item.get(&quot;phone&quot;).length &gt; 0;</span>
</span><span class="line"><span class="sb">    }</span>
</span><span class="line"><span class="sb">}],</span>
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="c1">#### Stacking Filters</span>
</span><span class="line"><span class="n">o</span> <span class="n">add</span> <span class="n">filters</span> <span class="n">on</span> <span class="n">top</span> <span class="n">of</span> <span class="n">each</span> <span class="n">other</span> <span class="err">—</span> <span class="k">for</span> <span class="n">example</span><span class="p">,</span> <span class="n">to</span> <span class="n">filter</span> <span class="n">on</span> <span class="n">a</span> <span class="nb">name</span> <span class="n">with</span> <span class="n">a</span> <span class="n">value</span> <span class="n">of</span> <span class="no">Taxi</span> <span class="ow">and</span> <span class="n">filter</span> <span class="n">on</span> <span class="n">a</span> <span class="n">distance</span> <span class="n">of</span> <span class="mi">20</span> <span class="n">miles</span> <span class="err">—</span> <span class="n">you</span> <span class="n">pass</span> <span class="k">in</span> <span class="n">an</span> <span class="n">array</span><span class="o">.</span> <span class="no">Here</span><span class="p">,</span> <span class="n">I</span> <span class="n">stack</span> <span class="n">a</span> <span class="n">couple</span> <span class="n">of</span> <span class="n">filters</span> <span class="n">on</span> <span class="n">top</span> <span class="n">of</span> <span class="n">each</span> <span class="ss">other</span><span class="p">:</span>
</span><span class="line">
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="sb">store.filter([{</span>
</span><span class="line"><span class="sb">    property: &quot;name&quot;,</span>
</span><span class="line"><span class="sb">    value: &quot;Taxi&quot;</span>
</span><span class="line"><span class="sb">}, {</span>
</span><span class="line"><span class="sb">    property: &quot;distance&quot;,</span>
</span><span class="line"><span class="sb">    value: &quot;20&quot;</span>
</span><span class="line"><span class="sb">}]);</span>
</span><span class="line"><span class="sb">```</span>
</span><span class="line">
</span><span class="line"><span class="sb">`Note`</span>
</span><span class="line">
</span><span class="line"><span class="no">Instead</span> <span class="n">of</span> <span class="n">passing</span> <span class="n">an</span> <span class="n">array</span> <span class="n">with</span> <span class="n">filter</span> <span class="n">objects</span> <span class="n">into</span> <span class="n">the</span> <span class="n">filter</span><span class="p">()</span> <span class="nb">method</span><span class="p">,</span> <span class="n">I</span> <span class="n">could</span> <span class="n">call</span> <span class="n">the</span> <span class="n">filter</span><span class="p">()</span> <span class="nb">method</span> <span class="n">again</span> <span class="n">without</span> <span class="n">the</span> <span class="n">filter</span> <span class="n">objects</span> <span class="n">as</span> <span class="n">arguments</span><span class="o">.</span> <span class="no">Unlike</span> <span class="n">sorters</span><span class="p">,</span> <span class="n">filters</span> <span class="n">won</span><span class="err">’</span><span class="n">t</span> <span class="n">reset</span> <span class="k">if</span> <span class="n">you</span> <span class="n">call</span> <span class="n">them</span> <span class="n">again</span><span class="o">.</span> <span class="no">When</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">renew</span> <span class="n">the</span> <span class="n">filter</span><span class="p">,</span> <span class="n">you</span> <span class="n">have</span> <span class="n">to</span> <span class="n">clear</span> <span class="n">it</span> <span class="ss">first</span><span class="p">:</span>
</span><span class="line">
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="sb">store.clearFilter();</span>
</span><span class="line"><span class="sb">```</span>
</span><span class="line">
</span><span class="line"><span class="c1">#### Filtering Data on a Server</span>
</span><span class="line">
</span><span class="line"><span class="no">The</span> <span class="n">data</span> <span class="n">that</span> <span class="n">you</span> <span class="n">retrieve</span> <span class="n">from</span> <span class="n">the</span> <span class="n">server</span> <span class="n">side</span> <span class="n">might</span> <span class="n">be</span> <span class="n">very</span> <span class="n">large</span><span class="o">.</span> <span class="no">It</span> <span class="n">could</span> <span class="n">be</span> <span class="n">faster</span> <span class="n">to</span> <span class="n">filter</span> <span class="n">it</span> <span class="n">on</span> <span class="n">the</span> <span class="n">server</span> <span class="n">side</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">locally</span><span class="o">.</span> <span class="no">Luckily</span><span class="p">,</span> <span class="no">Sencha</span> <span class="no">Touch</span> <span class="n">provides</span> <span class="n">a</span> <span class="n">way</span> <span class="n">to</span> <span class="n">implement</span> <span class="n">server</span><span class="o">-</span><span class="n">side</span> <span class="n">filtering</span><span class="o">.</span>
</span><span class="line">
</span><span class="line"><span class="no">You</span> <span class="n">will</span> <span class="n">use</span> <span class="n">the</span> <span class="n">remoteFilter</span> <span class="n">boolean</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">array</span> <span class="n">with</span> <span class="n">filters</span><span class="o">.</span> <span class="no">Here</span><span class="err">’</span><span class="n">s</span> <span class="n">an</span> <span class="n">example</span> <span class="n">of</span> <span class="n">the</span> <span class="n">store</span> <span class="k">class</span> <span class="ss">definition</span><span class="p">:</span>
</span><span class="line">
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="sb">remoteFilter: true,</span>
</span><span class="line"><span class="sb">filters: [{</span>
</span><span class="line"><span class="sb">    property: &quot;fieldname&quot;,</span>
</span><span class="line"><span class="sb">    value: &quot;match&quot;</span>
</span><span class="line"><span class="sb">}],</span>
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="n">because</span> <span class="n">we</span> <span class="k">do</span> <span class="ow">not</span> <span class="n">have</span> <span class="n">server</span><span class="o">-</span><span class="n">side</span> <span class="n">control</span> <span class="n">over</span> <span class="no">Yelp</span><span class="o">.</span><span class="n">com</span><span class="p">,</span> <span class="n">we</span> <span class="n">won</span><span class="err">’</span><span class="n">t</span> <span class="n">implement</span> <span class="n">a</span> <span class="n">remote</span> <span class="n">filter</span> <span class="k">for</span> <span class="n">the</span> <span class="no">FindACab</span> <span class="n">app</span><span class="o">.</span> <span class="n">I</span> <span class="k">do</span> <span class="n">want</span> <span class="n">to</span> <span class="n">share</span> <span class="n">an</span> <span class="n">example</span> <span class="n">of</span> <span class="n">a</span> <span class="n">remote</span> <span class="n">filter</span><span class="p">,</span> <span class="n">however</span><span class="o">.</span> <span class="no">In</span> <span class="n">this</span> <span class="n">demo</span><span class="p">,</span> <span class="n">there</span> <span class="n">is</span> <span class="n">another</span> <span class="n">data</span> <span class="n">store</span> <span class="n">with</span> <span class="no">Car</span> <span class="n">objects</span> <span class="ow">and</span> <span class="n">with</span> <span class="n">remote</span> <span class="n">filtering</span> <span class="n">enabled</span><span class="o">.</span> <span class="no">It</span> <span class="n">has</span> <span class="n">a</span> <span class="n">filter</span> <span class="n">set</span> <span class="n">that</span> <span class="n">filters</span> <span class="n">on</span> <span class="n">car</span> <span class="ss">brand</span><span class="p">:</span>
</span><span class="line">
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="sb">Ext.define(&#39;RemoteTest.store.Cars&#39;, {</span>
</span><span class="line"><span class="sb">    extend: &#39;Ext.data.Store&#39;,</span>
</span><span class="line"><span class="sb">    requires: [&#39;Ext.data.proxy.JsonP&#39;],</span>
</span><span class="line"><span class="sb">    config: {</span>
</span><span class="line"><span class="sb">        model: &#39;RemoteTest.model.Car&#39;,</span>
</span><span class="line"><span class="sb">        autoLoad: true,</span>
</span><span class="line"><span class="sb">        pageSize: 20,</span>
</span><span class="line"><span class="sb">        remoteFilter: true,</span>
</span><span class="line"><span class="sb">        filters: [{</span>
</span><span class="line"><span class="sb">            property: &quot;brand&quot;,</span>
</span><span class="line"><span class="sb">            value: &quot;BMW&quot;</span>
</span><span class="line"><span class="sb">        }],</span>
</span><span class="line"><span class="sb">        proxy: {</span>
</span><span class="line"><span class="sb">            type: &#39;jsonp&#39;,</span>
</span><span class="line"><span class="sb">            url: &#39;http://someurl.com/test.php&#39;,</span>
</span><span class="line"><span class="sb">            reader: {</span>
</span><span class="line"><span class="sb">                rootProperty: &#39;results&#39;,</span>
</span><span class="line"><span class="sb">                totalProperty: &#39;total&#39;,</span>
</span><span class="line"><span class="sb">                successProperty: &#39;success&#39;</span>
</span><span class="line"><span class="sb">            }</span>
</span><span class="line"><span class="sb">        },</span>
</span><span class="line"><span class="sb">    }</span>
</span><span class="line"><span class="sb">});</span>
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="sb">`WARNING`</span>
</span><span class="line">
</span><span class="line"><span class="no">When</span> <span class="n">the</span> <span class="n">remoteFilter</span> <span class="n">configuration</span> <span class="n">has</span> <span class="n">been</span> <span class="n">set</span> <span class="n">to</span> <span class="kp">true</span><span class="p">,</span> <span class="n">you</span> <span class="n">will</span> <span class="n">have</span> <span class="n">to</span> <span class="n">manually</span> <span class="n">call</span> <span class="n">the</span> <span class="nb">load</span> <span class="nb">method</span> <span class="n">after</span> <span class="n">every</span> <span class="n">filter</span> <span class="n">you</span> <span class="n">set</span> <span class="n">to</span> <span class="n">retrieve</span> <span class="n">the</span> <span class="n">filtered</span> <span class="n">data</span> <span class="n">from</span> <span class="n">the</span> <span class="n">server</span><span class="o">.</span>
</span><span class="line">
</span><span class="line"><span class="no">Let</span><span class="err">’</span><span class="n">s</span> <span class="n">assume</span> <span class="n">that</span> <span class="ss">http</span><span class="p">:</span><span class="sr">//</span><span class="o">&lt;</span><span class="n">someurl</span><span class="o">&gt;.</span><span class="n">com</span><span class="o">/</span><span class="nb">test</span><span class="o">.</span><span class="n">php</span> <span class="n">is</span> <span class="n">a</span> <span class="n">working</span> <span class="n">web</span> <span class="n">service</span> <span class="n">that</span> <span class="n">sends</span>
</span><span class="line"><span class="no">Car</span> <span class="n">objects</span> <span class="n">back</span><span class="o">.</span> <span class="no">We</span><span class="err">’</span><span class="n">ll</span> <span class="n">filter</span> <span class="n">on</span> <span class="n">a</span> <span class="n">car</span> <span class="n">brand</span> <span class="n">of</span> <span class="no">BMW</span><span class="p">,</span> <span class="mi">20</span> <span class="n">per</span> <span class="n">time</span> <span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span>
</span><span class="line"><span class="no">In</span> <span class="n">the</span> <span class="no">Google</span> <span class="no">Developer</span> <span class="no">Network</span> <span class="n">tab</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">see</span> <span class="n">a</span> <span class="n">request</span> <span class="n">is</span> <span class="n">made</span> <span class="n">that</span> <span class="n">sends</span> <span class="n">the</span>
</span><span class="line"><span class="n">following</span> <span class="no">GET</span> <span class="n">request</span> <span class="n">to</span> <span class="n">your</span> <span class="ss">server</span><span class="p">:</span>
</span><span class="line">
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="sb">http://someurl.com/test.php?_dc=1387182737587&amp;page=1&amp;start=0&amp;limit=20 &amp;filter=%5B%7B%22property%22%3A%22brand%22%2C%22value%22%3A%22BMW%22%7D%5D &amp;callback=Ext.data.JsonP.callback1</span>
</span><span class="line"><span class="sb">```</span>
</span><span class="line">
</span><span class="line"><span class="no">Let</span><span class="err">’</span><span class="n">s</span> <span class="nb">format</span> <span class="n">the</span> <span class="n">query</span> <span class="n">string</span> <span class="ss">parameters</span><span class="p">:</span>
</span><span class="line">
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="sb">page: 1</span>
</span><span class="line"><span class="sb">start: 0</span>
</span><span class="line"><span class="sb">limit: 20</span>
</span><span class="line"><span class="sb">filter: [{</span>
</span><span class="line"><span class="sb">    &quot;property&quot;: &quot;brand&quot;,</span>
</span><span class="line"><span class="sb">    &quot;value&quot;: &quot;BMW&quot;</span>
</span><span class="line"><span class="sb">}]</span>
</span><span class="line"><span class="sb">```</span>
</span><span class="line"><span class="no">As</span> <span class="n">you</span> <span class="n">might</span> <span class="n">have</span> <span class="n">noticed</span><span class="p">,</span> <span class="n">the</span> <span class="n">implementation</span> <span class="ow">and</span> <span class="n">server</span> <span class="n">requests</span> <span class="n">of</span> <span class="n">a</span> <span class="n">remote</span> <span class="n">filter</span> <span class="n">are</span> <span class="n">similar</span> <span class="n">to</span> <span class="n">the</span> <span class="n">implementation</span> <span class="ow">and</span> <span class="n">server</span> <span class="n">requests</span> <span class="n">of</span> <span class="n">a</span> <span class="n">remote</span> <span class="n">sorter</span><span class="o">.</span> <span class="no">The</span> <span class="n">limit</span> <span class="n">parameter</span> <span class="n">comes</span> <span class="n">from</span> <span class="n">the</span> <span class="n">store</span> <span class="n">pageSize</span><span class="o">.</span> <span class="no">The</span> <span class="n">page</span> <span class="ow">and</span> <span class="n">start</span> <span class="n">parameters</span> <span class="n">are</span> <span class="n">used</span> <span class="k">for</span> <span class="n">paging</span><span class="o">.</span> <span class="no">On</span> <span class="n">the</span> <span class="n">server</span> <span class="n">side</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">calculate</span> <span class="n">which</span> <span class="n">set</span> <span class="n">of</span> <span class="n">items</span> <span class="n">you</span> <span class="n">have</span> <span class="n">to</span> <span class="nb">send</span> <span class="n">back</span> <span class="n">to</span> <span class="n">the</span> <span class="n">client</span><span class="o">-</span><span class="n">side</span> <span class="n">code</span><span class="o">.</span>
</span><span class="line">
</span><span class="line"><span class="no">The</span> <span class="ss">http</span><span class="p">:</span><span class="sr">//</span><span class="o">&lt;</span><span class="n">someurl</span><span class="o">&gt;.</span><span class="n">com</span><span class="o">/</span><span class="nb">test</span><span class="o">.</span><span class="n">php</span> <span class="n">requires</span> <span class="n">some</span> <span class="n">logic</span> <span class="n">to</span> <span class="n">filter</span> <span class="n">their</span> <span class="n">data</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">,</span> <span class="k">in</span> <span class="n">a</span> <span class="n">database</span><span class="p">),</span> <span class="ow">and</span> <span class="nb">send</span> <span class="n">the</span> <span class="n">correct</span> <span class="n">set</span> <span class="n">of</span> <span class="n">data</span> <span class="n">back</span><span class="o">.</span>
</span><span class="line">
</span><span class="line"><span class="no">The</span> <span class="n">server</span> <span class="n">response</span> <span class="k">for</span> <span class="n">sending</span> <span class="n">back</span> <span class="no">Car</span> <span class="n">objects</span> <span class="p">(</span><span class="k">in</span> <span class="no">PHP</span><span class="p">)</span> <span class="n">could</span> <span class="n">look</span> <span class="n">like</span> <span class="no">Example</span> <span class="mi">9</span><span class="o">-</span> <span class="mi">6</span><span class="o">.</span> <span class="no">The</span> <span class="n">names</span> <span class="n">of</span> <span class="n">the</span> <span class="n">success</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="ow">and</span> <span class="n">results</span> <span class="n">properties</span> <span class="n">should</span> <span class="n">be</span> <span class="n">set</span> <span class="k">in</span> <span class="n">the</span> <span class="n">store</span><span class="err">’</span><span class="n">s</span> <span class="n">reader</span><span class="o">.</span>
</span></code></pre></td></tr></table></div>
// Example 9-6. A server response in PHP
{
    &#8220;success&#8221;: true,
    &#8220;total&#8221;: 500,
    &#8220;results&#8221;: [{
            &#8220;id&#8221;: 1,
            &#8220;brand&#8221;: &#8220;BMW&#8221;,
            &#8220;type&#8221;: 7
        }, {
            &#8220;id&#8221;: 2,
            &#8220;brand&#8221;: &#8220;BMW&#8221;,
            &#8220;type&#8221;: 5
        }
        &#8230;
    ]
}
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>&#8216;<model-field-name>&#8217;, 
groupDir: &#8216;ASC&#8217;<a href="//or">DESC</a><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="c1">#### Syncing Data in a Store</span>
</span><span class="line">
</span><span class="line"><span class="no">To</span> <span class="n">save</span><span class="o">/</span><span class="n">synchronize</span> <span class="n">records</span> <span class="k">in</span> <span class="n">a</span> <span class="n">data</span> <span class="n">store</span> <span class="n">with</span> <span class="n">the</span> <span class="n">server</span><span class="p">,</span> <span class="n">you</span> <span class="n">will</span> <span class="n">have</span> <span class="n">to</span> <span class="n">run</span> <span class="n">the</span> <span class="sb">`sync()`</span> <span class="nb">method</span> <span class="n">on</span> <span class="n">the</span> <span class="n">store</span><span class="o">.</span> <span class="no">It</span><span class="err">’</span><span class="n">s</span> <span class="n">also</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">automatically</span> <span class="n">sync</span> <span class="n">the</span> <span class="n">store</span> <span class="n">with</span> <span class="n">the</span> <span class="n">server</span> <span class="n">side</span><span class="o">.</span> <span class="no">That</span> <span class="n">way</span><span class="p">,</span> <span class="n">the</span> <span class="n">remote</span> <span class="n">server</span> <span class="n">keeps</span> <span class="k">in</span> <span class="n">close</span> <span class="n">sync</span> <span class="n">with</span> <span class="n">your</span> <span class="no">Sencha</span> <span class="no">Touch</span> <span class="n">app</span><span class="o">.</span> <span class="no">You</span> <span class="n">can</span> <span class="n">enable</span> <span class="n">this</span> <span class="n">by</span> <span class="n">setting</span> <span class="n">the</span> <span class="sb">`autoSync`</span> <span class="n">property</span> <span class="n">to</span> <span class="sb">`true`</span><span class="o">.</span>
</span><span class="line">
</span><span class="line"><span class="no">More</span> <span class="n">likely</span><span class="p">,</span> <span class="n">you</span> <span class="n">will</span> <span class="n">use</span> <span class="n">the</span> <span class="no">Ext</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Store</span><span class="o">.</span><span class="n">sync</span><span class="p">()</span> <span class="nb">method</span> <span class="n">to</span> <span class="n">synchronize</span> <span class="n">the</span> <span class="n">store</span> <span class="n">with</span> <span class="n">its</span> <span class="n">proxy</span> <span class="ss">programmatically</span><span class="p">:</span>
</span></code></pre></td></tr></table></div>
store.sync(options);
&#8220;`
Before the sync process, Sencha Touch will fire a `beforesync` system event. When you run the sync() method, all inserts, updates, and deletes are sent as three separate requests, and if you want, you can declare the order in which the three operations should occur. After the sync process, an object is returned with the child objects `added, updated, and removed`.
</model-field-name></span></figcaption></figure></notextile></div></model-field-name></span></figcaption></figure></notextile></div></model-field-name></span></figcaption></figure></notextile></div>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-07T11:09:16+08:00" data-updated="true" itemprop="datePublished">Oct 7<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/sencha/'>Sencha</a>, <a class='category' href='/blog/categories/touch/'>Touch</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/07/remote-connections-server-proxies/" itemprop="url">Remote Connections (Server Proxies)</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Models and stores can load and save data via a so-called <code>proxy</code>. Sencha Touch has two main types of proxies: <code>client proxies</code> and <code>server proxies</code>. Client proxies save and load their data locally. Server proxies interact with a remote server.You can read more about client proxies and saving data offline (with techniques such as Local Storage, Session Storage, Web SQL, and AppCache) in Chapter 10. In this chapter, I will talk about the different kinds of server proxies.</p>

<p>A server proxy communicates by sending requests to some remote server. There are four types of server proxies you can use out of the box:</p>

<ul>
  <li>
    <p>Ext.data.proxy.Ajax</p>

    <p>Sends a request to the server on the <code>same domain</code> by using — you guessed it — AJAX.</p>
  </li>
  <li>
    <p>Ext.data.proxy.JsonP</p>

    <p>Sends a request to a server on a different domain by using JSON with padding (JSONP).</p>
  </li>
  <li>
    <p>Ext.data.proxy.Rest</p>

    <p>A kind of AJAX proxy that automatically maps to four readable actions, the RESTful HTTP verbs: create, read, update, and destroy.</p>
  </li>
  <li>
    <p>Ext.data.proxy.Direct</p>

    <p>Uses the Ext.Direct technology (originally created for Ext JS) to remote server-side methods to the client side. Ext.Direct allows communication between the client side of a Sencha app and all popular server platforms.</p>
  </li>
</ul>

<p>Let’s implement the two most used server proxies for receiving data: the AJAX proxy and the JSONP proxy. We’ll also discuss how to communicate with a server without using a proxy, by making AJAX and JSONP requests.</p>

<p>For the FindACab app, you will implement a JSONP proxy to retrieve TaxiServices data for a certain location from an external web server (Yelp.com).</p>

<p>In this chapter, you’ll learn about:</p>

<ul>
  <li>
    <p>Saving or retrieving data from the same domain with AJAX</p>

    <p>How to implement AJAX proxies </p>

    <p>How to implement an AJAX request</p>
  </li>
  <li>
    <p>Retrieving data from an external domain with JSONP</p>

    <p>How to implement JSONP proxies </p>

    <p>How to implement a JSONP request</p>
  </li>
  <li>
    <p>Saving or retrieving data from an external domain with AJAX</p>

    <p>How to implement <code>CORS</code></p>
  </li>
</ul>

<h4 id="saving-or-retrieving-data-from-the-same-domain-with-ajax">Saving or Retrieving Data from the Same Domain with AJAX</h4>

<h5 id="implementing-ajax-proxies">Implementing AJAX Proxies</h5>

<p>At the top of your model or store class, you will require Ext.data.proxy.Ajax, so the Ext.Loader knows to load the AJAX proxy framework class first. Next, you will create a proxy object:</p>

<p><code>
config: {
	//model or store configs here
	proxy: {
		type: 'ajax',
		url: 'data/data.json' 
	}
}
</code>
The proxy object can be set into the config object from a store or a model</p>

<p>The URL can point to a web service URL, or it can just point to some file <code>locally</code>. In Example 8-1, an AJAX proxy was used to load the local file, /data/data.json, which is in the same web folder as the app folder.</p>

<p>You can set a proxy object and it will load the data. To let the proxy understand (read) the data, you can set a reader object (Ext.data.reader.Reader).</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">proxy: {
	type: 'ajax',
	url: 'data/data.json', 
	reader: {
		type: 'json',
		rootProperty: 'results' 
	}
}</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Note the steps to set up the reader object:</p>

<ul>
  <li>First, set up a type. There are two types of data responses that the reader can interpret: json and xml.</li>
  <li>Define the rootProperty. It points to the root node of your data, from where it has to start reading the data.</li>
</ul>

<p>There are more configs you can set in Ext.data.reader.Reader. The ones I use regularly are:</p>

<ul>
  <li>
    <p>successProperty</p>

    <p>Should point to the response property with a success attribute (by default, it points to the property name success).</p>
  </li>
  <li>
    <p>messageProperty</p>

    <p>Should point to the response property with a response message (this property is optional).</p>
  </li>
  <li>
    <p>totalProperty</p>

    <p>Should point to the response property with a total number of records in the dataset. This is required only while paging, when the whole dataset is not passed in one go, but is being paged from the remote server (by default, it points to the property name total).</p>
  </li>
</ul>

<p>Let’s take a look at the FindACab app in Example 8-1. Here I retrieve data from the same domain into the store by setting an AJAX proxy into the data store.</p>

<p><code>
Ext.define('FindACab.store.Cabs', {
    extend: 'Ext.data.Store',
    requires: ['Ext.data.proxy.Ajax'],
    config: {
        model: 'FindACab.model.Cab',
        autoLoad: true,
        proxy: {
	        type: "ajax",
	        url : "data/data.json",
	        reader: {
	            type: "json",
	            rootProperty: "businesses"
	        }
	    },
    }
});
</code>
Sometimes when you want to retrieve data from an external server, the response data is just not what you expected. For example, you want to reorder, cache, or rename properties, or you just want to add more data or maybe you don’t have control over the remote server to provide JSONP. In these cases, an AJAX proxy can be really handy. You can create an own “proxy” on the server side that connects to the external server and fetches the data. When it is retrieved on the server side, you modify the response. This custom proxy script is running on the same server as your app does, so you can hook it up with a Sencha Touch AJAX proxy back to the Sencha Touch data store. In PHP, such a scenario might look like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&lt;? php
</span><span class="line">
</span><span class="line">function URL_get_contents($URL) {
</span><span class="line">    if (!function_exists('cURL_init')) {
</span><span class="line">        die('CURL is not installed!');
</span><span class="line">    }
</span><span class="line">    $ch = cURL_init();
</span><span class="line">    cURL_setopt($ch, CURLOPT_URL, $URL);
</span><span class="line">    cURL_setopt($ch, CURLOPT_RETURNTRANSFER, true);
</span><span class="line">    $output = cURL_exec($ch);
</span><span class="line">    $httpCode = cURL_getinfo($ch, CURLINFO_HTTP_CODE); //get the code of request
</span><span class="line">    cURL_close($ch);
</span><span class="line">    if ($httpCode == 400) return 'Bummer';
</span><span class="line">    if ($httpCode == 200) {
</span><span class="line">        $data = json_decode($output); // do some fancy stuff here $data = json_encode($data);
</span><span class="line">        header('Content-Type: application/json');
</span><span class="line">        echo $data;
</span><span class="line">    }
</span><span class="line">} 
</span><span class="line">?&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Retrieving data through AJAX proxies can be handy. The data is directly in your store, which is great for the data-bind components that connect to a store, such as the <code>Ext.List</code>
Sometimes you don’t need to retrieve data through a proxy. Maybe you don’t want to display the data results into a data-aware component, or you just don’t need a model or a store. Other times, the proxy is already in use by a client proxy (you can set just one proxy per model or store),Although in such a scenario you could also switch proxies with setProxy on the model or store, you can also choose to make plain AJAX requests. I will discuss this option next.</p>

<h4 id="implementing-an-ajax-request">Implementing an AJAX Request</h4>
<p>In the previous section, we retrieved data in a store via an AJAX proxy. Sometimes you don’t need to save or retrieve data in a store, maybe because you are not displaying the data in a data-aware component, such a as an XTemplate,n that case, a simple Ext.Ajax request, with parameters to pass in, might be an easier solution for saving and retrieving data on the same domain than hooking up an AJAX proxy to a store.</p>

<p>At the top of your class you will require Ext.Ajax, so the Ext.Loader knows to load the AJAX framework class first. Next you will create the request:</p>

<p><code>
Ext.Ajax.request({
            url: 'somescript.php',
            timeout: 60000,
            method: 'POST',
            params: {
                location: 'Amsterdam NL'
            },
            success: function(response){
                //remove loading mask
                Ext.Viewport.unmask();
                try {
                    var text = response.responseText;
                    var results = Ext.JSON.decode(text);
                    console.log(results.businesses);
                } catch (e) {
                    //you can never assume that data is the way you want.
                    console.error(e);
                }
            },
            failure: function(e){
                //remove loading mask
                Ext.Viewport.unmask();
                console.error(e);
            }
        });
</code>
Ext.Ajax is a singleton instance of an Ext.data.Connection, which is the class that is used to communicate with server-side code.</p>

<p><code>XHR2, NEW IN SENCHA TOUCH 2.3</code></p>

<p>A new config setting, released in Sencha Touch 2.3, is to set up your AJAX request through the XHR2 (AJAX2) object. You will just need to enable the boolean property xhr2:true in the request object. XMLHttpRequest Level 2 is like XHR but with a huge makeover that allows you to do things like uploading progress events (Sencha Touch 2.3 also has a new progressbar component, Ext.ProgressIndicator!) and support for uploading/downloading binary data.
Check out “<a href="http://bit.ly/xmlhttprequest2">New Tricks in XMLHttpRequest2</a>” and <a href="http://docs.sencha.com/touch/2.3.1/#!/guide/xhr2_guide">“XHR2 Uploads and Downloads”</a> to get more information about XHR2.</p>

<p>Sometimes you don’t have access to the source — for example, because the script is hosted on an external website. In the case of the FindACab app, we want it to receive data from Yelp.com. The next part discusses the tricks to retrieve data from an external domain.</p>

<h4 id="retrieving-data-from-an-external-domain-with-jsonp">Retrieving Data from an External Domain with JSONP</h4>

<p>While AJAX in general cannot send and retrieve data from an external domain because of the cross-domain policy, JSONP can send and retrieve data from an external domain. It <code>only</code> uses HTTP <code>GET</code> and therefore cannot use HTTP <code>POST</code> to post (large) data to an external domain</p>

<p>In other words, you can send data, but it’s sent in the query string rather than the request body,sending data through GET is less secure than over POST because the data that will be sent is part of the URL. So it’s visible in the <code>browser history</code> or in <code>server logfiles</code>.</p>

<p>It is impossible to request or send data to external domains because of the same-origin policy; the browser ignores any connection, assuming nobody else is allowed. JSONP works differently; it’s a little like a magic trick — one that is well known.</p>

<p>Under the hood, it works as follows (again, see Figure 8-2):</p>

<p><img src="/images/2014/10/figure8-2.png" /></p>

<h4 id="implementing-jsonp-proxies">Implementing JSONP Proxies</h4>

<p>The JSONP proxy works only when the server supports JSONP or when you have control over the server. Also, this trick can only send and retrieve data via GET requests.</p>

<p><code>
proxy: {
    type: 'jsonp',
    URL: 'http://externaldomain.com/users',
    reader: {
        type: 'json',
        rootProperty: 'results'
    }
}
</code></p>

<h4 id="implementing-the-jsonp-proxy-for-the-findacab-app">Implementing the JSONP Proxy for the FindACab App</h4>

<p>Did you notice that the fields of the business object in the previous JSON response have the same names as the fields from the Sencha FindACab.model.Cab model? These fields map to the model fields, so you can later use them in your code. What if the JSON response has a slightly different name than the name that is defined in the model? You can either change the model field name, or you can add a mapping property to the model field.</p>

<p>For example, when you have a complex data feed that looks like this (note the
car:brand: notation):</p>

<p><code>
{
    results: [
        car: brand: [{
            name: "BMW",
            series: 7
        }, {
            name: "BMW",
            series: 5
        }]
        ...
    }
</code></p>

<p>You can add a mapping attribute to the field. In this case, brand maps to <code>["car:brand"][0].name:</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.define("MyApp.model.Car", {
</span><span class="line">    extend: "Ext.data.Model",
</span><span class="line">    config: {
</span><span class="line">        fields: [{
</span><span class="line">            name: "brand"
</span><span class="line">            mapping: "['car:brand'][0].name"
</span><span class="line">        }]
</span><span class="line">    }
</span><span class="line">});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>JSONP request</p>

<p><code>
Ext.define('FindACab.store.Cabs', {
    extend: 'Ext.data.Store',
    requires: ['Ext.data.proxy.JsonP'],
    config: {
        model: 'FindACab.model.Cab',
        autoLoad: true,
        proxy: {
            type: 'jsonp',
            noCache: false,
            url: FindACab.utils.Commons.Commons.YELP_API,
            extraParams: {
                term: FindACab.utils.Commons.YELP_TERM,
                ywsid: FindACab.utils.Commons.YELP_KEY,
                location: FindACab.utils.Commons.LOCATION
            },
            reader: {
                type: 'json',
                rootProperty: 'businesses',
            }
        },
    }
});
</code>
Instead of using the proxy for a JSONP request, you can also use the Ext.data.JsonP method, which you will do in the next section.</p>

<h4 id="implementing-a-jsonp-request">Implementing a JSONP Request</h4>
<p>View components — like lists, dataviews, or charts — are data-aware. You need to hook up a data store to preview the view with data. The previous section explained how to <code>retrieve</code> external data from Yelp in a data store. Later, this data will be displayed in an <code>Ext.dataview.List</code> view component,When retrieving external data, sometimes you don’t need to retrieve data in a store — for example, when you’re displaying data in an <code>Ext.XTemplate</code> (or another component that isn’t data-aware) – because you want to have the control over the HTML and styling of the component.In that case, a simple Ext.JsonP request, with parameters to pass in, might be an easier solution for retrieving data from an external domain than retrieving it through a JSONP proxy.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.data.JsonP.request({
</span><span class="line">            url: 'somescript.php',
</span><span class="line">            callbackKey: 'callback',
</span><span class="line">            params: {
</span><span class="line">                location: "Amsterdam NL"
</span><span class="line">            },
</span><span class="line">            success: function(response, request){
</span><span class="line">                //remove loading mask
</span><span class="line">            },
</span><span class="line">            failure: function(e){
</span><span class="line">                //remove loading mask
</span><span class="line">            }
</span><span class="line">        });</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Saving or Retrieving Data from an External Domain with AJAX</p>

<p>You want to post (or get) data from an external domain, but posting data is only possible with AJAX, not with JSONP. JSONP cannot send data with HTTP POST, and AJAX in general cannot retrieve and post data from external domains so you might run into a problem. What you actually want is an AJAX request to save and retrieve data to an external domain. Read on for the trick to this.</p>

<h5 id="implementing-cors">Implementing CORS</h5>

<p>You will need to set up Access-Control-Allow HTTP headers on the web server to post (and retrieve) data with AJAX to an external URL.</p>

<p>Sencha Touch provides additional configuration. In an Ext.Ajax.request or AJAX proxy, you have to set the withCredentials boolean to true and set the useDefaultXhrHeader boolean to false to not send the default Xhr header with every request.</p>

<p>Sencha Touch provides additional configuration. In an Ext.Ajax.request or AJAX proxy, you have to set the withCredentials boolean to true and set the useDefaultXhrHeader boolean to false to not send the default Xhr header with every request.</p>

<p>The Ext.Ajax() method (and also the model.save() and form.submit() methods) transmit through the XMLHttpRequest() object, and therefore you can run into security restrictions — cross-domain restrictions — when posting to a different domain. However, there is a way to post data to another server with AJAX; you need to set up your server so it’s possible to set up the HTTP headers (Access-Control-Allow headers) on the web server for that. This technique is called cross-origin resource sharing (CORS), and it enables you to override the default restrictions that prevent a web server from making AJAX requests to domains other than where the app is launched. CORS is supported by the modern browsers.</p>

<p>An example of such an HTTP header might look like:</p>

<p><code>
Access-Control-Allow-Origin: *
</code></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-07T08:49:56+08:00" data-updated="true" itemprop="datePublished">Oct 7<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/sencha/'>Sencha</a>, <a class='category' href='/blog/categories/touch/'>Touch</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/07/data-models/" itemprop="url">Data Models</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Every field can be given a data type,When no datatype is specified, the datatype will be set to auto, which means there is no datatype conversion at all. This might be a solution for complex datatypes such as objects.</p>

<p>Models may contain (optional) validations and associations (relations to other models). Both models and stores can have a proxy to send and retrieve data in JSON, XML, or JavaScript array notation.</p>

<p>本章，我们将学习以下知识点</p>

<ul>
  <li>How to validate a model</li>
  <li>How to save a model to the server </li>
  <li>How to implement a model association</li>
</ul>

<h4 id="validating-a-model">Validating a Model</h4>
<p>In the model config object, you can set a validations array. This array contains validation objects:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class=""><span class="line">validations: [
</span><span class="line">	{type:'presence', field: 'age'},
</span><span class="line">	{type:'length', field:'name', min: 2},
</span><span class="line">	{type:'inclusion', field:'gender', list:['Male', 'Female']},
</span><span class="line">	{type:'exclusion, field:'username', list:['Admin', 'Operator']},
</span><span class="line">	{'format', field:'username', matcher: /([a-z]+)[0-9]{2,3}/}
</span><span class="line">]</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>As you can see, there are different validation types. For example, you can validate fields on presence (if the data exists), on length (if a string has a min or max length of characters), inclusion (if the data string exists in a given list array), exclusion (if the data string does not exist in a given list array), and on format (if the data matches a regular expression, matcher).</p>

<p>Let’s test this. Open the FindACab app in your modern browser. In your debug console, you can enter the code for creating a new model instance:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">var setting = Ext.create('FindACab.model.Setting', { city: "Amsterdam"});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Now you can validate your record with the following command in your console:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">setting.validate();</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Saving a Model to the Server
We will use a simple Car model that looks like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.define('SaveTest.model.Car', {
</span><span class="line">	extend: 'Ext.data.Model',
</span><span class="line">
</span><span class="line">	config: {
</span><span class="line">		fields: [
</span><span class="line">			{ name: 'id', type: 'int'},
</span><span class="line">			{ name: 'brand'},
</span><span class="line">		],
</span><span class="line">		proxy: {
</span><span class="line">            type: 'rest',
</span><span class="line">            //url : '/cars',
</span><span class="line">		    format: 'php', 
</span><span class="line">		    api: {
</span><span class="line">		        create: 'cars/addcar',
</span><span class="line">		        update: 'cars/editcar',
</span><span class="line">		        read: 'cars/loadcar',
</span><span class="line">		        destroy: 'cars/deletecar'
</span><span class="line">		    }	
</span><span class="line">        }
</span><span class="line">	}
</span><span class="line">});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>接下来做一些测试</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class=""><span class="line">var car = Ext.create('SaveTest.model.Car', {
</span><span class="line">    brand: 'Mercedes'
</span><span class="line">});
</span><span class="line">
</span><span class="line">//save = POST method
</span><span class="line">car.save({
</span><span class="line">    success: function() {
</span><span class="line">        console.log('The car record is saved');
</span><span class="line">    },
</span><span class="line">    failure: function(){
</span><span class="line">        console.log('The car record could not be saved.');
</span><span class="line">    }
</span><span class="line">});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Once you’ve created a record, you can save it to the server side with record.save():</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">car.save({</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In order to load data from the server side via the model, you can use record.load(id, callback). When there is no store available, the trick is to first request the model via the ModelManager:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.ModelManager.getModel('SaveTest.model.Car').load(1, { 
</span><span class="line">	success: function(car) {
		console.log("Load Car: " + car.getId()); },
	failure: function(){
		console.log("The car could not be loaded");
	} 
});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><code>Note</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">When you set the proxy type to ajax instead of rest, you can still use readable URLs. The only
</span><span class="line">difference is the HTTP method. Adding, editing, and removing records will be an HTTP POST call.Loading records will be an HTTP GET call.</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Cross-Domain Restrictions
The record.save() method (as well as the Ext.Ajax and form.submit() methods) transmit through the <code>XMLHttpRequest()</code> object, and therefore you might face security restrictions when posting to a different domain. These are known as <code>cross-domain restrictions</code>.</p>

<p>However, there is a way to save and post data to another server. It requires setting up special HTTP headers (<code>Access-Control-Allow headers</code>) on the web server. This technique is called <code>CORS</code> (cross-origin resource sharing), and it enables you to override the default restrictions that prevent a web server from making AJAX request to other domains. For more information, see Chapter 8 and the AJAX sections of this book, or check out the HTML5 Rocks website.</p>

<p>Models can also have relationships with other models. For example, a User model can have a relationship with multiple Order models, and one Order model can have just one relationship with one payment method.</p>

<h4 id="implementing-a-model-association">Implementing a Model Association</h4>
<p>Models can have relationships with one or more other models. The following model associations can request data through each other:</p>

<ul>
  <li>Ext.data.association.HasOne </li>
  <li>Ext.data.association.HasMany </li>
  <li>Ext.data.association.BelongsTo
You can create two or more models and connect these to each other with the hasMany, hasOne, and belongsTo configs:</li>
</ul>

<p>&#8220;`
Ext.define(‘TaxiService’, { 
	extend: ‘Ext.data.Model’,
	config: {
		fields: [‘id’, ‘name’], 
		hasMany : {
			model: ‘Car’, name: ‘cars’ }
	} </p>

<p>});</p>

<p>Ext.define(‘Car’, {
	extend: ‘Ext.data.Model’,
	config: {
		fields: [‘id’, ‘brand’]
	} 
});
&#8220;`
When you want to use associations, you have to add these to the requires array at the top of your model class:</p>

<p><code>
requires: [ 
	'Ext.data.association.HasOne', 
	'Ext.data.association.BelongsTo', 
	'Ext.data.association.HasMany'
]
</code>
<img src="/images/2014/10/figure7-3.png" /></p>

<p>When you want to display the different brands of Cars per TaxiService, you could express the relationships between both models. One TaxiService may contain many different types of Car records. You can define this relationship by specifying the hasMany property into the TaxiService model, so later you can request Car information via the TaxiService model.</p>

<p>You will need a foreignKey on the owner model that links to the associated model. By default, it takes the lowercase name of the owner model plus _id. For example, the TaxiService model would create taxiservice_id as the foreign key.</p>

<p><img src="/images/2014/10/figure7-4.png" /></p>

<p>&#8220;`</p>

<p>//Example 7-2
Ext.define(‘AssociationsTest.model.TaxiService’, {
    extend: ‘Ext.data.Model’,</p>

<pre><code>requires: ['Ext.data.association.HasMany'],

config: {
    fields: ['id', 'name'],
    hasMany  : { //&lt;1&gt;
    	model: 'AssociationsTest.model.Car', //&lt;2&gt;
    	name: 'cars', //&lt;3&gt;
    	foreignKey: 'taxiservice_id' //&lt;4&gt;
    }
} }); ```
</code></pre>

<p>As with every relationship, their connection can be confirmed; the Car model answers its relationship by confirming it belongsTo the TaxiService model. This belongsTo association allows me to request the TaxiService information via the Car model.</p>

<p>&#8220;`
//Example 7-3. model/Car.js
Ext.define(‘AssociationsTest.model.Car’, {
    extend: ‘Ext.data.Model’,
    requires: [‘Ext.data.association.BelongsTo’],
    config: {
        fields: [{
            name: ‘id’, //&lt;1&gt;
            type: ‘int’
        }, {
            name: ‘brand’
        }, {
            name: ‘taxiservice_id’,
            type: ‘int’ //&lt;2&gt;
        }],
        belongsTo: {
            model: ‘AssociationsTest.model.TaxiService’
        }
    }
});</p>

<p>&#8220;`</p>

<p>And now comes the fancy stuff: requesting all the records that have a relationship through the parent model. As covered in Chapter 6, many records are saved in a store — the set of all records together. When specifying the hasMany association, you will point to the relating hasMany model and set a name (cars). The association will dynamically create a <code>virtual store</code> and the name that is set in the association will become the store name. You can call this store by running the <code>cars()</code> method on the TaxiService model. Remember, creating a store will not autoload the data, so you will need to <code>load()</code> the virtual store manually.</p>

<p>Let’s take a look at the next code snippets. First, create two TaxiService records, each of which will contain Car records. A TaxiService model has a hasMany relationship with the Car model:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">var taxiAmsterdam = Ext.create('AssociationsTest.model.TaxiService', { 
</span><span class="line">	id: 1,
	name: 'Taxi Amsterdam' 
</span><span class="line">});
var yellowCab = Ext.create('AssociationsTest.model.TaxiService', { 
	id: 2,
	name: 'Yellow Cab' 
</span><span class="line">});
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The Car records know that they belong to the TaxiService parent model (see previous code) because of the <code>belongsTo</code> relation (in Example 7-3). It has a property, <code>model</code>, that points (belongs) to the <code>TaxiService</code> model. The TaxiService model has a hasMany relationship to the Car model and it has a property: foreignKey (again, see Example 7- 2).</p>

<p>Now let’s create some Car records:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class=""><span class="line">var bmw = Ext.create('AssociationsTest.model.Car', { 
</span><span class="line">	id: 1,
	brand: 'BMW' 
</span><span class="line">});
</span><span class="line">
var mercedes = Ext.create('AssociationsTest.model.Car', { 
	id: 2,
	brand: 'Mercedes' 
</span><span class="line">});
</span><span class="line">
var vw = Ext.create('AssociationsTest.model.Car', { 
	id: 3,
	brand: 'Volkswagen' 
</span><span class="line">});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>To get access to all the Car records from the TaxiService record, you can call the cars() method to create a virtual store:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">var taxiAmsterdamStore = taxiAmsterdam.cars(); 
</span><span class="line">var yellowCabStore = yellowCab.cars();</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The add() and sync() lines in the next piece of code just add the particular Car records to each TaxiService store. You will read more about stores in the next two chapters:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">//add new cars to the Store
taxiAmsterdamStore.add(mercedes); 
taxiAmsterdamStore.add(vw);
</span><span class="line">taxiAmsterdamStore.sync(); 
</span><span class="line">
</span><span class="line">yellowCabStore.add(bmw); 
</span><span class="line">yellowCabStore.sync();
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>To request the TaxiService data from a Car record (and to test the belongsTo relation), you can use the autogenerated getter getTaxiService(). Now, let’s request the TaxiService data for the first record in the taxiAmsterdamStore:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">console.log(taxiAmsterdam.cars().first().getTaxiService());</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Remote Associations
You can also request Car records from the server side. To do so, you would need to add a remote proxy to the Car model:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">proxy: {
	type: 'ajax',
	reader: {
	rootProperty: 'cars'
	},
	url: 'app/data.php' 
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>After you add the records and sync the taxiAmsterdamStore and yellowCabStore, this proxy will <code>POST</code> the messages shown in Examples 7-4 and 7-5 to <code>app/data.json</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Example 7-4. taxiAmsterdam
{cars: [{id:1, brand:BMW, taxiservice_id:1}, {id:2, brand:BMW, taxiservice_id:1}]} 
</span><span class="line">
Example 7-5. yellowCab
{cars: [{id:1, brand:BMW, taxiservice_id:2}]}</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>On your server side, you could code a script that takes these objects and adds them to a
database.</p>

<p>When you want to load data from the remote, you can run the following command:</p>

<p><code>
taxiAmsterdamStore.load(function(records){ 
	console.log(records);
});
</code>
Here, you are loading data into the taxiAmsterdamStore, which has a model with associations hooked up. Therefore, it will fire a GET request, with the following parameters:</p>

<p><code>
filter:[{"property":"taxiservice_id", "value": 1}]
</code>
<code>TIP</code></p>

<p><code>
When the remote store is loaded, the store is automatically filtered so that only records with a matching foreign key are included in the resulting child store. You can override this by specifying the filterProperty.
</code>
On your server side, you could code a script that filters for the taxiservice_id with the value set to 1. The data returned for this request from the server might look like the following example, which is written in PHP:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&lt;? php
</span><span class="line">//Return response as JavaScript header('Content-Type: application/javascript'); echo '{
</span><span class="line">"cars": [{
</span><span class="line">    "id": 1,
</span><span class="line">    "brand": "BMW",
</span><span class="line">    "taxiservice_id": 1
</span><span class="line">}, {
</span><span class="line">    "id": 2,
</span><span class="line">    "brand": "Mercedes",
</span><span class="line">    "taxiservice_id": 1
</span><span class="line">}]
</span><span class="line">}'; 
</span><span class="line">?&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The FindACab app will not display the different brands of cars, which is why you won’t implement any model associations. That is because you will use the Yelp API to provide data about taxi businesses. It will not supply information about car brands like the previous examples did.</p>

<p><code>TIP</code></p>

<p>If you want to read more about associations, check out <a href="http://appointsolutions.com/2012/07/using-model-associations-in-sencha-touch-2-and-ext-js-4/">Rob Boerman’s great tutorial</a> and<a href="http://miamicoder.com/2012/sencha-touch-2-models-hasmany-associations-php-example/">MiamiCoder’s tutorial</a>with PHP server-side code</p>

<h4 id="summary">Summary</h4>

<p>The Sencha data package contains the three key classes <code>Ext.data.Model</code>, <code>Ext.data.Record</code>, and <code>Ext.data.Store</code>.</p>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-06T09:55:37+08:00" data-updated="true" itemprop="datePublished">Oct 6<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/sencha/'>Sencha</a>, <a class='category' href='/blog/categories/touch/'>Touch</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/06/the-layout-system/" itemprop="url">The Layout System</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>In Sencha Touch there are two basic building blocks: <code>components</code> and <code>containers</code>.When you instantiate both with no configuration, they look the same. However, there is one important difference: containers can contain components (or other containers):</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">var container = Ext.create('Ext.Container', { 
</span><span class="line">	items: [{
		xtype: 'component',
		html: 'Nested component' 
	}, {
		xtype: 'container', 
		items: [{
			xtype: 'component',
			html: 'Nested container with component' 
		}]
	}] 
});
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Usually when containers hold other components, you want to think about how to position these multiple components. Maybe you want to position the components on top of each other, or maybe next to each other. In other words, you want to give the container a <code>layout</code>.</p>

<p>Under the hood, Sencha Touch uses the CSS3 <a href="http://css-tricks.com/snippets/css/a-guide-to-flexbox/">flexbox layout</a>.</p>

<p>Ext.Component is the base class for any Sencha Touch view component (widget). Ext.Container is the base class for any Sencha Touch component that may visually contain other components. The most commonly used container classes for Sencha Touch are Ext.Panel, Ext.tab.Panel, and Ext.form.Panel</p>

<p>本章中我们将学习到以下知识点</p>

<ul>
  <li>How to implement a horizontal layout </li>
  <li>How to implement a vertical layout</li>
  <li>How to implement a full screen (fit) layout </li>
  <li>How to implement a card layout</li>
  <li>How to implement the default layout (no layout) </li>
  <li>How to dock components</li>
</ul>

<h4 id="implementing-a-horizontal-layout">Implementing a Horizontal Layout</h4>

<p>When you want to position components horizontally, use the horizontal box layout. The layout type hbox positions items next to each other.</p>

<p>At the top of your container view class, you will require Ext.layout.HBox, so the Ext.Loader knows to load the hbox framework class first. Next, you will create a layout object that sets the type to hbox. Follow up by creating an array with items; this array can contain all the items that need to be positioned next to each other. Here’s the full example:</p>

<p><code>
Ext.define('MyApp.view.MainInterface', { 
	extend: 'Ext.Container',
	requires: ['Ext.layout.HBox'], 
	layout: {
		type: 'hbox', 
	},
	items: [{
		xtype: 'component', 
		html: 'box 1'
	},{
		xtype: 'component', 
		html: 'box 2'
	}] 
});
</code></p>

<p>You can set the <code>align</code> config to position items <code>vertically</code> on the screen. The options for the align config are start (top), center (middle), end (bottom), and stretch. The last option stretches a component to give it the full container height. Then there is the <code>pack</code> config — start (left), center (middle), and end (right) — which positions the set of items <code>horizontally</code> on the screen.</p>

<p>Here are some of the hbox layouts, each of which is followed by its corresponding illustration </p>

<p><code>
layout: {
	type: 'hbox',
	align: 'start',
	pack: 'start' 
},
items: [{
	xtype: 'component', 
	html: 'width: 150',
	width: 150
},{
	xtype: 'component', 
	html: 'width: 150',
	width: 150
}]
</code>
<img src="/images/2014/10/figure5-1.png" /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">layout: {
	type: 'hbox',
	align: 'center',
	pack: 'center' 
</span><span class="line">
},
items: [{
	xtype: 'component', 
	html: 'width: 150',
	width: 150
}, {
	xtype: 'component',
	html: 'width: 150',
	width: 150 
}]</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><img src="/images/2014/10/figure5-2.png" /></p>

<p><code>
layout: {
	type: 'hbox',
	align: 'center',
	pack: 'end' 
},
items: [{
	xtype: 'component', 
	html: 'width: 150',
	width: 150
},{
	xtype: 'component', 
	html: 'width: 150',
	width: 150
}]
</code>
<img src="/images/2014/10/figure5-3.png" /></p>

<p><code>
layout: {
	type: 'hbox',
	align: 'end',
	pack: 'start' 
},
items: [{
	xtype: 'component', 
	html: 'width: 150',
	width: 150
},{
	xtype: 'component',
	html: 'width: 150'
	width: 150 
}]
</code>
<img src="/images/2014/10/figure5-4.png" /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">layout: {
	type: 'hbox',
	align: 'stretch',
	pack: 'start' 
},
items: [{
	xtype: 'component', 
	html: 'width: 150',
</span><span class="line">	width: 150
},{
	xtype: 'component',
	html: 'width: 150',
	width: 150 
}]</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><img src="/images/2014/10/figure5-5.png" /></p>

<p>The preceding examples used a width config for every item. When you want more dynamic sizes, you can use the flex config. Flexing means that you divide the available area based on the flex of each child component. The next example, illustrated in Figure 5-6, shows a horizontal flex layout:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">layout: {
	type: 'hbox',
},
items: [{
	xtype: 'component', 
	flex: 2,
	html: 'flex: 2',
},{
	xtype: 'component', 
	flex: 1,
	html: 'flex: 1',
}]</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><img src="/images/2014/10/figure5-6.png" /></p>

<p>Now let’s say you have three items. The first item has flex: 2, the second item has flex:1, and the third item has a fixed pixel width, width: 100px. How will the layout be calculated? First, the 100px will be subtracted from the 100%. The remainder will be divided into two-thirds and one-third .</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">layout: {
</span><span class="line">	type: 'hbox', 
</span><span class="line">},
items: [{
	xtype: 'component', 
	flex: 2,
	html: 'flex: 2',
},{
	xtype: 'component', 
	flex: 1,
	html: 'flex: 1',
},{
	xtype: 'component', 
	width: 100,
	html: 'width: 100'
}]</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><img src="/images/2014/10/figure5-7.png" />
#### Implementing a Vertical Layout
At the top of your container view class, you will require Ext.layout.VBox, so the Ext.Loader knows to load the vbox framework class first. Next, you will create a layout object that sets the type to vbox.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.define('MyApp.view.MainInterface', { 
</span><span class="line">	extend: 'Ext.Container',
	requires: ['Ext.layout.VBox'], 
</span><span class="line">
	layout: {
		type: 'vbox', 
	},
	items: [{
		xtype: 'component', 
		html: 'box 1'
	},{
		xtype: 'component', 
		html: 'box 2'
	}] 
});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>You can set the <code>align</code> config to position items <code>horizontally</code> on the screen. The options for the align property are start (left), center (middle), end (right), or stretch. The last option stretches a component to give it the full container width. Then there is the <code>pack</code> property — start (top), center (middle), and end (bottom) — which positions the set of items <code>vertically</code> on the screen.
来看几个demo</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">layout: {
	type: 'vbox',
	align: 'start',
	pack: 'start' 
},
items: [{
	xtype: 'component', 
</span><span class="line">	html: 'height: 50',
</span><span class="line">	height: 50
},{
	xtype: 'component', 
	html: 'height: 50',
	height: 50
}]</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><img src="/images/2014/10/figure5-8.png" /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">layout: {
	type: 'vbox',
	align: 'center',
	pack: 'center' 
},
items: [{
	xtype: 'component', 
	html: 'height: 50',
	height: 50
},{
	xtype: 'component', 
	html: 'height: 50',
	height: 50
}]</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><img src="/images/2014/10/figure5-9.png" /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">layout: {
	type: 'vbox',
	align: 'center',
	pack: 'end' 
},
items: [{
	xtype: 'component', 
	html: 'height: 50',
	height: 50
},{
	xtype: 'component', 
	html: 'height: 50',
	height: 50
}]</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><img src="/images/2014/10/figure5-10.png" /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">layout: {
	type: 'vbox',
	align: 'end',
	pack: 'start' 
},
items: [{
	xtype: 'component', 
</span><span class="line">	html: 'height: 50',
</span><span class="line">	height: 50
},{
	xtype: 'component', 
	html: 'height: 50',
	height: 50
}]</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><img src="/images/2014/10/figure5-11.png" /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">layout: {
	type: 'vbox',
	align: 'stretch',
	pack: 'center' 
},
items: [{
	xtype: 'component', 
</span><span class="line">	html: 'height: 50',
</span><span class="line">	height: 50
},{
	xtype: 'component', 
</span><span class="line">	html: 'height: 50',
</span><span class="line">	height: 50
}]</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><img src="/images/2014/10/figure5-12.png" /></p>

<p>If you want to set a fixed height for one of the items, you use the height config. When you want more dynamic sizes, you use the flex config. Flexing means that you divide the available area based on the flex of each child component. The next example, shows a vertical flex layout:</p>

<p><code>
layout: {
	type: 'vbox',
},
items: [{
	xtype: 'component', 
	html: 'flex: 1', 
	flex: 1
},{
	xtype: 'component', 
	html: 'flex: 3', 
	flex: 3
}]
</code>
<img src="/images/2014/10/figure5-13.png" /></p>

<p>Now let’s say you have three items. The first item has flex: 1, the second item has flex:3, and the third item has a fixed pixel height, height: 50px. How will the layout be calculated? First, the 50px will be subtracted from the 100%. The remainder will be divided into one-quarter and three-quarters:</p>

<p><code>
layout: {
	type: 'vbox',
},
items: [{
	xtype: 'component', 
	html: 'flex: 1', 
	flex: 1
},{
	xtype: 'component', 
	html: 'flex: 3', 
	flex: 3
},{
	xtype: 'component', 
	html: 'height: 50', 
	height: 50
}]
</code></p>

<p><img src="/images/2014/10/figure5-14.png" /></p>

<h4 id="implementing-a-full-screen-fit-layout">Implementing a Full-Screen (Fit) Layout</h4>

<p>When you want to position a component full screen, you use the fit layout. The layout type fit makes a child item fit to the full size of its parent container.</p>

<p><code>
layout: 'fit', items: [{
	html: 'Item 1' 
}]
</code>
At the top of your container view class, you will require Ext.layout.Fit, so the Ext.Loader knows to load the fit framework class first. Next, you will create a layout object that sets the type to fit. Follow up by creating an items array; this array can contain <code>only one</code> item.</p>

<p>&#8220;`
Ext.define(‘MyApp.view.MainInterface’, { 
	extend: ‘Ext.Container’,
	requires: [‘Ext.layout.Fit’], 
	layout: {
		type: ‘fit’, </p>

<pre><code>},
items: [{
	xtype: 'component', 
	html: 'layout: fit'
}]  }); ``` &lt;img src="/images/2014/10/figure5-15.png"&gt;
</code></pre>

<p>The container has a height and width of 400×400 pixels. The nested item (component) takes the full width and height that has been set in the parent container, so it has the same 400×400 pixel dimension.</p>

<p>Here’s another example of the same fit layout. The container has a 400×400px dimension, but this time the nested component has a margin of 25px on each side </p>

<p><code>
layout: {
	type: 'fit',
},
items: [{
	xtype: 'component', 
	margin: 25,
	html: 'layout: fit'
}]
</code>
<img src="/images/2014/10/figure5-16.png" /></p>

<h4 id="implementing-a-card-layout">Implementing a Card Layout</h4>

<p>You can create a more complex layout by using cards. A card layout allows you to fit multiple components in one space, and show <code>only one at a time</code>, just like a stack of cards. To do this, set the layout type to card .</p>

<p>At the top of your container view class, you will require Ext.layout.Card, so the Ext.Loader knows to load the card framework class first. Next, you will create a layout object that sets the type to card. Follow up by creating an array with items; this array can contain all the items that need to be positioned as a stack of cards.</p>

<p><code>
Ext.define('MyApp.view.MainInterface', { 
	extend: 'Ext.Container',
	requires: ['Ext.layout.Card'], 
	layout: {
		type: 'card', 
	},
	items: [{
		xtype: 'component', html: 'card 1'
	},{
		xtype: 'component', html: 'card 2'
	}, {
		html: 'card 3' 
	}]
});
</code>
<img src="/images/2014/10/figure5-17.png" /></p>

<p>This layout has the same visual look as a fit layout; it also takes the size of the container. But there is one important difference with this layout type. When the container contains multiple items, they will be stacked on top of each other, like a deck of cards</p>

<p>With the method setActiveItem(), you can set the item to be displayed at the top of the cards stack. All the other items won’t be visible. Carousels (a Sencha Touch component for cards that you can slide with your fingers) and tabpanels (a Sencha Touch component for cards that you can activate with tabs) both use a card layout.</p>

<p>A nice extra that comes with the card layout is the ability to add an animation while changing the active slide. You can set an animation object with a type and a direction. The supported types are:</p>

<ul>
  <li>slide (Ext.fx.layout.card.Slide) </li>
  <li>fade (Ext.fx.layout.card.Fade) </li>
  <li>cover (Ext.fx.layout.card.Cover) </li>
  <li>reveal (Ext.fx.layout.card.Reveal) </li>
  <li>pop (Ext.fx.layout.card.Pop)</li>
  <li>flip (Ext.fx.layout.card.Flip) </li>
  <li>scroll (Ext.fx.layout.card.Scroll) </li>
  <li>cube (Ext.fx.layout.card.Cube)</li>
</ul>

<p>Here’s an example of how you can include an animation for a page transition in a card layout. Please note the animation subject:</p>

<p><code>
layout: {
	type: 'card',
	animation: {
		type: 'slide',
		direction: 'left' 	
	}
}
</code>
<code>注意</code></p>

<p><code>
Android 2 supports only scroll and fade; otherwise, it forces the animation to slide.
</code></p>

<h4 id="implementing-the-default-layout">Implementing the Default Layout</h4>

<p>When you do not want to set a layout or you want to fall back to the default browser behavior, you can use the default/auto layout.</p>

<p>When you do not specify the layout object, or you set the layout to auto or default, your design will take the Ext.layout.Default layout</p>

<p><code>
Ext.define('MyApp.view.MainInterface', { 
	extend: 'Ext.Container',
	requires: ['Ext.layout.Default'], 
	layout: {
		type: 'auto', 
	},
	items: [{
		xtype: 'component', 
		cls: 'component1',
		html: 'component 1
	},{
		xtype: 'component', 	
		cls: 'component2', 
		html: 'component 2
	}] 
});
</code>
<img src="/images/2014/10/figure5-19.png" /></p>

<p>This layout tiles your elements directly beneath each other. It takes the full available width to fill its parent container unless a width is set. If no height is set, it will expand <code>naturally to fit itself or its child items</code>. It’s the same behavior as how a browser positions block-level elements.</p>

<p><code>Tip</code>
Impressive Webs has a <a href="http://www.impressivewebs.com/difference-block-inline-css/">helpful article</a> about browser block-level elements versus inline-elements.</p>

<p>All other layouts inherit from Ext.layout.Default, and the default layout also supports docking items, which we’ll cover next.</p>

<h4 id="docking-components">Docking Components</h4>
<p>With docking, you can set an item to dock left, top, right, or bottom from its container. A good example is a toolbar that is docked to the top of the screen. (Some people call this a sticky header.)</p>

<p>&#8220;`
Ext.define(‘MyApp.view.MainInterface’, { 
	extend: ‘Ext.Container’,
	items: [{
		docked: ‘top’
		html: ‘docked: top’, </p>

<pre><code>},{
	html: '' 
}] }); ``` &lt;img src="/images/2014/10/figure5-19.png"&gt;
</code></pre>

<p>You must use an <code>HTML5</code> doctype for a docked bottom to work. To do this, simply add the following code to the top of the HTML file: <code>&lt;!doctype html&gt;</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.define('MyApp.view.MainInterface', { 
</span><span class="line">	extend: 'Ext.Container',
	items: [{
		docked: 'left'
		html: 'docked: left', 
	},{
		html: '' 
	}]
});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><img src="/images/2014/10/figure5-21.png" /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.define('MyApp.view.MainInterface', {
</span><span class="line">	extend: 'Ext.Container', 
</span><span class="line">	items: [{
		docked: 'right'
		html: 'docked: right', 
	},{
		html: '' 
	}]
});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><img src="/images/2014/10/figure5-22.png" /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.define('MyApp.view.MainInterface', { 
</span><span class="line">	extend: 'Ext.Container',
	items: [{
		docked: 'bottom'
		html: 'docked: bottom', 
	},{
		html: '' 
	}]
});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Summary
The best way of creating interfaces is by prototyping the application before you implement it in your app. You could do this with code, as with the code snippets in this chapter, or you could use <a href="http://www.sencha.com/products/architect/">Sencha Architect</a>, Sencha’s visual design tool.</p>

<p>The Sencha layout system supports the following layout types: hbox (horizontal box layout), vbox (vertical box layout), fit (take the size of the container layout), card (stacked layout), and default, the browser’s, block-level layout. All of these types have a set of additional configurations, such as <code>align, pack, and animation</code>.</p>

<p>The <code>Ext.Viewport</code> is an instance created when you use Ext.application(). Ext.Viewport extends from Ext.Container, so it has a layout (which defaults to the card layout). This means you can add items to it at any time, from anywhere in your code. The viewport fullscreen configuration is true by default, so it will take up your whole screen, and thus it matches any device to its screen size.</p>

<p>Imagine you would like the main layout for your tablet to be different from that of your phone. Sencha Touch handles this with <code>device profiles</code>, which create different mobile experiences. With a device profile, you can share code (like layouts and views, but also logics and controllers) between device types, to customize the appearance, behavior, or workflows for each device Device profiles can be generated with Sencha Cmd. These classes will be stored in the app/profile directory. For more information about device profiles, read the <a href="http://docs.sencha.com/touch/2.3.1/#!/guide/profiles">online guide</a>.</p>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-05T20:25:39+08:00" data-updated="true" itemprop="datePublished">Oct 5<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/sencha/'>Sencha</a>, <a class='category' href='/blog/categories/touch/'>Touch</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/05/the-class-system/" itemprop="url">The Class System</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1 id="the-class-system">The Class System</h1>
<p>上一章，我们学习了如何从已知的component classes中创建components并引用它们,我们其实也可以通过extending Sencha Touch的base classes来定义我们自己<code>custom component classes</code>,接下来我们将学习如何创建一个component并且定义我们自己的类,本章中，我们将学习到以下知识点</p>

<ul>
  <li>How to define your own custom class</li>
  <li>How to define getters and setters</li>
  <li>How to define singletons and static members How inheritance works (extending)</li>
  <li>How multiple inheritance works (mixins)</li>
</ul>

<h4 id="section">定义我们自己的类</h4>
<p>let’s discuss how the Sencha class system works and how to define your own blueprints to define a class.</p>

<p>Let’s make a blueprint containing a variable, myVar, and a method, myMethod. Using Ext.define():</p>

<p><code>
Ext.define('AppName.packagename.ClassName', { 
	//class configuration object
	myVar: 1,
	myMethod: function(name){
		//console.log("Log: " + name);
	} 
},function(){
	//optional callback used for logging
});
</code>
It’s important to know that components in the Sencha framework are, in fact, classes.
To create a class definition, you will use the Ext.define method.</p>

<p>In general, the string class name consists of the following parts:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">AppName.packagename.ClassName</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>For example, the following class maps to the file app/view/ListView.js:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.define('MyDemoApp.view.ListView', { 
</span><span class="line">	//class configuration object
</span><span class="line">});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>In the preceding code, note the following:</p>

<ul>
  <li>The app name, MyDemoApp, maps to the app folder in your project root and should be written in the upper CamelCase notation (wherein each word begins with a capital letter).</li>
  <li>The package name, view, maps to the package folder in the app folder; package names are always written in lowercase.</li>
  <li>The class name, ListView, should also be written in the upper CamelCase notation. The class name should contain the same name as the JavaScript filename (ListView.js); therefore, it’s not possible to put multiple Sencha Touch classes in a single JavaScript file.</li>
</ul>

<p>The second argument takes a class configuration object. This is where you can set properties and methods. </p>

<p>&#8220;`
Ext.application({ 
	name: ‘DemoApp’,
	launch: function() {
	/* Start class definition code: */
	//Create a class definition Ext.define(‘DemoApp.view.DemoComponent’, { //
	//
		extend: ‘Ext.Component’, config: {
		html: ‘Hello World’ // }
	}, function() {
		console.log(“class is created”); //
	});
	//Create a class instance </p>

<pre><code>Ext.create('DemoApp.view.DemoComponent', { //
	fullscreen: true 
});
}  }); ```
</code></pre>

<h4 id="defining-getters-and-setters">Defining Getters and Setters</h4>

<p>the Sencha class system can automatically create accessors and mutators (known as magic methods) for you.</p>

<p>It is very easy to create getter and setter methods to access or mutate a class property; they will be automatically generated for you. That is why some people call them magic.</p>

<p>To autocreate magic getter and setter methods, set a property in the class config:</p>

<p><code>
config: {
	myProperty: "some value"
}
</code>
The config object autocreates the getter and setter methods as follows:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">getMyProperty: function(){
	return this.myProperty; //returns "some value"
}
</span><span class="line">
setMyProperty: function(x){
	this.myProperty = x; 
}
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Besides getter and setter methods, it also automatically creates apply and update methods. These methods are handy to change the process, before and after you set a value:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">applyMyProperty: function(x){
	//runs before this.myProperty changes. //for example validation
}
updateMyProperty: function(x){
	//runs after this.myProperty was changed.
}</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>来看一个例子，在configs里定义了一个Cab类，注意getDriver(), setDriver(), applyDriver(), and updateDriver() 是自动产生的.为了在值生产前作一些校验，你需要重写 applyDriver() 方法; 为了在改变driver后再作一些操作，你需要重写updateDriver()方法</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.define('VehicleApp.vehicle.Cab', { // The default config
	config: {
		driver: 'John Doe', 
		driver2: {
			firstName: 'John',
			lastName: 'Doe' 
		}
	},
	constructor: function(config) {
		 this.initConfig(config);
	},
	applyDriver: function(newVal){ 
</span><span class="line">
		if(newVal === 'The Pope') {
			console.log(newVal + " is an invalid taxi driver.");
			return; 
		}
		return newVal; 
	},
	updateDriver: function(newVal, oldVal){
		console.log('The owner has been changed from ' + oldVal + ' to ' + newVal);
	} 
});
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Because the previous code example does not extend from a Sencha component, I had to initialize the config settings in my constructor:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">constructor: function(config) { 
</span><span class="line">	this.initConfig(config);
}</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>The config object sets some default values. When you are not extending from an Ext.Component, you have to call the initConfig(config) method once by yourself,(e.g., in the base class), which will initialize the configuration for the class that was passed in while creating the objects.
After you instantiate the class, you have access to the getters and setters in the prototype. They have been magically generated:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">var taxi = Ext.create("VehicleApp.vehicle.Cab", { 
</span><span class="line">	driver: "John Doe"
});
alert(taxi.getDriver()); //alerts 'John Doe';
taxi.setDriver('The Pope');
alert(taxi.getDriver()); //alerts 'John Doe' because 'The Pope' is invalid.
//changes the driver from 'John Doe' to 'Lee Boonstra'
taxi.setDriver('Lee Boonstra'); 
</span><span class="line">
alert(taxi.getDriver());
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>You can even use magic getter and setter methods to access complex objects. For example, let’s change the code in Example 4-2 and define a config with a complex object:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">config: { 
</span><span class="line">	driver: {
		firstName: "John",
</span><span class="line">		lastName: "Doe" 
</span><span class="line">	}
}</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>I can get access to its properties with the line <code>taxi.getDriver().firstName</code>.
The config object in a class definition is very useful for class instances. Sometimes you don’t want to instantiate a class; for example, you may just want to run some default common utility functions. Singletons and static members would do the trick. We’ll discuss them in the next section.</p>

<h4 id="defining-singletons-and-static-members">Defining Singletons and Static Members</h4>
<p>It is pretty simple to define a class as a singleton — just set the config singleton to true:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.define('Utils.common.Functions', { 
</span><span class="line">	singleton: true,
	//key value pairs here
});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>A singleton class definition can’t create objects (technically it can’t create more than one object, because the singleton itself gets instantiated once), but you can get access to all the methods and properties in the class itself. This is very handy for when you want to get access to generic functions or properties used as constants:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.define('Utils.common.Logger', { 
</span><span class="line">	singleton: true,
	version: "1.02", 
	log: function(msg) {
		console.log(msg); 
	}
});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>You can call the log() function by invoking <code>Utils.common.Logger.log()</code> directly from the class.
Singletons also can contain config objects, and therefore generate magic getters and setters from properties. For example:</p>

<p><code>
Ext.define('Utils.common.Version', { 
	singleton: true,
	config: {
		version: "1.03",
	} 
});
</code></p>

<p>The previous code will generate a getter: getVersion(). Now, from anywhere in my application I can get access to this property with</p>

<p><code>
Utils.common.Version.getVersion()
</code>
A nice alternative for singletons are classes with a statics object defined. To set up a class with a statics object, you only need to define a statics object with key/value pairs.(Note that you can’t set a config object within a statics object)
Here we define statics with the VehicleApp.utils.Commons class:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.define('VehicleApp.utils.Commons', { 
</span><span class="line">	statics: {
		YELP_API: 'http://api.yelp.com/business_review_search?', 
		YELP_KEY: 'ftPpQUCgfSA3yV98-uJn9g',
		YELP_TERM: 'Taxi',
		LOCATION: 'Amsterdam NL',
		getUrl: function() {
			return this.YELP_API + "term=" + this.YELP_TERM +
				"&amp;ywsid=" + this.YELP_KEY
				+ "&amp;location=" + this.LOCATION;
		}, 
	}
});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>You can create objects of a class that has statics defined, but these objects cannot get access to its properties and methods without invoking it from the class itself with the dot notation. In other words, requesting properties and methods from an instance via this will not work, but calling the full namespace (i.e., VehicleApp.utils.Commons.LOCATION) will:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">var mySettings = Ext.create('VehicleApp.utils.Commons');
//It is possible to create an instance of a class with static members: console.log(mySettings);
//But getting access to a static member from an object fails: 
mySettings.getUrl();
//Uncaught TypeError: Object [object Object] has no method 'getUrl'</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>#### Inherit from a Single Class
To create single class inheritance, you extend from a parent class by setting the extend config:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Ext.define('AppName.packagename.ClassName', { 
</span><span class="line">	extend: 'AppName.packagename.SomeClassName'
});
</span><span class="line">

// Example 4-3. Define a parent class
</span><span class="line">Ext.define('VehicleApp.vehicle.Vehicle', { 
</span><span class="line">	unit: "mph",
	drive: function(speed) {
		console.log(this.$className + ": Vrrroom: " + speed + " " + this.unit);
	} 
});
</span><span class="line">
// Example 4-4. Define a child class and implement inheritance
</span><span class="line">Ext.define('VehicleApp.vehicle.Car', { 
</span><span class="line">	extend: 'VehicleApp.vehicle.Vehicle', drive: function(speed) {
		console.log(this.$className + ": Vrrroom, vrrroom: " + speed + this.unit); 
	}
});
</span><span class="line">
</span><span class="line">var vehicle = Ext.create("VehicleApp.vehicle.Vehicle");
vehicle.drive(40); //alerts "Vrrroom: 40 mph" 
</span><span class="line">
var car = Ext.create("VehicleApp.vehicle.Car");
car.drive(60); //alerts "Vrrroom, vrrroom: 60 mph"
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>As with any object-oriented language, if you need to do further initializations upon creation, you code a constructor. It makes sense to code an initConfig(config) method in a constructor.</p>

<p>The <code>initConfig(config)</code> method initializes the configuration for this particular class. Whether you initialize default config values or pass in config values as an argument while creating an object, this method will override and merge them all together and create an instance with these default settings.When you are inheriting from other classes, you don’t need to rewrite the initConfig method. It’s inherited, so the functionality is already there, but it does need to exist. Typically, the best place to include it would be in your base class.</p>

<p>Another powerful method is <code>callParent([arguments])</code>. It also makes sense to write this call in the constructor, although you don’t have to. You can run this from any other method, as shown in Example 4-6, which I will discuss shortly.
It’s important to have this call in your <code>custom classes</code>, because you always want to initialize the config settings from every parent. </p>

<p>You are free to call the parent from whatever method you are in. This can be handy for overriding functionality.In Example 4-6, I want to override the drive() function that is inherited from the Vehicle class in order to customize it specifically for a <code>Motor</code> class</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">// Example 4-6. Class inheritance
</span><span class="line">Ext.define('VehicleApp.vehicle.Motor', {
	extend: 'VehicleApp.vehicle.Vehicle',
	config: { 
		nrOfWheels: 2 //
	},
	constructor: function (config) { 
		this.initConfig(config); //
	},
	drive: function(speed) { //
		if(this.getNrOfWheels() &lt; 3) { // 
		console.log(this.$className +
			": Vrrroom, vrrroom on " + this.getNrOfWheels() + " wheels.");
		} else { 
			this.callParent([60]); //
		} 
	}
});
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>注意以上的constructor部分，最后把这部分放到base class( 即Vehicle.js),放这里只做demo之用
I can run this code by creating an instance of the Motor class.
<code>
var motor = Ext.create('VehicleApp.vehicle.Motor', { 
//nrOfWheels: 4
}); 
motor.drive();
</code>
Constructors aren’t used with components. If you subclass Ext.Component, you probably won’t use a constructor. Instead, components are initialized in a method named <code>initialize()</code>.
Inheritance is a very powerful concept. What about multiple inheritance?
#### Inherit from Multiple Classes</p>

<p>You might want a class to inherit features from more than one superclass. When you want to implement multiple inheritance of classes, you need <code>mixins</code>,A mixin object does exactly what the name implies: it mixes in functionality.“Take a little bit of this, use a little bit of that…” For example, take a method of class X, take a method of class Y, implement it in class Z.
Let’s say we have two vehicle classes, a normal car and a monster 4-wheeler. Both vehicles can inherit the methods to brake and to drive. Only the monster 4-wheeler can also jump, however; the normal car can’t.</p>

<p><img src="/images/2014/10/multi-inherit.png" /></p>

<p>Now, let’s define three classes, each with its own functionality to share drive(), brake(), and jump(). Later you will define two vehicle classes that inherit from these classes and mix in those methods.</p>

<p>&#8220;`
// Example 4-7. Define classes with the methods you will mix in</p>

<p>Ext.define(‘VehicleApp.mixins.Drive’, { 
	drive: function(){ //the method to share
	console.log(this.$className + “: Vrrrrooom”); }
}); </p>

<p>Ext.define(‘VehicleApp.mixins.Brake’, {
	brake: function(){ 
		console.log(this.$className + “: Eeeeekk”);
	}
});</p>

<p>Ext.define(‘VehicleApp.mixins.Jump’, {
	jump: function(){ 
		console.log(this.$className + “: Bump”);
	}	 
});	
&#8220;`</p>

<p>Finally, you can define the two Vehicle classes with the mixin implementations. Again, these are just normal class definitions, but with a mixins object. You can list all the mixins underneath one another</p>

<p>&#8220;`
// Example 4-8. Define a Car class with mixin implementations
Ext.define(‘VehicleApp.vehicle.Car’, { 
	mixins: {
		canBrake: ‘VehicleApp.mixins.Brake’,
		canDrive: ‘VehicleApp.mixins.Drive’ 	
	}
});</p>

<p>// Example 4-9. Define a FourWheeler class with mixin implementations
Ext.define(‘VehicleApp.vehicle.FourWheeler’, { 
	mixins: {
		canBrake: ‘VehicleApp.mixins.Brake’, 
		canDrive: ‘VehicleApp.mixins.Drive’, 
		canJump: ‘VehicleApp.mixins.Jump’
	} 
});
&#8220;`
With the implementation of Examples 4-8 and 4-9, the drive() and brake() methods are available to the Car class, and the drive(), brake(), and jump() methods are available to the FourWheeler class.</p>

<p><code>
var mercedes = Ext.create('VehicleApp.vehicle.Car');
var honda = Ext.create('VehicleApp.vehicle.FourWheeler');
mercedes.drive(); 
mercedes.brake();
honda.drive(); 
honda.jump(); 
honda.brake();
</code>
The mixin identifier <code>canBrake</code> matches the prototype, and therefore you can run the brake() method on the FourWheeler and Car classes.
#### Summary
Vanilla JavaScript by its nature has no class system, as JavaScript is a prototype-based language. To mimic the ideas of object-oriented programming, you can write your JavaScript functions in an object-oriented way:</p>

<p><code>
function Cab(driver, passenger) { 
	this.driver = driver; 
	this.passenger = passenger;
}
</code>
To create an instance of this Cab class, you can create a new object with the new operator:</p>

<p><code>
var mercedes = new Cab('John Doe', 'The president');
</code>
Sencha Touch has a built-in class system that ships with inheritance, magic methods, and singleton strategies. Example 4-10 is the Sencha version of the previous Cab class.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">//Example 4-10. app/view/Cab.js
</span><span class="line">Ext.define('TaxiApp.view.Cab', { 
</span><span class="line">	extend: 'Ext.Component', 
</span><span class="line">	config: {
		driver: '',
		passenger: '' 
	}
});</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>To create an instance of this Sencha Cab class, you can create a new object, but without the new operator:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">var mercedes = Ext.create('TaxiApp.view.Cab', { 
</span><span class="line">	driver: 'John Doe',
	passenger: 'The president'
});
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>下一章我们将学习<code>how to create layouts for your Sencha applications and components.</code></p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2014 - AllenToFight -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
	

<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->







		</div>
	</div>
</body>
</html>
